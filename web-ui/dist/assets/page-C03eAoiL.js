import{r as i,R as Oe,j as e}from"./index-CcXpoZej.js";import{c as J,S as Ot,B as at,l as Ke,e as R,f as Kt,P as Ee,j as it,T as Ut,I as Ht,L as Dt,M as Bt,E as lt}from"./Sidebar--sQWCiQF.js";import{L as Wt,P as ye,C as ct,F as Zt}from"./index-w8aIcREP.js";import{R as Gt}from"./refresh-cw-CXkMaxss.js";import{T as Ie}from"./trash-2-B4G_OQpN.js";import{L as Jt}from"./layout-panel-left-Dg980y9u.js";import{S as Qt}from"./save-DLKzxFqv.js";import{D as dt,R as Vt}from"./rotate-ccw-DlD471KP.js";import{C as He}from"./chevron-down-B_PkHte5.js";import{C as Xt}from"./circle-stop-CKm5v-LA.js";import{L as Ae}from"./loader-circle-DTiCSUKX.js";import{A as ut}from"./activity-DXcP5pcm.js";import{E as Yt}from"./external-link-CeIcI3rx.js";import{X as je}from"./x-Bvf5J2ZL.js";import{C as yt}from"./code-xml-BImr0CmV.js";import{S as eo}from"./sparkles-C5m-BQ7D.js";import{M as ht,r as mt}from"./index-CCMhwwuo.js";/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const to=[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]],oo=J("bold",to);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const so=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],kt=J("chevron-up",so);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const no=[["path",{d:"M11 14h10",key:"1w8e9d"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v1.344",key:"1e62lh"}],["path",{d:"m17 18 4-4-4-4",key:"z2g111"}],["path",{d:"M8 4H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 1.793-1.113",key:"bjbb7m"}],["rect",{x:"8",y:"2",width:"8",height:"4",rx:"1",key:"ublpy"}]],ro=J("clipboard-paste",no);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ao=[["path",{d:"M21 21H8a2 2 0 0 1-1.42-.587l-3.994-3.999a2 2 0 0 1 0-2.828l10-10a2 2 0 0 1 2.829 0l5.999 6a2 2 0 0 1 0 2.828L12.834 21",key:"g5wo59"}],["path",{d:"m5.082 11.09 8.828 8.828",key:"1wx5vj"}]],io=J("eraser",ao);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lo=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],co=J("grip-vertical",lo);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uo=[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]],ho=J("italic",uo);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mo=[["path",{d:"M10 8h.01",key:"1r9ogq"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M14 8h.01",key:"1primd"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"M18 8h.01",key:"emo2bl"}],["path",{d:"M6 8h.01",key:"x9i8wu"}],["path",{d:"M7 16h10",key:"wp8him"}],["path",{d:"M8 12h.01",key:"czm47f"}],["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}]],po=J("keyboard",mo);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xo=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],fo=J("link",xo);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bo=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}]],go=J("panel-left",bo);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wo=[["path",{d:"M16 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"rib7q0"}],["path",{d:"M5 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"1ymkrd"}]],yo=J("quote",wo);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ko=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],No=J("rotate-cw",ko);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jo=[["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M8.12 8.12 12 12",key:"1alkpv"}],["path",{d:"M20 4 8.12 15.88",key:"xgtan2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M14.8 14.8 20 20",key:"ptml3r"}]],vo=J("scissors",jo),pt=r=>!r||r<=0?"0G":`${(r/1024).toFixed(r%1024===0?0:1)}G`,Ue=r=>{if(!r)return"-";const a=r.effective_resources||r.resources||{},u=r.available_resources||{},l=Number(u.total_cores||0),x=Number(u.total_memory_mb||0),p=Number(a.shuffle_partitions||0);if(l>0||x>0)return`Avail ${l} cores · ${pt(x)} RAM · shuffle ${p}`;const b=Number(a.total_cores||0),j=pt(Number(a.total_memory_mb||0));return`${b} cores · ${j} RAM · shuffle ${p}`},Pe=r=>{if(!(r!=null&&r.shuffle_tuning))return"";const a=r.shuffle_tuning,u=Number(a.current||0),l=Number(a.recommended||0);return!u||!l?"":`shuffle ${u} (recommended ~${l})`},xt=r=>{var u;const a=(u=r==null?void 0:r.shuffle_tuning)==null?void 0:u.status;return a==="low"?"Shuffle Low":a==="high"?"Shuffle High":""},ft=r=>{window.dispatchEvent(new CustomEvent("openclaw:notebooks-notice",{detail:{message:r}}))},ce=()=>Math.random().toString(36).substring(2,10),te=r=>`"${String(r).replace(/"/g,'""')}"`,Co=r=>String(r).replace(/'/g,"''"),we=(r,a=[])=>{if(!r||typeof r!="object")return null;for(const u of a){const l=r[u];if(l!=null&&String(l).trim())return String(l).trim()}for(const u of Object.values(r))if(u!=null&&String(u).trim())return String(u).trim();return null},bt=async(r,a,u)=>{var l,x;try{const p=(x=(l=r==null?void 0:r.languages)==null?void 0:l.getLanguages)==null?void 0:x.call(l).find(m=>(m==null?void 0:m.id)===a);if(!p||typeof p.loader!="function")return[];const b=await p.loader(),j=(b==null?void 0:b.language)||{},y=new Set;for(const m of u){const k=j==null?void 0:j[m];if(Array.isArray(k))for(const M of k){const v=String(M||"").trim();v&&y.add(v)}}return Array.from(y)}catch{return[]}},So=r=>/^[A-Za-z_][A-Za-z0-9_]*$/.test(r),_o=r=>{var u;const a=new Set;for(const l of r){if(l.cell_type!=="code"||l.language!=="python")continue;const x=String(l.source||"").split(`
`);for(const p of x){const b=p.trim();if(!b||b.startsWith("#"))continue;const j=b.match(/^def\s+([A-Za-z_][A-Za-z0-9_]*)\s*\(/);if(j){a.add(j[1]);continue}const y=b.match(/^class\s+([A-Za-z_][A-Za-z0-9_]*)\s*[\(:]/);if(y){a.add(y[1]);continue}const m=b.match(/^import\s+(.+)$/);if(m){const v=m[1].split(",");for(const $ of v){const A=$.trim();if(!A)continue;const C=A.match(/\s+as\s+([A-Za-z_][A-Za-z0-9_]*)$/);if(C){a.add(C[1]);continue}const _=(u=A.split(".")[0])==null?void 0:u.trim();_&&So(_)&&a.add(_)}continue}const k=b.match(/^from\s+[A-Za-z0-9_\.]+\s+import\s+(.+)$/);if(k){const v=k[1].split(",");for(const $ of v){const A=$.trim();if(!A||A==="*")continue;const C=A.match(/^([A-Za-z_][A-Za-z0-9_]*)(?:\s+as\s+([A-Za-z_][A-Za-z0-9_]*))?$/);C&&a.add(C[2]||C[1])}continue}const M=b.match(/^([A-Za-z_][A-Za-z0-9_]*)\s*=/);M&&a.add(M[1])}}return Array.from(a).sort((l,x)=>l.localeCompare(x))},Ne={id:ce(),cell_type:"code",source:"",language:"python",outputs:[],execution_count:null,running:!1},Lo=(r,a)=>a==="catalog"?r.languages.CompletionItemKind.Module:a==="schema"?r.languages.CompletionItemKind.Struct:a==="table"?r.languages.CompletionItemKind.Value:a==="view"?r.languages.CompletionItemKind.Interface:a==="column"?r.languages.CompletionItemKind.Field:r.languages.CompletionItemKind.Function,gt=(r,a,u,l)=>{const x=r;x.__openclawNotebookSqlSuggestionSource=a,x.__openclawNotebookSqlColumnLoader=u,x.__openclawNotebookSqlKeywordSource=l,!x.__openclawNotebookSqlAutocompleteRegistered&&(x.__openclawNotebookSqlAutocompleteRegistered=!0,r.languages.registerCompletionItemProvider("sql",{triggerCharacters:[" ","."],provideCompletionItems:async(p,b)=>{const j=x.__openclawNotebookSqlSuggestionSource,y=typeof j=="function"?j():[],m=x.__openclawNotebookSqlKeywordSource,k=typeof m=="function"?m():[],M=p.getWordUntilPosition(b),v={startLineNumber:b.lineNumber,endLineNumber:b.lineNumber,startColumn:M.startColumn,endColumn:M.endColumn},A=p.getValueInRange({startLineNumber:b.lineNumber,startColumn:1,endLineNumber:b.lineNumber,endColumn:b.column}).match(/([A-Za-z0-9_]+(?:\.[A-Za-z0-9_]+)*)\.\s*$/),C=A?A[1].toLowerCase():null,_=(M.word||"").toLowerCase();let f=y;if(C){const w=C.split(".").length;if(f=y.filter(T=>T.fqn.toLowerCase().startsWith(C+".")&&T.fqn.toLowerCase().split(".").length===w+1),f.length===0&&w>=3){const T=x.__openclawNotebookSqlColumnLoader;if(typeof T=="function")try{f=await T(C)}catch{f=[]}}}else _&&(f=y.filter(w=>w.label.toLowerCase().startsWith(_)));const oe=C?[]:k.filter(w=>!_||w.toLowerCase().startsWith(_)).map(w=>({label:w.toUpperCase(),kind:r.languages.CompletionItemKind.Keyword,insertText:w.toUpperCase(),detail:"sql keyword",range:v,sortText:`0_${w}`})),de=f.map(w=>({label:w.label,kind:Lo(r,w.kind),insertText:w.label,detail:w.detail,range:v,sortText:`1_${w.fqn}`})),se=new Set;return{suggestions:[...oe,...de].filter(w=>{const T=String(w.label).toLowerCase();return se.has(T)?!1:(se.add(T),!0)})}}}))},wt=(r,a,u)=>{const l=r;l.__openclawNotebookPythonKeywordSource=a,l.__openclawNotebookPythonSymbolSource=u,!l.__openclawNotebookPythonAutocompleteRegistered&&(l.__openclawNotebookPythonAutocompleteRegistered=!0,r.languages.registerCompletionItemProvider("python",{triggerCharacters:[".","_"],provideCompletionItems:(x,p)=>{const b=l.__openclawNotebookPythonKeywordSource,j=l.__openclawNotebookPythonSymbolSource,y=typeof b=="function"?b():[],m=typeof j=="function"?j():[],k=x.getWordUntilPosition(p),M=(k.word||"").toLowerCase(),v={startLineNumber:p.lineNumber,endLineNumber:p.lineNumber,startColumn:k.startColumn,endColumn:k.endColumn},$=y.filter(f=>!M||f.toLowerCase().startsWith(M)).map(f=>({label:f,kind:r.languages.CompletionItemKind.Keyword,insertText:f,detail:"python keyword",range:v,sortText:`0_${f}`})),A=m.filter(f=>!M||f.toLowerCase().startsWith(M)).map(f=>({label:f,kind:r.languages.CompletionItemKind.Variable,insertText:f,detail:"notebook symbol",range:v,sortText:`1_${f}`})),C=new Set;return{suggestions:[...$,...A].filter(f=>{const oe=String(f.label).toLowerCase();return C.has(oe)?!1:(C.add(oe),!0)})}}}))};function Mo({output:r}){const a=r.name==="stderr";return e.jsx("div",{className:R("px-4 py-3 font-mono text-[11.5px] whitespace-pre-wrap leading-relaxed rounded-b-md border border-obsidian-border/40 shadow-inner",a?"text-obsidian-danger bg-[#2b1010]":"text-foreground bg-[#1e1e1e]"),children:r.text})}function $o({data:r}){var a;return(a=r==null?void 0:r.columns)!=null&&a.length?e.jsxs("div",{className:"overflow-auto max-h-[400px] border-t border-obsidian-border bg-obsidian-bg",children:[e.jsxs("table",{className:"w-full text-left border-collapse font-sans text-[11px]",children:[e.jsx("thead",{className:"sticky top-0 bg-obsidian-panel z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-1.5 border-b border-r border-obsidian-border font-medium text-obsidian-muted w-10 text-center",children:"#"}),r.columns.map((u,l)=>e.jsx("th",{className:"px-3 py-1.5 border-b border-r border-obsidian-border font-semibold text-obsidian-info truncate",children:u},l))]})}),e.jsx("tbody",{children:r.rows.map((u,l)=>e.jsxs("tr",{className:"hover:bg-white/5 transition-colors",children:[e.jsx("td",{className:"px-3 py-1 border-b border-r border-obsidian-border text-obsidian-muted font-mono text-[10px] text-center",children:l+1}),u.map((x,p)=>e.jsx("td",{className:"px-3 py-1 border-b border-r border-obsidian-border text-foreground/90 truncate max-w-[300px]",title:String(x),children:x===null?e.jsx("span",{className:"text-obsidian-muted italic",children:"null"}):String(x)},p))]},l))})]}),e.jsxs("div",{className:"bg-obsidian-panel px-3 py-1 text-[10px] text-obsidian-muted border-b border-obsidian-border flex justify-between",children:[e.jsxs("span",{children:[r.rows.length," rows"]}),e.jsxs("span",{children:[r.columns.length," columns"]})]})]}):null}function Po({output:r}){return e.jsxs("div",{className:"bg-obsidian-danger/5 overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-2 text-[11px] font-semibold text-obsidian-danger flex items-center gap-1.5",children:[e.jsx(je,{className:"w-3.5 h-3.5"}),e.jsxs("span",{children:[r.ename,": ",r.evalue]})]}),r.traceback&&r.traceback.length>0&&e.jsx("div",{className:"px-4 pb-2",children:e.jsx("pre",{className:"text-[10px] font-mono text-obsidian-danger/70 whitespace-pre-wrap leading-relaxed",children:r.traceback.join(`
`).replace(/\u001b\[[0-9;]*m/g,"")})})]})}function Eo({output:r}){var u;const a=r.data;return a?(u=a["application/json"])!=null&&u.columns?e.jsx($o,{data:a["application/json"]}):a["text/html"]?e.jsx("div",{className:"px-4 py-2 bg-obsidian-bg",dangerouslySetInnerHTML:{__html:a["text/html"]}}):a["image/png"]?e.jsx("div",{className:"px-4 py-2 bg-obsidian-bg",children:e.jsx("img",{src:`data:image/png;base64,${a["image/png"]}`,alt:"output",className:"max-w-full rounded border border-obsidian-border"})}):a["text/plain"]?e.jsx("pre",{className:"px-4 py-2 font-mono text-[11px] text-foreground/90 whitespace-pre-wrap bg-obsidian-bg",children:a["text/plain"]}):null:null}function Ao({outputs:r}){return!r||!r.length?null:e.jsx("div",{className:"flex flex-col gap-2 mt-2",children:r.map((a,u)=>{switch(a.output_type){case"stream":return e.jsx(Mo,{output:a},u);case"error":return e.jsx(Po,{output:a},u);case"execute_result":case"display_data":return e.jsx(Eo,{output:a},u);default:return null}})})}function Io({cell:r,index:a,total:u,isActive:l,onActivate:x,onUpdate:p,onDelete:b,onMoveUp:j,onMoveDown:y,onRun:m,onAddBelow:k,sqlSuggestionItems:M,loadSqlColumns:v,sqlKeywordItems:$,pythonKeywordItems:A,pythonSymbolItems:C}){const _=i.useRef(null),f=i.useRef(null),oe=r.source.split(`
`).length,de=Math.max(40,Math.min(oe*18+16,500)),[se,ve]=i.useState(de),[w,T]=i.useState(!1);i.useEffect(()=>{f.current&&(gt(f.current,()=>M,v,()=>$),wt(f.current,()=>A,()=>C))},[M,v,$,A,C]);const W=i.useCallback(c=>{const N=_.current;if(!N)return;const E=N.getModel();if(!E)return;const K=N.getSelection(),L=E.getValueInRange(K)||"";let F="",Y=0;switch(c){case"bold":F=L?`**${L}**`:"**bold text**",Y=L?0:-2;break;case"italic":F=L?`*${L}*`:"*italic text*",Y=L?0:-1;break;case"code":L.includes(`
`)?F=`\`\`\`
${L||"code"}
\`\`\``:F=L?`\`${L}\``:"`code`",Y=L?0:-1;break;case"link":F=L?`[${L}](url)`:"[link text](url)",Y=-1;break;case"image":F=L?`![${L}](url)`:"![alt text](url)",Y=-1;break;case"h1":{const P=K.startLineNumber,U=E.getLineContent(P);F=`# ${U.replace(/^#+\s*/,"")}`,N.executeEdits("toolbar",[{range:{startLineNumber:P,startColumn:1,endLineNumber:P,endColumn:U.length+1},text:F}]),N.focus();return}case"h2":{const P=K.startLineNumber,U=E.getLineContent(P);F=`## ${U.replace(/^#+\s*/,"")}`,N.executeEdits("toolbar",[{range:{startLineNumber:P,startColumn:1,endLineNumber:P,endColumn:U.length+1},text:F}]),N.focus();return}case"h3":{const P=K.startLineNumber,U=E.getLineContent(P);F=`### ${U.replace(/^#+\s*/,"")}`,N.executeEdits("toolbar",[{range:{startLineNumber:P,startColumn:1,endLineNumber:P,endColumn:U.length+1},text:F}]),N.focus();return}case"list":{const P=K.startLineNumber,U=K.endLineNumber,q=[];for(let I=P;I<=U;I++)E.getLineContent(I).startsWith("- ")?q.push({range:{startLineNumber:I,startColumn:1,endLineNumber:I,endColumn:3},text:""}):q.push({range:{startLineNumber:I,startColumn:1,endLineNumber:I,endColumn:1},text:"- "});N.executeEdits("toolbar",q),N.focus();return}case"quote":{const P=K.startLineNumber,U=K.endLineNumber,q=[];for(let I=P;I<=U;I++)E.getLineContent(I).startsWith("> ")?q.push({range:{startLineNumber:I,startColumn:1,endLineNumber:I,endColumn:3},text:""}):q.push({range:{startLineNumber:I,startColumn:1,endLineNumber:I,endColumn:1},text:"> "});N.executeEdits("toolbar",q),N.focus();return}default:return}if(N.executeEdits("toolbar",[{range:K,text:F}]),Y&&!L){const P=N.getPosition();P&&N.setPosition({lineNumber:P.lineNumber,column:P.column+Y})}N.focus()},[]),xe=c=>{c.editor.defineTheme("obsidian",{base:"vs-dark",inherit:!0,rules:[{token:"comment",foreground:"6a737d",fontStyle:"italic"},{token:"keyword",foreground:"c792ea",fontStyle:"bold"},{token:"keyword.sql",foreground:"c792ea",fontStyle:"bold"},{token:"string",foreground:"c3e88d"},{token:"string.sql",foreground:"c3e88d"},{token:"number",foreground:"f78c6c"},{token:"number.sql",foreground:"f78c6c"},{token:"operator",foreground:"89ddff"},{token:"identifier",foreground:"eeffff"},{token:"function",foreground:"82aaff"},{token:"delimiter",foreground:"89ddff"},{token:"type",foreground:"ffcb6b"}],colors:{"editor.background":"#111113","editor.foreground":"#eeffff","editor.selectionBackground":"#2b3040","editor.lineHighlightBackground":"#1a1a1e","editorCursor.foreground":"#c792ea","editorWhitespace.foreground":"#2a2a30","editorIndentGuide.background":"#2a2a30","editorLineNumber.foreground":"#404050"}}),gt(c,()=>M,v,()=>$),wt(c,()=>A,()=>C)},Ce=(c,N)=>{_.current=c,f.current=N,N.editor.setTheme("obsidian"),c.onKeyDown(E=>{(E.shiftKey||E.metaKey||E.ctrlKey)&&E.keyCode===3&&(E.preventDefault(),m())}),(H==="sql"||H==="python")&&c.addAction({id:`trigger-suggest-${H}-${r.id}`,label:"Trigger Suggest",keybindings:[N.KeyMod.CtrlCmd|N.KeyCode.Space],run:()=>c.trigger("keyboard","editor.action.triggerSuggest",{})})},H=r.language||"python";return e.jsxs("div",{className:"relative group/cell flex flex-col items-center w-full",children:[e.jsxs("div",{className:"flex w-full max-w-[1240px] 2xl:max-w-[1440px]",children:[e.jsx("div",{className:R("w-8 shrink-0 flex items-start justify-center pt-2.5 transition-opacity cursor-grab",l?"opacity-100":"opacity-0 group-hover/cell:opacity-40 hover:opacity-100"),children:e.jsx(co,{className:"w-4 h-4 text-obsidian-muted"})}),e.jsxs("div",{className:R("flex-1 flex min-w-0 transition-all duration-150 rounded-lg border",r.cell_type==="markdown"&&l?"flex-col":"flex-row",l?"border-white/20 bg-white/[0.03] shadow-md":"border-white/5 hover:border-white/10 bg-white/[0.01] hover:bg-white/[0.02]"),onClick:x,children:[r.cell_type==="markdown"&&l&&e.jsxs("div",{className:"w-full flex items-center justify-between px-3 py-1.5 border-b border-white/10 bg-white/[0.02] rounded-t-lg",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-obsidian-muted/80",children:[e.jsx("button",{onClick:c=>{c.stopPropagation(),T(!w)},className:R("px-2.5 py-1 mr-1 text-[11px] font-medium rounded-md border transition-colors",w?"text-white bg-white/10 border-white/20":"text-white/70 bg-transparent hover:bg-white/5 border-transparent"),children:w?"Hide preview":"Show preview"}),e.jsx("button",{onClick:c=>{c.stopPropagation(),W("bold")},className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 transition-colors",title:"Bold (⌘B)",children:e.jsx(oo,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:c=>{c.stopPropagation(),W("italic")},className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 transition-colors",title:"Italic (⌘I)",children:e.jsx(ho,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:c=>{c.stopPropagation(),W("code")},className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 transition-colors",title:"Code",children:e.jsx(yt,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:c=>{c.stopPropagation(),W("link")},className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 transition-colors",title:"Link",children:e.jsx(fo,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:c=>{c.stopPropagation(),W("image")},className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 transition-colors",title:"Image",children:e.jsx(Ht,{className:"w-3.5 h-3.5"})}),e.jsx("div",{className:"w-px h-3 bg-obsidian-border/60 mx-1"}),e.jsx("button",{onClick:c=>{c.stopPropagation(),W("h1")},className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 transition-colors text-[11px] font-semibold",title:"Heading 1",children:"H1"}),e.jsx("button",{onClick:c=>{c.stopPropagation(),W("h2")},className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 transition-colors text-[11px] font-semibold",title:"Heading 2",children:"H2"}),e.jsx("button",{onClick:c=>{c.stopPropagation(),W("h3")},className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 transition-colors text-[11px] font-semibold",title:"Heading 3",children:"H3"}),e.jsx("button",{onClick:c=>{c.stopPropagation(),W("list")},className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 transition-colors",title:"List",children:e.jsx(Dt,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:c=>{c.stopPropagation(),W("quote")},className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 transition-colors",title:"Quote",children:e.jsx(yo,{className:"w-3.5 h-3.5"})})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-obsidian-muted",children:[e.jsx("span",{className:"px-2 py-0.5 mr-1 text-[11px] font-medium text-foreground/50 bg-[#252830] rounded border border-white/5",children:"Markdown"}),e.jsx("button",{onClick:c=>{c.stopPropagation(),ft("AI Generate requires an LLM API key configuration. Coming soon!")},className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 text-[#d7aef2] hover:text-[#f3d0ff] transition-colors",title:"AI Generate",children:e.jsx(eo,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:c=>{c.stopPropagation(),ft("Expand mode coming soon!")},className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 transition-colors",title:"Expand",children:e.jsx(Bt,{className:"w-3.5 h-3.5"})}),e.jsx("button",{className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 transition-colors",title:"More options",children:e.jsx(lt,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:c=>{c.stopPropagation(),b()},disabled:u<=1,className:"w-6 h-6 flex items-center justify-center rounded text-obsidian-danger/50 hover:text-obsidian-danger hover:bg-obsidian-danger/10 transition-colors disabled:opacity-20",title:"Delete cell",children:e.jsx(Ie,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex-1 flex min-w-0 relative",children:[r.cell_type==="code"&&e.jsx("div",{className:"shrink-0 flex items-center pl-1.5 pr-0.5 relative z-10",children:e.jsx("button",{onClick:c=>{c.stopPropagation(),m()},disabled:r.running,className:R("w-6 h-6 flex items-center justify-center rounded-full transition-all",r.running?"text-white/60":"text-foreground/40 hover:text-white hover:bg-white/10"),title:"Run cell (⇧↵)",children:r.running?e.jsx(Ae,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Ee,{className:"w-3.5 h-3.5 fill-current"})})}),e.jsxs("div",{className:"flex-1 min-w-0 flex flex-col pt-0.5 relative",children:[r.cell_type==="markdown"&&l&&e.jsx("div",{className:"absolute top-[8px] left-[32px] text-obsidian-muted/40 text-[12px] font-mono pointer-events-none z-10",children:"%md"}),r.cell_type==="markdown"&&!l?e.jsx("div",{className:"prose prose-invert prose-sm max-w-none text-foreground/80 min-h-[40px] px-3 py-2 cursor-text",children:e.jsx(ht,{remarkPlugins:[mt],children:r.source||"*Double-click or enter to edit markdown*"})}):e.jsxs("div",{className:R("relative",r.cell_type==="markdown"&&w&&"flex gap-0"),children:[e.jsx("div",{className:R(r.cell_type==="markdown"&&w?"w-1/2 border-r border-obsidian-border/30":"w-full"),children:e.jsx(Zt,{height:se,language:r.cell_type==="markdown"?"markdown":H,theme:"obsidian",value:r.source,onChange:c=>p({source:c||""}),beforeMount:xe,onMount:(c,N)=>{Ce(c,N),c.onDidContentSizeChange(E=>{var K;if(E.contentHeightChanged){const L=Math.max(40,Math.min(E.contentHeight,500));ve(L),(K=_.current)!=null&&K.getContainerDomNode()&&(_.current.getContainerDomNode().style.height=`${L}px`)}})},options:{scrollBeyondLastLine:!1,wordWrap:"on",wrappingIndent:"indent",minimap:{enabled:!1},lineNumbers:r.cell_type==="markdown"?"off":"on",lineNumbersMinChars:4,glyphMargin:!1,folding:r.cell_type!=="markdown",fontSize:13,fontFamily:"'JetBrains Mono', 'Fira Code', 'Cascadia Code', monospace",tabSize:4,renderLineHighlight:"all",padding:{top:r.cell_type==="markdown"?24:7,bottom:20},overviewRulerBorder:!1,scrollbar:{vertical:"hidden",horizontal:"auto",alwaysConsumeMouseWheel:!1},automaticLayout:!0,contextmenu:!1,matchBrackets:"near",fontLigatures:!0,quickSuggestions:{other:!0,comments:!1,strings:!1},suggestOnTriggerCharacters:!0,acceptSuggestionOnEnter:"on"}})}),r.cell_type==="markdown"&&w&&e.jsx("div",{className:"w-1/2 overflow-auto px-4 py-3 prose prose-invert prose-sm max-w-none text-foreground/80",style:{maxHeight:se},children:e.jsx(ht,{remarkPlugins:[mt],children:r.source||"*Start typing to see preview...*"})})]}),r.outputs&&r.outputs.length>0&&e.jsx("div",{className:"w-full mt-1 border-t border-obsidian-border/30 bg-[#0c0c0d] rounded-b",children:e.jsx(Ao,{outputs:r.outputs})}),r.cell_type==="markdown"&&l&&e.jsx("div",{className:"w-full flex justify-end px-3 py-1 text-obsidian-muted/50 text-[11px] font-sans absolute bottom-0 right-0 pointer-events-none",children:"Generate (⌘ + I)"})]}),!(r.cell_type==="markdown"&&l)&&e.jsxs("div",{className:R("absolute top-0 right-0 flex items-center pt-1.5 pr-1.5 gap-0.5 transition-opacity z-10 bg-gradient-to-l from-[#1e2025] via-[#1e2025]/95 to-transparent pl-6",l?"opacity-100":"opacity-0 group-hover/cell:opacity-100"),children:[r.cell_type==="code"?e.jsxs("select",{value:r.language,onChange:c=>p({language:c.target.value}),className:"text-[11px] font-medium text-foreground/70 bg-transparent hover:bg-white/5 rounded px-2 py-1 appearance-none cursor-pointer outline-none transition-colors capitalize mr-1",children:[e.jsx("option",{value:"python",className:"bg-obsidian-panel text-foreground",children:"Python"}),e.jsx("option",{value:"sql",className:"bg-obsidian-panel text-foreground",children:"SQL"})]}):e.jsx("span",{className:"text-[11px] font-medium text-foreground/50 px-2 py-1 mr-1",children:"Markdown"}),e.jsx("button",{onClick:c=>{c.stopPropagation(),j()},disabled:a===0,className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 text-foreground/40 hover:text-foreground disabled:opacity-20 transition-colors",title:"Move up",children:e.jsx(kt,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:c=>{c.stopPropagation(),y()},disabled:a===u-1,className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 text-foreground/40 hover:text-foreground disabled:opacity-20 transition-colors",title:"Move down",children:e.jsx(He,{className:"w-3.5 h-3.5"})}),e.jsx("button",{className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 text-foreground/40 hover:text-foreground transition-colors",title:"More options",children:e.jsx(lt,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:c=>{c.stopPropagation(),b()},disabled:u<=1,className:"w-6 h-6 flex items-center justify-center rounded text-obsidian-danger/50 hover:text-obsidian-danger hover:bg-obsidian-danger/10 transition-colors disabled:opacity-20",title:"Delete cell",children:e.jsx(Ie,{className:"w-4 h-4"})})]})]})]})]}),r.cell_type==="markdown"&&l&&e.jsxs("div",{className:"w-full flex-col items-center justify-center text-obsidian-muted/40 text-[11px] font-mono mt-8 leading-loose text-center mb-4 tracking-wide",children:["[Shift+Enter] to run and move to next cell",e.jsx("br",{}),"[Cmd+Shift+P] to open the command palette",e.jsx("br",{}),"[Esc H] to see all keyboard shortcuts"]}),e.jsxs("div",{className:"w-full max-w-[1200px] 2xl:max-w-[1400px] h-6 relative flex items-center justify-center group/divider",children:[e.jsx("div",{className:"w-full h-px bg-obsidian-border/20 group-hover/divider:bg-obsidian-border/40 transition-colors"}),e.jsxs("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex items-center gap-2 opacity-0 group-hover/divider:opacity-100 transition-opacity z-10",children:[e.jsxs("button",{onClick:c=>{c.stopPropagation(),k("code")},className:"flex items-center gap-1 px-2.5 py-1 bg-[#121214] border border-white/10 rounded text-[10px] text-white/50 hover:text-white hover:border-white/20 hover:bg-white/5 transition-colors shadow-sm",title:"Add Code Cell",children:[e.jsx(ye,{className:"w-3.5 h-3.5"})," Code"]}),e.jsxs("button",{onClick:c=>{c.stopPropagation(),k("markdown")},className:"flex items-center gap-1 px-2.5 py-1 bg-[#121214] border border-white/10 rounded text-[10px] text-white/50 hover:text-white hover:border-white/20 hover:bg-white/5 transition-colors shadow-sm",title:"Add Markdown Cell",children:[e.jsx(ye,{className:"w-3.5 h-3.5"})," Markdown"]})]})]})]})}function Yo(){var et,tt,ot,st;const r=Wt(),[a,u]=i.useState([Ne]),[l,x]=i.useState(Ne.id),[p,b]=i.useState(null),[j,y]=i.useState("disconnected"),[m,k]=i.useState("Untitled"),[M,v]=i.useState(!1),[$,A]=i.useState(""),[C,_]=i.useState(["Untitled"]),[f,oe]=i.useState([]),[de,se]=i.useState(!0),[ve,w]=i.useState("local"),[T,W]=i.useState("python"),[xe,Ce]=i.useState(null),[H,c]=i.useState(null),[N,E]=i.useState(!1),[K,L]=i.useState([]),[F,Y]=i.useState([]),[P,U]=i.useState([]),[q,I]=i.useState([]),[ke,De]=i.useState("small"),[O,Se]=i.useState("small"),[Z,Re]=i.useState(null),[Te,Be]=i.useState(!1),[S,We]=i.useState(null),[Ze,Ge]=i.useState(!1),[ne,Je]=i.useState(!0),[ue,Q]=i.useState(null),_e=i.useRef(new Map),Nt=Oe.useMemo(()=>_o(a),[a]),[jt,Ro]=i.useState(!0);i.useEffect(()=>{if(!ue)return;const t=window.setTimeout(()=>Q(null),3500);return()=>window.clearTimeout(t)},[ue]),i.useEffect(()=>{const t=o=>{const n=o.detail,s=n==null?void 0:n.message;s&&Q({tone:"info",message:s})};return window.addEventListener("openclaw:notebooks-notice",t),()=>window.removeEventListener("openclaw:notebooks-notice",t)},[]),i.useEffect(()=>{if(!r)return;let t=!0;return(async()=>{const[o,n]=await Promise.all([bt(r,"sql",["keywords"]),bt(r,"python",["keywords","builtins","typeKeywords"])]);t&&(Y(o),U(n))})(),()=>{t=!1}},[r]);const g=i.useCallback(async(t,o)=>{const n=await fetch(t,o),s=await n.json().catch(()=>({}));if(!n.ok){const d=(s==null?void 0:s.detail)||(s==null?void 0:s.error)||`HTTP ${n.status}`;throw new Error(String(d))}return s},[]),re=i.useCallback(async(t,o)=>{const n={query:t};o&&(n.catalog=o);const s=await g("/api/trino",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});return Array.isArray(s==null?void 0:s.data)?s.data:[]},[g]),qe=i.useCallback(async()=>{const t=new Map,o=s=>{const d=`${s.kind}:${s.fqn}`.toLowerCase();t.has(d)||t.set(d,s)};try{const s=await re("SHOW CATALOGS");for(const d of s){const h=we(d,["Catalog","catalog","catalog_name"]);if(!h)continue;o({label:h,detail:"catalog",fqn:h,kind:"catalog"});let z=[];try{z=await re(`SHOW SCHEMAS FROM ${te(h)}`,h)}catch{z=[]}for(const $e of z){const D=we($e,["Schema","schema","schema_name"]);if(!D)continue;const G=`${h}.${D}`;o({label:D,detail:`schema (${h})`,fqn:G,kind:"schema"});let le=[];try{le=await re(`SELECT table_name, table_type FROM ${te(h)}.information_schema.tables WHERE table_schema = '${Co(D)}' ORDER BY table_name`,h)}catch{try{le=await re(`SHOW TABLES FROM ${te(h)}.${te(D)}`,h)}catch{le=[]}}for(const ge of le){const pe=we(ge,["table_name","Table","name"]);if(!pe)continue;const rt=(we(ge,["table_type"])||"TABLE").toUpperCase().includes("VIEW")?"view":"table",Ft=`${G}.${pe}`;o({label:pe,detail:`${rt} (${G})`,fqn:Ft,kind:rt})}let B=[];try{B=await re(`SHOW FUNCTIONS FROM ${te(h)}.${te(D)}`,h)}catch{B=[]}for(const ge of B){const pe=we(ge,["Function","function_name","name"]);if(!pe)continue;const nt=`${G}.${pe}`;o({label:pe,detail:`function (${G})`,fqn:nt,kind:"function"})}}}}catch(s){console.error("Failed to refresh notebook SQL metadata:",s)}const n=Array.from(t.values()).sort((s,d)=>s.fqn.localeCompare(d.fqn));L(n),_e.current.clear()},[re]),vt=i.useCallback(async t=>{const o=t.trim();if(!o)return[];const n=_e.current.get(o);if(n)return n;const s=o.split(".");if(s.length<3)return[];const d=s[0],h=s[1],z=s.slice(2).join(".");try{const D=(await re(`SHOW COLUMNS FROM ${te(d)}.${te(h)}.${te(z)}`,d)).map(G=>we(G,["Column","column","Field","name"])).filter(Boolean).map(G=>({label:String(G),detail:`column (${o})`,fqn:`${o}.${String(G)}`,kind:"column"}));return _e.current.set(o,D),D.length>0&&L(G=>{const le=new Map;for(const B of G)le.set(`${B.kind}:${B.fqn}`.toLowerCase(),B);for(const B of D)le.set(`${B.kind}:${B.fqn}`.toLowerCase(),B);return Array.from(le.values()).sort((B,ge)=>B.fqn.localeCompare(ge.fqn))}),D}catch{return _e.current.set(o,[]),[]}},[re]),X=i.useCallback(async()=>{var t;try{const o=await g("/api/notebook/clusters"),n=Array.isArray(o==null?void 0:o.clusters)?o.clusters:[],s=String((o==null?void 0:o.default_cluster_id)||((t=n[0])==null?void 0:t.id)||"small");return I(n),De(s),Se(d=>d&&n.some(h=>h.id===d)?d:s),Je(!0),Ge(!0),s}catch(o){return console.warn("Notebook cluster API unavailable; falling back to legacy kernel mode.",o),Je(!1),I([{id:"default",label:"Default",description:"Legacy notebook backend (cluster API unavailable)",runtime_mode:"legacy",limits:{},runtime:{status:"running",active_sessions:1}}]),De("default"),Se("default"),Ge(!0),"default"}},[g]),ee=i.useCallback(async t=>{if(!ne){We(null);return}const o=(t||Z||O||ke||"").trim();if(o)try{const n=await g(`/api/notebook/observability?cluster_id=${encodeURIComponent(o)}`),s=Array.isArray(n==null?void 0:n.clusters)?n.clusters[0]:null;We(s||null)}catch(n){console.error("Failed to refresh cluster observability:",n)}},[ne,Z,O,ke,g]),Qe=i.useCallback(async t=>{const o=(t||"small").trim();y("starting");try{const n=ne?{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cluster_id:o})}:{method:"POST"},s=await g("/api/notebook/kernels",n);b(s.id),w(s.mode),Re(s.cluster_id||o||null),s.cluster_id&&Se(String(s.cluster_id)),y("idle"),await ee(s.cluster_id||o||null),X().catch(()=>{})}catch(n){console.error("Failed to start kernel:",n),y("disconnected")}},[ne,g,ee,X]),ze=i.useCallback(async()=>{if(p){y("starting");try{const t=await g(`/api/notebook/kernels/${encodeURIComponent(p)}/restart`,{method:"POST"});y("idle"),t!=null&&t.cluster_id&&Re(String(t.cluster_id)),u(o=>o.map(n=>({...n,outputs:[],execution_count:null}))),await ee((t==null?void 0:t.cluster_id)||Z),X().catch(()=>{})}catch(t){console.error("Failed to restart kernel:",t),y("disconnected")}}},[p,g,Z,ee,X]),Ct=i.useCallback(async()=>{if(p)try{await g(`/api/notebook/kernels/${encodeURIComponent(p)}/interrupt`,{method:"POST"})}catch(t){console.error("Failed to interrupt kernel:",t)}},[p,g]),St=i.useCallback(async()=>{if(!(!p||!O)){if(!ne){Q({tone:"error",message:"Bu backend sürümünde cluster attach API yok. openclaw-api containerını güncel kodla yeniden build et."});return}Be(!0),y("starting");try{const t=await g(`/api/notebook/kernels/${encodeURIComponent(p)}/attach`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cluster_id:O,restart:!0})});Re(t.cluster_id||O),y("idle"),u(o=>o.map(n=>({...n,outputs:[],execution_count:null}))),await ee(t.cluster_id||O),X().catch(()=>{})}catch(t){console.error("Failed to attach cluster:",t),y("disconnected"),Q({tone:"error",message:`Failed to attach cluster: ${String(t)}`})}finally{Be(!1)}}},[ne,p,O,g,ee,X]);i.useEffect(()=>{let t=!0;return(async()=>{try{const o=await X();if(!t)return;await Qe(o)}catch(o){console.error("Failed to initialize notebook clusters/kernel:",o),t&&y("disconnected")}})(),()=>{t=!1}},[X,Qe]),i.useEffect(()=>{if(!Ze)return;const t=window.setInterval(()=>{X().catch(()=>{})},3e4);return()=>window.clearInterval(t)},[Ze,X]),i.useEffect(()=>{if(!Z)return;ee(Z);const t=window.setInterval(()=>{ee(Z)},8e3);return()=>window.clearInterval(t)},[Z,ee]),i.useEffect(()=>{qe();const t=window.setInterval(()=>{qe()},6e4);return()=>window.clearInterval(t)},[qe]),i.useEffect(()=>{if(!p)return;const t=()=>{fetch(`/api/notebook/kernels/${encodeURIComponent(p)}`,{method:"DELETE",keepalive:!0}).catch(()=>{})};return window.addEventListener("beforeunload",t),()=>{window.removeEventListener("beforeunload",t),t()}},[p]);const V=i.useCallback(async()=>{try{const t=await g("/api/notebook/files");oe(t.notebooks||[])}catch(t){console.error("Failed to load notebooks:",t)}},[g]);i.useEffect(()=>{V()},[V]);const Le=i.useCallback(async()=>{try{const t=await g("/api/notebook/files",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:m,cells:a.map(o=>({id:o.id,cell_type:o.cell_type,source:o.source,language:o.language,outputs:o.outputs,execution_count:o.execution_count}))})});t!=null&&t.name&&t.name!==m&&(k(t.name),_(o=>o.map(n=>n===m?t.name:n))),V()}catch(t){console.error("Failed to save:",t),Q({tone:"error",message:`Failed to save notebook: ${String(t)}`})}},[m,a,V,g]),Ve=i.useCallback(async()=>{let t=1,o=`Untitled-${t}`;for(;f.some(s=>s.name===o);)t++,o=`Untitled-${t}`;const n=[{...Ne,id:ce()}];try{const s=await g("/api/notebook/files",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:o,cells:n.map(h=>({id:h.id,cell_type:h.cell_type,source:h.source,language:h.language,outputs:h.outputs,execution_count:h.execution_count}))})}),d=(s==null?void 0:s.name)||o;await V(),k(d),u(n),x(n[0].id),_(h=>h.includes(d)?h:[...h,d]),v(!1)}catch(s){console.error("Failed to create new notebook:",s),Q({tone:"error",message:`Failed to create notebook: ${String(s)}`})}},[f,V,g]),he=i.useCallback(async t=>{var o;try{const n=await g(`/api/notebook/files/${encodeURIComponent(t)}`);k(n.name||t),u((n.cells||[]).map(s=>({...s,id:s.id||ce(),running:!1,outputs:s.outputs||[]}))),((o=n.cells)==null?void 0:o.length)>0&&x(n.cells[0].id||ce()),_(s=>s.includes(n.name||t)?s:[...s,n.name||t]),v(!1)}catch(n){console.error("Failed to load notebook:",n),Q({tone:"error",message:`Failed to load notebook '${t}': ${String(n)}`})}},[g]),Fe=i.useCallback((t,o="code")=>{const n={id:ce(),cell_type:o,source:"",language:T,outputs:[],execution_count:null,running:!1};u(s=>{if(!t)return[...s,n];const d=s.findIndex(z=>z.id===t),h=[...s];return h.splice(d+1,0,n),h}),x(n.id)},[]),ae=i.useCallback((t,o)=>{u(n=>n.map(s=>s.id===t?{...s,...o}:s))},[]),Me=i.useCallback(t=>{u(o=>{if(o.length<=1)return o;const n=o.findIndex(d=>d.id===t),s=o.filter(d=>d.id!==t);return l===t&&x(s[Math.min(n,s.length-1)].id),s})},[l]),_t=i.useCallback(async(t,o)=>{if(o.stopPropagation(),!!confirm(`Are you sure you want to delete '${t}'?`))try{await g(`/api/notebook/files/${encodeURIComponent(t)}`,{method:"DELETE"}),await V();const n=C.filter(s=>s!==t);if(n.length===0){_(["Untitled"]),k("Untitled");const s=ce();u([{...Ne,id:s}]),x(s);return}_(n),t===m&&he(n[n.length-1])}catch(n){console.error("Failed to delete notebook:",n),Q({tone:"error",message:`Failed to delete '${t}': ${String(n)}`})}},[V,m,he,C,g]),Lt=i.useCallback((t,o)=>{o.stopPropagation();const n=C.filter(s=>s!==t);if(n.length===0){_(["Untitled"]),k("Untitled");const s=ce();u([{...Ne,id:s}]),x(s)}else _(n),(t===m||M&&t===$)&&he(n[n.length-1])},[C,m,M,$,he]),Xe=i.useCallback(async()=>{const t=m.trim();if(!t){k($||"Untitled"),v(!1);return}if(!$||$===t){k(t),v(!1);return}if(!f.some(n=>n.name===$)){k(t),_(n=>n.map(s=>s===$?t:s)),v(!1);return}try{const n=await g("/api/notebook/files/rename",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({old_name:$,new_name:t})}),s=(n==null?void 0:n.name)||t;k(s),_(d=>d.map(h=>h===$?s:h)),await V()}catch(n){console.error("Failed to rename notebook:",n),k($),Q({tone:"error",message:`Failed to rename notebook: ${String(n)}`})}finally{v(!1)}},[$,m,f,g,V]),Ye=i.useCallback((t,o)=>{u(n=>{const s=n.findIndex(z=>z.id===t);if(o==="up"&&s<=0||o==="down"&&s>=n.length-1)return n;const d=[...n],h=o==="up"?s-1:s+1;return[d[s],d[h]]=[d[h],d[s]],d})},[]),ie=i.useCallback(async t=>{const o=a.find(s=>s.id===t);if(!o||!p)return;ae(t,{running:!0,outputs:[]}),y("busy");let n=o.source;o.language==="sql"&&!n.trimStart().startsWith("%%sql")&&(n=`%%sql
`+n);try{const s=await fetch(`/api/notebook/kernels/${encodeURIComponent(p)}/execute`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:n})}),d=await s.json().catch(()=>({}));if(!s.ok)throw new Error((d==null?void 0:d.detail)||(d==null?void 0:d.error)||`HTTP ${s.status}`);ae(t,{running:!1,outputs:d.outputs||[],execution_count:d.execution_count})}catch(s){ae(t,{running:!1,outputs:[{output_type:"error",ename:"ExecutionError",evalue:String(s),traceback:[]}]})}y("idle")},[a,p,ae]),fe=i.useCallback(async()=>{for(const t of a)t.cell_type==="code"&&await ie(t.id)},[a,ie]),Mt=i.useCallback(async()=>{const t=a.findIndex(o=>o.id===l);for(let o=0;o<t;o++)a[o].cell_type==="code"&&await ie(a[o].id)},[a,l,ie]),$t=i.useCallback(async()=>{const t=a.findIndex(o=>o.id===l);for(let o=t;o<a.length;o++)a[o].cell_type==="code"&&await ie(a[o].id)},[a,l,ie]),Pt=i.useCallback(async()=>{confirm("Restart kernel and run all cells?")&&(await ze(),await fe())},[ze,fe]),Et=i.useCallback(()=>{u(t=>t.map(o=>({...o,outputs:[],execution_count:null})))},[]),At=i.useCallback(()=>{const t=a.find(o=>o.id===l);t&&(Ce({...t}),Me(l))},[a,l,Me]),It=i.useCallback(()=>{const t=a.find(o=>o.id===l);t&&Ce({...t})},[a,l]),Rt=i.useCallback(()=>{if(!xe)return;const t={...xe,id:ce(),running:!1,outputs:[],execution_count:null};u(o=>{const n=o.findIndex(d=>d.id===l),s=[...o];return s.splice(n+1,0,t),s}),x(t.id)},[xe,l]),Tt=i.useCallback(async()=>{try{const t=await g(`/api/notebook/files/${encodeURIComponent(m)}`),o={nbformat:4,nbformat_minor:5,metadata:{kernelspec:{display_name:"Python 3",language:"python",name:"python3"},language_info:{name:"python",version:"3.11"}},cells:(t.cells||[]).map(h=>({cell_type:h.cell_type==="code"?"code":"markdown",source:h.source.split(`
`).map((z,$e,D)=>$e<D.length-1?z+`
`:z),metadata:{},...h.cell_type==="code"?{outputs:h.outputs||[],execution_count:h.execution_count}:{}}))},n=new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),s=URL.createObjectURL(n),d=document.createElement("a");d.href=s,d.download=`${m}.ipynb`,d.click(),URL.revokeObjectURL(s)}catch(t){console.error("Failed to export:",t),Q({tone:"error",message:"Failed to export notebook"})}},[m,g]),qt=i.useCallback(()=>{const t=["# Databricks notebook source","# Exported from OpenClaw Workspace",""];a.forEach((d,h)=>{h>0&&t.push(""),d.cell_type==="markdown"?(t.push("# MAGIC %md"),d.source.split(`
`).forEach(z=>{t.push(`# MAGIC ${z}`)})):d.language==="sql"?(t.push("# COMMAND ----------"),t.push(""),t.push("# MAGIC %sql"),d.source.split(`
`).forEach(z=>{t.push(`# MAGIC ${z}`)})):(t.push("# COMMAND ----------"),t.push(""),t.push(d.source))}),t.push("");const o=new Blob([t.join(`
`)],{type:"text/x-python"}),n=URL.createObjectURL(o),s=document.createElement("a");s.href=n,s.download=`${m}.py`,s.click(),URL.revokeObjectURL(n)},[a,m]),zt=i.useCallback((t,o)=>{const n=o.split(`
`)[0].trim().toLowerCase();let s=null;n==="%sql"||n==="%%sql"?s="sql":(n==="%python"||n==="%%python")&&(s="python"),s?ae(t,{source:o,language:s}):ae(t,{source:o})},[ae]);i.useEffect(()=>{if(!H)return;const t=()=>c(null);return window.addEventListener("click",t),()=>window.removeEventListener("click",t)},[H]),i.useEffect(()=>{const t=o=>{(o.metaKey||o.ctrlKey)&&o.key==="s"&&(o.preventDefault(),Le()),(o.metaKey||o.ctrlKey)&&o.shiftKey&&o.key==="Enter"&&(o.preventDefault(),fe())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[Le,fe]);const me=Oe.useMemo(()=>q.find(t=>t.id===O)||null,[q,O]),be=Oe.useMemo(()=>q.find(t=>t.id===(Z||O))||null,[q,Z,O]);return e.jsxs("div",{className:"flex h-screen bg-[#09090b] text-foreground font-sans overflow-hidden relative",style:{fontFamily:"'Inter', -apple-system, sans-serif"},children:[e.jsx("div",{className:"absolute top-0 left-0 w-[800px] h-[800px] bg-purple-500/5 rounded-full blur-[120px] pointer-events-none -translate-x-1/4 -translate-y-1/4 z-0"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-[600px] h-[600px] bg-sky-500/5 rounded-full blur-[100px] pointer-events-none translate-x-1/4 -translate-y-1/4 z-0"}),e.jsx("div",{className:"relative z-10 shrink-0",children:e.jsx(Ot,{})}),jt&&e.jsxs("div",{className:"w-[280px] bg-black/20 backdrop-blur-xl border-r border-white/5 shrink-0 flex flex-col z-10 relative shadow-[4px_0_24px_rgba(0,0,0,0.4)]",children:[e.jsxs("div",{className:"h-10 bg-black/40 border-b border-white/5 flex items-center justify-between px-3 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(at,{className:"w-3.5 h-3.5 text-white/40"}),e.jsx("span",{className:"text-[11px] font-bold text-white tracking-widest uppercase",children:"Notebooks"})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:V,className:"p-1 hover:bg-white/10 rounded text-obsidian-muted hover:text-white transition-all active:scale-95",title:"Refresh",children:e.jsx(Gt,{className:"w-3 h-3"})}),e.jsx("button",{onClick:Ve,className:"p-1 hover:bg-white/10 rounded text-obsidian-muted hover:text-white transition-all active:scale-95",title:"New notebook",children:e.jsx(ye,{className:"w-3 h-3"})})]})]}),e.jsx("div",{className:"flex-1 overflow-auto py-2 custom-scrollbar",children:f.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-obsidian-muted gap-2",children:[e.jsx(at,{className:"w-4 h-4 opacity-50"}),e.jsx("span",{className:"text-[10px]",children:"No notebooks saved."})]}):e.jsx("div",{className:"flex flex-col pl-2 pr-2",children:f.map(t=>{const o=m===t.name;return e.jsxs("div",{onClick:()=>he(t.name),className:R("flex items-center gap-1.5 py-1.5 px-2 hover:bg-white/5 rounded-md transition-colors cursor-pointer group relative",o?"bg-white/10":""),children:[e.jsx(Ke,{className:R("w-3.5 h-3.5",o?"text-white/80":"text-obsidian-muted group-hover:text-white/80")}),e.jsx("div",{className:"min-w-0 flex-1",children:e.jsx("span",{className:R("truncate block text-[12px] font-medium",o?"text-white":"text-foreground/70 group-hover:text-white"),children:t.name})}),e.jsx("button",{onClick:n=>_t(t.name,n),className:"opacity-0 group-hover:opacity-100 p-1 hover:bg-red-500/20 text-white/40 hover:text-red-400 rounded transition-all active:scale-95",title:"Delete Notebook",children:e.jsx(Ie,{className:"w-3 h-3"})})]},t.filename)})})})]}),e.jsxs("main",{className:"flex-1 flex flex-col min-w-0 bg-transparent backdrop-blur-xl relative z-10",children:[e.jsxs("div",{className:"flex items-center px-4 justify-between shrink-0 h-10 bg-black/40 backdrop-blur-md border-b border-white/5 z-10 relative",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-[1px] bg-white/10"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>se(!de),className:"p-1.5 hover:bg-white/10 rounded-md text-obsidian-muted hover:text-white transition-all active:scale-95 border border-transparent hover:border-white/10",title:"Toggle Notebooks Explorer",children:e.jsx(Jt,{className:"w-4 h-4"})}),e.jsx("div",{className:"w-[1px] h-4 bg-white/10 mx-1"}),e.jsxs("div",{className:"flex items-center gap-0 text-[12px]",children:[[{label:"File",items:[{label:"New Notebook",shortcut:"",action:()=>Ve(),icon:e.jsx(ye,{className:"w-3.5 h-3.5"})},{label:"Save",shortcut:"⌘S",action:()=>Le(),icon:e.jsx(Qt,{className:"w-3.5 h-3.5"})},{label:"Export as .ipynb",shortcut:"",action:()=>Tt(),icon:e.jsx(dt,{className:"w-3.5 h-3.5"})},{label:"Export as .py",shortcut:"",action:()=>qt(),icon:e.jsx(dt,{className:"w-3.5 h-3.5"})},{divider:!0},{label:"Rename",shortcut:"",action:()=>{A(m),v(!0)},icon:e.jsx(Ke,{className:"w-3.5 h-3.5"})}]},{label:"Edit",items:[{label:"Cut Cell",shortcut:"⌘X",action:()=>At(),icon:e.jsx(vo,{className:"w-3.5 h-3.5"})},{label:"Copy Cell",shortcut:"⌘C",action:()=>It(),icon:e.jsx(Kt,{className:"w-3.5 h-3.5"})},{label:"Paste Cell Below",shortcut:"⌘V",action:()=>Rt(),icon:e.jsx(ro,{className:"w-3.5 h-3.5"}),disabled:!xe},{divider:!0},{label:"Clear All Outputs",shortcut:"",action:()=>Et(),icon:e.jsx(io,{className:"w-3.5 h-3.5"})},{label:"Delete Cell",shortcut:"⌫",action:()=>{a.length>1&&Me(l)},icon:e.jsx(Ie,{className:"w-3.5 h-3.5"}),disabled:a.length<=1}]},{label:"View",items:[{label:de?"Hide Sidebar":"Show Sidebar",shortcut:"",action:()=>se(!de),icon:e.jsx(go,{className:"w-3.5 h-3.5"})}]},{label:"Run",items:[{label:"Run Cell",shortcut:"⇧↵",action:()=>ie(l),icon:e.jsx(Ee,{className:"w-3.5 h-3.5"})},{label:"Run All",shortcut:"⌘⇧↵",action:()=>fe(),icon:e.jsx(Ee,{className:"w-3.5 h-3.5"})},{divider:!0},{label:"Run All Above",shortcut:"",action:()=>Mt(),icon:e.jsx(kt,{className:"w-3.5 h-3.5"})},{label:"Run All Below",shortcut:"",action:()=>$t(),icon:e.jsx(He,{className:"w-3.5 h-3.5"})},{divider:!0},{label:"Interrupt Kernel",shortcut:"",action:()=>Ct(),icon:e.jsx(Xt,{className:"w-3.5 h-3.5"})},{label:"Restart Kernel",shortcut:"",action:()=>{confirm("Restart kernel? All variables will be lost.")&&ze()},icon:e.jsx(No,{className:"w-3.5 h-3.5"})},{label:"Restart & Run All",shortcut:"",action:()=>Pt(),icon:e.jsx(Vt,{className:"w-3.5 h-3.5"})}]},{label:"Help",items:[{label:"Keyboard Shortcuts",shortcut:"",action:()=>E(!0),icon:e.jsx(po,{className:"w-3.5 h-3.5"})}]}].map(t=>e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:o=>{o.stopPropagation(),c(H===t.label?null:t.label)},className:R("px-2.5 py-1 rounded transition-colors tracking-wide",H===t.label?"text-white bg-white/10":"text-white/50 hover:text-white hover:bg-white/5"),children:t.label}),H===t.label&&e.jsx("div",{className:"absolute top-full left-0 mt-1 w-56 bg-[#1a1a1e] border border-white/10 rounded-lg shadow-2xl z-50 overflow-hidden py-1 backdrop-blur-xl",onClick:o=>o.stopPropagation(),children:t.items.map((o,n)=>o.divider?e.jsx("div",{className:"h-px bg-white/10 my-1 mx-2"},n):e.jsxs("button",{onClick:()=>{o.action(),c(null)},disabled:o.disabled,className:"w-full flex items-center gap-2.5 px-3 py-1.5 text-[12px] text-white/70 hover:text-white hover:bg-white/10 transition-colors disabled:opacity-30 disabled:cursor-not-allowed",children:[e.jsx("span",{className:"text-white/40",children:o.icon}),e.jsx("span",{className:"flex-1 text-left",children:o.label}),o.shortcut&&e.jsx("span",{className:"text-[10px] text-white/30 font-mono",children:o.shortcut})]},n))})]},t.label)),e.jsx("div",{className:"w-px h-4 bg-white/10 mx-2"}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:t=>{t.stopPropagation(),c(H==="lang"?null:"lang")},className:R("flex items-center gap-1 px-2 py-1 rounded font-medium transition-colors",H==="lang"?"text-white bg-white/10":"text-white/80 hover:bg-white/5"),children:[e.jsx("span",{children:T==="python"?"Python":"SQL"}),e.jsx(He,{className:"w-3 h-3 text-white/40"})]}),H==="lang"&&e.jsx("div",{className:"absolute top-full left-0 mt-1 w-40 bg-[#1a1a1e] border border-white/10 rounded-lg shadow-2xl z-50 overflow-hidden py-1 backdrop-blur-xl",onClick:t=>t.stopPropagation(),children:[{id:"python",label:"Python"},{id:"sql",label:"SQL"}].map(t=>e.jsxs("button",{onClick:()=>{W(t.id),c(null)},className:R("w-full flex items-center gap-2.5 px-3 py-1.5 text-[12px] transition-colors",T===t.id?"text-white bg-white/10":"text-white/70 hover:text-white hover:bg-white/10"),children:[T===t.id&&e.jsx(ct,{className:"w-3 h-3 text-white/60"}),T!==t.id&&e.jsx("div",{className:"w-3 h-3"}),e.jsx("span",{children:t.label})]},t.id))})]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:fe,disabled:j!=="idle",className:"flex items-center gap-1.5 px-3 py-1 rounded hover:bg-white/10 disabled:opacity-50 transition-colors text-white/70 hover:text-white font-medium text-[11px]",children:[e.jsx(Ee,{className:"w-3.5 h-3.5"})," Run all"]}),e.jsxs("div",{className:"hidden md:flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-1 rounded border border-white/10 bg-white/[0.03]",children:[e.jsx(it,{className:"w-3 h-3 text-white/50"}),e.jsx("select",{value:O,onChange:t=>Se(t.target.value),className:"bg-transparent text-[11px] text-white/80 font-medium outline-none",disabled:Te||j==="busy",children:q.map(t=>e.jsxs("option",{value:t.id,className:"bg-[#1a1a1e] text-white",children:[t.label," - ",Ue(t)]},t.id))})]}),e.jsxs("button",{onClick:St,disabled:!p||Te||j==="busy"||!O||!ne||O===Z,className:"flex items-center gap-1.5 px-2.5 py-1 rounded border border-white/10 text-[11px] text-white/70 hover:text-white hover:bg-white/10 disabled:opacity-40 disabled:cursor-not-allowed transition-colors",title:"Attach selected cluster profile",children:[Te?e.jsx(Ae,{className:"w-3 h-3 animate-spin"}):e.jsx(ut,{className:"w-3 h-3"}),"Attach"]}),((S==null?void 0:S.spark_ui_url)||(S==null?void 0:S.spark_master_ui_url))&&e.jsxs("a",{href:(S==null?void 0:S.spark_ui_url)||(S==null?void 0:S.spark_master_ui_url)||"#",target:"_blank",rel:"noreferrer",className:"flex items-center gap-1 px-2 py-1 rounded border border-white/10 text-[11px] text-white/60 hover:text-white hover:bg-white/10 transition-colors",title:"Open Spark UI",children:[e.jsx(Yt,{className:"w-3 h-3"})," Spark UI"]})]}),me&&e.jsxs("div",{className:"hidden xl:flex items-center gap-2 text-[10px] font-mono max-w-[640px]",children:[e.jsxs("span",{className:"text-white/45 truncate",children:[me.label,": ",Ue(me)]}),Pe(me)&&e.jsx("span",{className:"text-white/55 whitespace-nowrap",children:Pe(me)}),((et=me.shuffle_tuning)==null?void 0:et.status)==="low"&&e.jsx("span",{className:"px-1.5 py-0.5 rounded border border-amber-400/30 text-amber-300/90 whitespace-nowrap",children:"Shuffle Low"}),((tt=me.shuffle_tuning)==null?void 0:tt.status)==="high"&&e.jsx("span",{className:"px-1.5 py-0.5 rounded border border-rose-400/30 text-rose-300/90 whitespace-nowrap",children:"Shuffle High"})]}),e.jsx("div",{className:"w-px h-4 bg-obsidian-border/50 mx-1"}),e.jsx("button",{onClick:Le,className:"px-3 py-1 rounded hover:bg-white/10 transition-colors text-white/60 hover:text-white text-[11px] font-medium",children:"Save"})]})]}),e.jsx("div",{className:"flex items-end overflow-x-auto shrink-0 bg-black/40 backdrop-blur-md h-[38px] w-full border-b border-white/5 custom-scrollbar",children:C.map(t=>{const o=M?t===$:t===m,n=o&&M?m:t;return e.jsxs("div",{onClick:()=>{o||he(t)},className:R("relative flex items-center justify-between cursor-pointer select-none group h-[38px] min-w-[140px] max-w-[220px] px-3 transition-colors",o?"bg-white/[0.04] text-white":"text-white/40 hover:text-white/80 hover:bg-white/[0.02]"),style:{borderTop:o?"2px solid rgba(255,255,255,0.2)":"2px solid transparent",borderRight:"1px solid rgba(255,255,255,0.05)",fontSize:"13px"},children:[e.jsxs("div",{className:"flex items-center gap-2.5 truncate",children:[e.jsx(Ke,{className:R("w-3.5 h-3.5 flex-shrink-0",o?"text-white/50":"text-white/30 group-hover:text-white/50")}),o&&M?e.jsx("input",{autoFocus:!0,className:"text-[13px] font-medium text-white bg-transparent outline-none w-32 tracking-wide",value:m,onChange:s=>k(s.target.value),onBlur:()=>{Xe()},onKeyDown:s=>{s.key==="Enter"&&Xe()},onClick:s=>s.stopPropagation()}):e.jsx("span",{className:"truncate font-medium tracking-wide",onClick:s=>{s.stopPropagation(),o?(A(m),v(!0)):he(t)},title:o?"Click to rename":t,children:n})]}),e.jsx("div",{className:"flex items-center gap-1.5 ml-3",children:e.jsx(je,{onClick:s=>Lt(t,s),className:R("w-3.5 h-3.5 rounded-sm transition-all flex-shrink-0 hover:bg-white/20",o?"opacity-50 hover:opacity-100":"opacity-0 group-hover:opacity-50 hover:opacity-100")})})]},t)})}),e.jsx("div",{className:"flex-1 relative flex flex-col min-h-0 bg-transparent custom-scrollbar",children:e.jsxs("div",{className:"flex-1 py-4 px-6 flex flex-col gap-2 items-center w-full max-w-[1440px] mx-auto custom-scrollbar",children:[a.map((t,o)=>e.jsx("div",{className:"w-full",children:e.jsx(Io,{cell:t,index:o,total:a.length,isActive:l===t.id,onActivate:()=>x(t.id),onUpdate:n=>{"source"in n&&typeof n.source=="string"?zt(t.id,n.source):ae(t.id,n)},onDelete:()=>Me(t.id),onMoveUp:()=>Ye(t.id,"up"),onMoveDown:()=>Ye(t.id,"down"),onRun:()=>ie(t.id),onAddBelow:n=>Fe(t.id,n),sqlSuggestionItems:K,loadSqlColumns:vt,sqlKeywordItems:F,pythonKeywordItems:P,pythonSymbolItems:Nt})},t.id)),e.jsx("div",{className:"w-full flex justify-center py-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>{var t;return Fe((t=a[a.length-1])==null?void 0:t.id,"code")},className:"flex items-center gap-1 px-3 py-1.5 border border-white/10 bg-white/5 rounded text-[11px] text-white/60 hover:text-white hover:border-white/20 hover:bg-white/10 transition-colors shadow-sm",children:[e.jsx(ye,{className:"w-3.5 h-3.5"})," Code"]}),e.jsxs("button",{onClick:()=>{var t;return Fe((t=a[a.length-1])==null?void 0:t.id,"markdown")},className:"flex items-center gap-1 px-3 py-1.5 border border-white/10 bg-white/5 rounded text-[11px] text-white/60 hover:text-white hover:border-white/20 hover:bg-white/10 transition-colors shadow-sm",children:[e.jsx(ye,{className:"w-3.5 h-3.5"})," Markdown"]})]})})]})}),e.jsxs("div",{className:"h-8 bg-black/60 backdrop-blur-xl border-t border-white/5 flex items-center justify-between px-4 shrink-0 text-[10.5px] font-mono text-obsidian-muted/80 z-20",children:[e.jsxs("div",{className:"flex items-center gap-4 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[j==="idle"&&e.jsx(ct,{className:"w-3 h-3 text-white/40"}),j==="busy"&&e.jsx(Ae,{className:"w-3 h-3 text-white/60 animate-spin"}),j==="starting"&&e.jsx(Ae,{className:"w-3 h-3 text-white/40 animate-spin"}),j==="disconnected"&&e.jsx(je,{className:"w-3 h-3 text-white/30"}),e.jsxs("span",{children:["Jupyter API: ",e.jsx("span",{className:"text-white/80 capitalize",children:j})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Ut,{className:"w-3 h-3"}),e.jsxs("span",{children:["Engine: ",e.jsx("span",{className:"text-foreground/80 uppercase",children:ve})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(it,{className:"w-3 h-3"}),e.jsxs("span",{children:["Cluster: ",e.jsx("span",{className:"text-foreground/80",children:Z||O||ke})]})]}),be&&e.jsxs("div",{className:"flex items-center gap-1.5 truncate",children:[e.jsx("span",{children:Ue(be)}),Pe(be)&&e.jsx("span",{className:"text-white/65",children:Pe(be)}),xt(be)==="Shuffle Low"&&e.jsx("span",{className:"px-1 py-0.5 rounded border border-amber-400/35 text-amber-300/90 whitespace-nowrap",children:"Shuffle Low"}),xt(be)==="Shuffle High"&&e.jsx("span",{className:"px-1 py-0.5 rounded border border-rose-400/35 text-rose-300/90 whitespace-nowrap",children:"Shuffle High"})]}),!ne&&e.jsx("div",{className:"flex items-center gap-1.5 truncate",children:e.jsx("span",{children:"Cluster API: legacy backend (attach/observability disabled)"})}),(S==null?void 0:S.workers)&&e.jsxs("div",{className:"flex items-center gap-1.5 truncate",children:[e.jsx(ut,{className:"w-3 h-3"}),e.jsxs("span",{children:["Workers ",S.workers.count," · Cores ",S.workers.cores_used,"/",S.workers.cores_total," · Mem ",Math.round((S.workers.memory_used_mb||0)/1024),"G/",Math.round((S.workers.memory_total_mb||0)/1024),"G"]})]}),((ot=S==null?void 0:S.logs)==null?void 0:ot[0])&&e.jsx("div",{className:"flex items-center gap-1.5 truncate",children:e.jsxs("span",{children:["Jobs ",S.logs[0].running_jobs," · Stages ",S.logs[0].active_stages]})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(yt,{className:"w-3 h-3"}),e.jsxs("span",{children:[a.length," cells"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 font-mono",children:[e.jsx("span",{children:"Ln 1, Col 1"}),e.jsx("span",{children:"UTF-8"}),e.jsx("span",{children:(((st=a.find(t=>t.id===l))==null?void 0:st.language)||T)==="python"?"Python":"SQL"})]})]})]}),ue&&e.jsx("div",{className:"absolute right-4 bottom-12 z-[120] max-w-md",children:e.jsxs("div",{className:R("flex items-start gap-2 rounded-lg border px-3 py-2 shadow-2xl backdrop-blur-md",ue.tone==="success"&&"border-emerald-400/40 bg-emerald-500/15 text-emerald-300",ue.tone==="error"&&"border-rose-400/40 bg-rose-500/15 text-rose-300",ue.tone==="info"&&"border-cyan-400/40 bg-cyan-500/15 text-cyan-300"),children:[e.jsx("div",{className:"text-[11px] leading-5",children:ue.message}),e.jsx("button",{onClick:()=>Q(null),className:"ml-1 text-current/80 hover:text-current","aria-label":"Dismiss notification",children:e.jsx(je,{className:"w-3.5 h-3.5"})})]})}),N&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm",onClick:()=>E(!1),children:e.jsxs("div",{className:"bg-[#1a1a1e] border border-white/10 rounded-xl shadow-2xl w-[520px] max-h-[70vh] overflow-auto",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-3 border-b border-white/10",children:[e.jsx("h2",{className:"text-white font-semibold text-sm tracking-wide",children:"Keyboard Shortcuts"}),e.jsx("button",{onClick:()=>E(!1),className:"p-1 hover:bg-white/10 rounded transition-colors text-white/40 hover:text-white",children:e.jsx(je,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"p-5 space-y-3 text-[12px]",children:[{keys:"⇧ Enter",desc:"Run cell and move to next"},{keys:"⌘ Enter",desc:"Run cell in place"},{keys:"⌘ S",desc:"Save notebook"},{keys:"⌘ ⇧ Enter",desc:"Run all cells"},{keys:"⌘ ⇧ P",desc:"Open command palette (Editor)"},{keys:"Esc",desc:"Exit edit mode (focus cell)"},{keys:"%sql",desc:"Switch cell language to SQL (magic command)"},{keys:"%python",desc:"Switch cell language to Python (magic command)"},{keys:"%md",desc:"Switch cell to Markdown (magic command)"}].map((t,o)=>e.jsxs("div",{className:"flex items-center justify-between py-1.5 border-b border-white/5 last:border-0",children:[e.jsx("span",{className:"text-white/70",children:t.desc}),e.jsx("kbd",{className:"px-2 py-0.5 bg-white/5 border border-white/10 rounded text-white/60 font-mono text-[11px]",children:t.keys})]},o))})]})})]})}export{Yo as default};
