import{r as i,R as Qe,j as e}from"./index-B_OPaOyb.js";import{c as J,S as Wt,B as pt,l as Ve,b as R,f as Gt,P as ze,j as xt,T as Zt,I as Jt,L as Qt,M as Vt,E as ft}from"./Sidebar-BN_K4hAM.js";import{L as Xt,P as Ce,C as bt,F as Yt}from"./index-DQw_Y-Pu.js";import{R as en}from"./refresh-cw-ArZ6UI2R.js";import{T as Ke}from"./trash-2-Ck8O8C7R.js";import{L as tn}from"./layout-panel-left-K445IE6E.js";import{S as gt}from"./save-DoiHSqxD.js";import{D as wt,R as nn}from"./rotate-ccw-DVNvHXhG.js";import{C as Oe}from"./chevron-down-ClltgbQ9.js";import{C as on}from"./circle-stop-j1WbtuBG.js";import{L as Fe}from"./loader-circle-B4C5lNkV.js";import{E as sn}from"./external-link-J5B9jGZ5.js";import{X as Ae}from"./x-BF0uZMsE.js";import{A as rn}from"./activity-Co4YgDOK.js";import{C as _t}from"./code-xml-Cc3LmDEz.js";import{S as an}from"./sparkles-BpB7ifJi.js";import{M as Xe,r as Ye}from"./index-ZMZMIZW_.js";/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ln=[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]],cn=J("bold",ln);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dn=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Lt=J("chevron-up",dn);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const un=[["path",{d:"M11 14h10",key:"1w8e9d"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v1.344",key:"1e62lh"}],["path",{d:"m17 18 4-4-4-4",key:"z2g111"}],["path",{d:"M8 4H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 1.793-1.113",key:"bjbb7m"}],["rect",{x:"8",y:"2",width:"8",height:"4",rx:"1",key:"ublpy"}]],hn=J("clipboard-paste",un);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mn=[["path",{d:"M21 21H8a2 2 0 0 1-1.42-.587l-3.994-3.999a2 2 0 0 1 0-2.828l10-10a2 2 0 0 1 2.829 0l5.999 6a2 2 0 0 1 0 2.828L12.834 21",key:"g5wo59"}],["path",{d:"m5.082 11.09 8.828 8.828",key:"1wx5vj"}]],pn=J("eraser",mn);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xn=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],fn=J("grip-vertical",xn);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bn=[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]],gn=J("italic",bn);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wn=[["path",{d:"M10 8h.01",key:"1r9ogq"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M14 8h.01",key:"1primd"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"M18 8h.01",key:"emo2bl"}],["path",{d:"M6 8h.01",key:"x9i8wu"}],["path",{d:"M7 16h10",key:"wp8him"}],["path",{d:"M8 12h.01",key:"czm47f"}],["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}]],yn=J("keyboard",wn);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kn=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],Nn=J("link",kn);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vn=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}]],jn=J("panel-left",vn);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cn=[["path",{d:"M16 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"rib7q0"}],["path",{d:"M5 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"1ymkrd"}]],Sn=J("quote",Cn);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _n=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],Ln=J("rotate-cw",_n);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mn=[["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M8.12 8.12 12 12",key:"1alkpv"}],["path",{d:"M20 4 8.12 15.88",key:"xgtan2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M14.8 14.8 20 20",key:"ptml3r"}]],An=J("scissors",Mn),yt=s=>!s||s<=0?"0G":`${(s/1024).toFixed(s%1024===0?0:1)}G`,qe=s=>{if(!s)return"-";const a=s.effective_resources||s.resources||{},u=s.available_resources||{},l=Number(u.total_cores||0),m=Number(u.total_memory_mb||0),p=Number(a.shuffle_partitions||0);if(l>0||m>0)return`Avail ${l} cores · ${yt(m)} RAM · shuffle ${p}`;const w=Number(a.total_cores||0),k=yt(Number(a.total_memory_mb||0));return`${w} cores · ${k} RAM · shuffle ${p}`},kt=s=>{if(!(s!=null&&s.shuffle_tuning))return"";const a=s.shuffle_tuning,u=Number(a.current||0),l=Number(a.recommended||0);return!u||!l?"":`shuffle ${u} (recommended ~${l})`},Nt=s=>{var u;const a=(u=s==null?void 0:s.shuffle_tuning)==null?void 0:u.status;return a==="low"?"Shuffle Low":a==="high"?"Shuffle High":""},vt=s=>{window.dispatchEvent(new CustomEvent("openclaw:notebooks-notice",{detail:{message:s}}))},he=()=>Math.random().toString(36).substring(2,10),ge=s=>`"${String(s).replace(/"/g,'""')}"`,Pn=s=>String(s).replace(/'/g,"''"),Me=(s,a=[])=>{if(!s||typeof s!="object")return null;for(const u of a){const l=s[u];if(l!=null&&String(l).trim())return String(l).trim()}for(const u of Object.values(s))if(u!=null&&String(u).trim())return String(u).trim();return null},jt=async(s,a,u)=>{var l,m;try{const p=(m=(l=s==null?void 0:s.languages)==null?void 0:l.getLanguages)==null?void 0:m.call(l).find(h=>(h==null?void 0:h.id)===a);if(!p||typeof p.loader!="function")return[];const w=await p.loader(),k=(w==null?void 0:w.language)||{},N=new Set;for(const h of u){const v=k==null?void 0:k[h];if(Array.isArray(v))for(const P of v){const j=String(P||"").trim();j&&N.add(j)}}return Array.from(N)}catch{return[]}},$n=s=>/^[A-Za-z_][A-Za-z0-9_]*$/.test(s),En=s=>{var u;const a=new Set;for(const l of s){if(l.cell_type!=="code"||l.language!=="python")continue;const m=String(l.source||"").split(`
`);for(const p of m){const w=p.trim();if(!w||w.startsWith("#"))continue;const k=w.match(/^def\s+([A-Za-z_][A-Za-z0-9_]*)\s*\(/);if(k){a.add(k[1]);continue}const N=w.match(/^class\s+([A-Za-z_][A-Za-z0-9_]*)\s*[\(:]/);if(N){a.add(N[1]);continue}const h=w.match(/^import\s+(.+)$/);if(h){const j=h[1].split(",");for(const _ of j){const T=_.trim();if(!T)continue;const C=T.match(/\s+as\s+([A-Za-z_][A-Za-z0-9_]*)$/);if(C){a.add(C[1]);continue}const L=(u=T.split(".")[0])==null?void 0:u.trim();L&&$n(L)&&a.add(L)}continue}const v=w.match(/^from\s+[A-Za-z0-9_\.]+\s+import\s+(.+)$/);if(v){const j=v[1].split(",");for(const _ of j){const T=_.trim();if(!T||T==="*")continue;const C=T.match(/^([A-Za-z_][A-Za-z0-9_]*)(?:\s+as\s+([A-Za-z_][A-Za-z0-9_]*))?$/);C&&a.add(C[2]||C[1])}continue}const P=w.match(/^([A-Za-z_][A-Za-z0-9_]*)\s*=/);P&&a.add(P[1])}}return Array.from(a).sort((l,m)=>l.localeCompare(m))},je={id:he(),cell_type:"code",source:"",language:"python",outputs:[],execution_count:null,running:!1},Rn=(s,a)=>a==="catalog"?s.languages.CompletionItemKind.Module:a==="schema"?s.languages.CompletionItemKind.Struct:a==="table"?s.languages.CompletionItemKind.Value:a==="view"?s.languages.CompletionItemKind.Interface:a==="column"?s.languages.CompletionItemKind.Field:s.languages.CompletionItemKind.Function,Ct=(s,a,u,l)=>{const m=s;m.__openclawNotebookSqlSuggestionSource=a,m.__openclawNotebookSqlColumnLoader=u,m.__openclawNotebookSqlKeywordSource=l,!m.__openclawNotebookSqlAutocompleteRegistered&&(m.__openclawNotebookSqlAutocompleteRegistered=!0,s.languages.registerCompletionItemProvider("sql",{triggerCharacters:[" ","."],provideCompletionItems:async(p,w)=>{const k=m.__openclawNotebookSqlSuggestionSource,N=typeof k=="function"?k():[],h=m.__openclawNotebookSqlKeywordSource,v=typeof h=="function"?h():[],P=p.getWordUntilPosition(w),j={startLineNumber:w.lineNumber,endLineNumber:w.lineNumber,startColumn:P.startColumn,endColumn:P.endColumn},T=p.getValueInRange({startLineNumber:w.lineNumber,startColumn:1,endLineNumber:w.lineNumber,endColumn:w.column}).match(/([A-Za-z0-9_]+(?:\.[A-Za-z0-9_]+)*)\.\s*$/),C=T?T[1].toLowerCase():null,L=(P.word||"").toLowerCase();let b=N;if(C){const $=C.split(".").length;if(b=N.filter(q=>q.fqn.toLowerCase().startsWith(C+".")&&q.fqn.toLowerCase().split(".").length===$+1),b.length===0&&$>=3){const q=m.__openclawNotebookSqlColumnLoader;if(typeof q=="function")try{b=await q(C)}catch{b=[]}}}else L&&(b=N.filter($=>$.label.toLowerCase().startsWith(L)));const Q=C?[]:v.filter($=>!L||$.toLowerCase().startsWith(L)).map($=>({label:$.toUpperCase(),kind:s.languages.CompletionItemKind.Keyword,insertText:$.toUpperCase(),detail:"sql keyword",range:j,sortText:`0_${$}`})),oe=b.map($=>({label:$.label,kind:Rn(s,$.kind),insertText:$.label,detail:$.detail,range:j,sortText:`1_${$.fqn}`})),ae=new Set;return{suggestions:[...Q,...oe].filter($=>{const q=String($.label).toLowerCase();return ae.has(q)?!1:(ae.add(q),!0)})}}}))},St=(s,a,u)=>{const l=s;l.__openclawNotebookPythonKeywordSource=a,l.__openclawNotebookPythonSymbolSource=u,!l.__openclawNotebookPythonAutocompleteRegistered&&(l.__openclawNotebookPythonAutocompleteRegistered=!0,s.languages.registerCompletionItemProvider("python",{triggerCharacters:[".","_"],provideCompletionItems:(m,p)=>{const w=l.__openclawNotebookPythonKeywordSource,k=l.__openclawNotebookPythonSymbolSource,N=typeof w=="function"?w():[],h=typeof k=="function"?k():[],v=m.getWordUntilPosition(p),P=(v.word||"").toLowerCase(),j={startLineNumber:p.lineNumber,endLineNumber:p.lineNumber,startColumn:v.startColumn,endColumn:v.endColumn},_=N.filter(b=>!P||b.toLowerCase().startsWith(P)).map(b=>({label:b,kind:s.languages.CompletionItemKind.Keyword,insertText:b,detail:"python keyword",range:j,sortText:`0_${b}`})),T=h.filter(b=>!P||b.toLowerCase().startsWith(P)).map(b=>({label:b,kind:s.languages.CompletionItemKind.Variable,insertText:b,detail:"notebook symbol",range:j,sortText:`1_${b}`})),C=new Set;return{suggestions:[..._,...T].filter(b=>{const Q=String(b.label).toLowerCase();return C.has(Q)?!1:(C.add(Q),!0)})}}}))};function In({output:s}){const a=s.name==="stderr";return e.jsx("div",{className:R("px-4 py-3 font-mono text-[11.5px] whitespace-pre-wrap leading-relaxed rounded-b-md border border-obsidian-border/40 shadow-inner",a?"text-obsidian-danger bg-[#2b1010]":"text-foreground bg-[#1e1e1e]"),children:s.text})}function Tn({data:s}){var a;return(a=s==null?void 0:s.columns)!=null&&a.length?e.jsxs("div",{className:"overflow-auto max-h-[400px] border-t border-obsidian-border bg-obsidian-bg",children:[e.jsxs("table",{className:"w-full text-left border-collapse font-sans text-[11px]",children:[e.jsx("thead",{className:"sticky top-0 bg-obsidian-panel z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-1.5 border-b border-r border-obsidian-border font-medium text-obsidian-muted w-10 text-center",children:"#"}),s.columns.map((u,l)=>e.jsx("th",{className:"px-3 py-1.5 border-b border-r border-obsidian-border font-semibold text-obsidian-info truncate",children:u},l))]})}),e.jsx("tbody",{children:s.rows.map((u,l)=>e.jsxs("tr",{className:"hover:bg-white/5 transition-colors",children:[e.jsx("td",{className:"px-3 py-1 border-b border-r border-obsidian-border text-obsidian-muted font-mono text-[10px] text-center",children:l+1}),u.map((m,p)=>e.jsx("td",{className:"px-3 py-1 border-b border-r border-obsidian-border text-foreground/90 truncate max-w-[300px]",title:String(m),children:m===null?e.jsx("span",{className:"text-obsidian-muted italic",children:"null"}):String(m)},p))]},l))})]}),e.jsxs("div",{className:"bg-obsidian-panel px-3 py-1 text-[10px] text-obsidian-muted border-b border-obsidian-border flex justify-between",children:[e.jsxs("span",{children:[s.rows.length," rows"]}),e.jsxs("span",{children:[s.columns.length," columns"]})]})]}):null}function qn({output:s}){return e.jsxs("div",{className:"bg-obsidian-danger/5 overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-2 text-[11px] font-semibold text-obsidian-danger flex items-center gap-1.5",children:[e.jsx(Ae,{className:"w-3.5 h-3.5"}),e.jsxs("span",{children:[s.ename,": ",s.evalue]})]}),s.traceback&&s.traceback.length>0&&e.jsx("div",{className:"px-4 pb-2",children:e.jsx("pre",{className:"text-[10px] font-mono text-obsidian-danger/70 whitespace-pre-wrap leading-relaxed",children:s.traceback.join(`
`).replace(/\u001b\[[0-9;]*m/g,"")})})]})}function zn({output:s}){var u;const a=s.data;return a?(u=a["application/json"])!=null&&u.columns?e.jsx(Tn,{data:a["application/json"]}):a["text/markdown"]?e.jsx("div",{className:"px-4 py-2 bg-obsidian-bg prose prose-invert prose-sm max-w-none text-foreground/90",children:e.jsx(Xe,{remarkPlugins:[Ye],children:String(a["text/markdown"])})}):a["text/html"]?e.jsx("div",{className:"px-4 py-2 bg-obsidian-bg",children:e.jsx("iframe",{srcDoc:String(a["text/html"]),className:"w-full min-h-[120px] border border-obsidian-border rounded bg-white",sandbox:"",title:"notebook-html-output"})}):a["image/png"]?e.jsx("div",{className:"px-4 py-2 bg-obsidian-bg",children:e.jsx("img",{src:`data:image/png;base64,${a["image/png"]}`,alt:"output",className:"max-w-full rounded border border-obsidian-border"})}):a["text/plain"]?e.jsx("pre",{className:"px-4 py-2 font-mono text-[11px] text-foreground/90 whitespace-pre-wrap bg-obsidian-bg",children:a["text/plain"]}):null:null}function On({outputs:s}){return!s||!s.length?null:e.jsx("div",{className:"flex flex-col gap-2 mt-2",children:s.map((a,u)=>{switch(a.output_type){case"stream":return e.jsx(In,{output:a},u);case"error":return e.jsx(qn,{output:a},u);case"execute_result":case"display_data":return e.jsx(zn,{output:a},u);default:return null}})})}function Fn({cell:s,index:a,total:u,isActive:l,onActivate:m,onUpdate:p,onDelete:w,onMoveUp:k,onMoveDown:N,onRun:h,onRunAndAdvance:v,onAddBelow:P,sqlSuggestionItems:j,loadSqlColumns:_,sqlKeywordItems:T,pythonKeywordItems:C,pythonSymbolItems:L}){const b=i.useRef(null),Q=i.useRef(null),oe=i.useRef(h);oe.current=h;const ae=i.useRef(v);ae.current=v;const Pe=s.source.split(`
`).length,$=Math.max(40,Math.min(Pe*18+16,500)),[q,He]=i.useState($),[V,$e]=i.useState(!1);i.useEffect(()=>{Q.current&&(Ct(Q.current,()=>j,_,()=>T),St(Q.current,()=>C,()=>L))},[j,_,T,C,L]);const I=i.useCallback(d=>{const g=b.current;if(!g)return;const G=g.getModel();if(!G)return;const K=g.getSelection(),M=G.getValueInRange(K)||"";let F="",B=0;switch(d){case"bold":F=M?`**${M}**`:"**bold text**",B=M?0:-2;break;case"italic":F=M?`*${M}*`:"*italic text*",B=M?0:-1;break;case"code":M.includes(`
`)?F=`\`\`\`
${M||"code"}
\`\`\``:F=M?`\`${M}\``:"`code`",B=M?0:-1;break;case"link":F=M?`[${M}](url)`:"[link text](url)",B=-1;break;case"image":F=M?`![${M}](url)`:"![alt text](url)",B=-1;break;case"h1":{const E=K.startLineNumber,O=G.getLineContent(E);F=`# ${O.replace(/^#+\s*/,"")}`,g.executeEdits("toolbar",[{range:{startLineNumber:E,startColumn:1,endLineNumber:E,endColumn:O.length+1},text:F}]),g.focus();return}case"h2":{const E=K.startLineNumber,O=G.getLineContent(E);F=`## ${O.replace(/^#+\s*/,"")}`,g.executeEdits("toolbar",[{range:{startLineNumber:E,startColumn:1,endLineNumber:E,endColumn:O.length+1},text:F}]),g.focus();return}case"h3":{const E=K.startLineNumber,O=G.getLineContent(E);F=`### ${O.replace(/^#+\s*/,"")}`,g.executeEdits("toolbar",[{range:{startLineNumber:E,startColumn:1,endLineNumber:E,endColumn:O.length+1},text:F}]),g.focus();return}case"list":{const E=K.startLineNumber,O=K.endLineNumber,D=[];for(let f=E;f<=O;f++)G.getLineContent(f).startsWith("- ")?D.push({range:{startLineNumber:f,startColumn:1,endLineNumber:f,endColumn:3},text:""}):D.push({range:{startLineNumber:f,startColumn:1,endLineNumber:f,endColumn:1},text:"- "});g.executeEdits("toolbar",D),g.focus();return}case"quote":{const E=K.startLineNumber,O=K.endLineNumber,D=[];for(let f=E;f<=O;f++)G.getLineContent(f).startsWith("> ")?D.push({range:{startLineNumber:f,startColumn:1,endLineNumber:f,endColumn:3},text:""}):D.push({range:{startLineNumber:f,startColumn:1,endLineNumber:f,endColumn:1},text:"> "});g.executeEdits("toolbar",D),g.focus();return}default:return}if(g.executeEdits("toolbar",[{range:K,text:F}]),B&&!M){const E=g.getPosition();E&&g.setPosition({lineNumber:E.lineNumber,column:E.column+B})}g.focus()},[]),me=d=>{d.editor.defineTheme("obsidian",{base:"vs-dark",inherit:!0,rules:[{token:"comment",foreground:"6a737d",fontStyle:"italic"},{token:"keyword",foreground:"c792ea",fontStyle:"bold"},{token:"keyword.sql",foreground:"c792ea",fontStyle:"bold"},{token:"string",foreground:"c3e88d"},{token:"string.sql",foreground:"c3e88d"},{token:"number",foreground:"f78c6c"},{token:"number.sql",foreground:"f78c6c"},{token:"operator",foreground:"89ddff"},{token:"identifier",foreground:"eeffff"},{token:"function",foreground:"82aaff"},{token:"delimiter",foreground:"89ddff"},{token:"type",foreground:"ffcb6b"}],colors:{"editor.background":"#111113","editor.foreground":"#eeffff","editor.selectionBackground":"#2b3040","editor.lineHighlightBackground":"#1a1a1e","editorCursor.foreground":"#c792ea","editorWhitespace.foreground":"#2a2a30","editorIndentGuide.background":"#2a2a30","editorLineNumber.foreground":"#404050"}}),Ct(d,()=>j,_,()=>T),St(d,()=>C,()=>L)},Ue=(d,g)=>{b.current=d,Q.current=g,g.editor.setTheme("obsidian"),d.addAction({id:`run-cell-and-advance-${s.id}`,label:"Run Cell and Advance (Shift+Enter)",keybindings:[g.KeyMod.Shift|g.KeyCode.Enter],run:()=>{ae.current()}}),d.addAction({id:`run-cell-cmd-enter-${s.id}`,label:"Run Cell (Cmd/Ctrl+Enter)",keybindings:[g.KeyMod.CtrlCmd|g.KeyCode.Enter],run:()=>{oe.current()}}),(ie==="sql"||ie==="python")&&d.addAction({id:`trigger-suggest-${ie}-${s.id}`,label:"Trigger Suggest",keybindings:[g.KeyMod.CtrlCmd|g.KeyCode.Space],run:()=>d.trigger("keyboard","editor.action.triggerSuggest",{})})},ie=s.language||"python";return e.jsxs("div",{className:"relative group/cell flex flex-col items-center w-full",children:[e.jsxs("div",{className:"flex w-full max-w-[1240px] 2xl:max-w-[1440px]",children:[e.jsx("div",{className:R("w-8 shrink-0 flex items-start justify-center pt-2.5 transition-opacity cursor-grab",l?"opacity-100":"opacity-0 group-hover/cell:opacity-40 hover:opacity-100"),children:e.jsx(fn,{className:"w-4 h-4 text-obsidian-muted"})}),e.jsxs("div",{className:R("flex-1 flex min-w-0 transition-all duration-200 rounded-md border",s.cell_type==="markdown"&&l?"flex-col":"flex-row",l?"border-white/10 bg-black/20 shadow-sm":"border-transparent hover:border-white/5 bg-transparent"),onClick:m,children:[s.cell_type==="markdown"&&l&&e.jsxs("div",{className:"w-full flex items-center justify-between px-3 py-1.5 border-b border-white/10 bg-white/[0.02] rounded-t-lg",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-obsidian-muted/80",children:[e.jsx("button",{onClick:d=>{d.stopPropagation(),$e(!V)},className:R("px-2.5 py-1 mr-1 text-[11px] font-medium rounded-md border transition-colors",V?"text-white bg-white/10 border-white/20":"text-white/70 bg-transparent hover:bg-white/5 border-transparent"),children:V?"Hide preview":"Show preview"}),e.jsx("button",{onClick:d=>{d.stopPropagation(),I("bold")},className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 transition-colors",title:"Bold (⌘B)",children:e.jsx(cn,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:d=>{d.stopPropagation(),I("italic")},className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 transition-colors",title:"Italic (⌘I)",children:e.jsx(gn,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:d=>{d.stopPropagation(),I("code")},className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 transition-colors",title:"Code",children:e.jsx(_t,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:d=>{d.stopPropagation(),I("link")},className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 transition-colors",title:"Link",children:e.jsx(Nn,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:d=>{d.stopPropagation(),I("image")},className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 transition-colors",title:"Image",children:e.jsx(Jt,{className:"w-3.5 h-3.5"})}),e.jsx("div",{className:"w-px h-3 bg-obsidian-border/60 mx-1"}),e.jsx("button",{onClick:d=>{d.stopPropagation(),I("h1")},className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 transition-colors text-[11px] font-semibold",title:"Heading 1",children:"H1"}),e.jsx("button",{onClick:d=>{d.stopPropagation(),I("h2")},className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 transition-colors text-[11px] font-semibold",title:"Heading 2",children:"H2"}),e.jsx("button",{onClick:d=>{d.stopPropagation(),I("h3")},className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 transition-colors text-[11px] font-semibold",title:"Heading 3",children:"H3"}),e.jsx("button",{onClick:d=>{d.stopPropagation(),I("list")},className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 transition-colors",title:"List",children:e.jsx(Qt,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:d=>{d.stopPropagation(),I("quote")},className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 transition-colors",title:"Quote",children:e.jsx(Sn,{className:"w-3.5 h-3.5"})})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-obsidian-muted",children:[e.jsx("span",{className:"px-2 py-0.5 mr-1 text-[11px] font-medium text-foreground/50 bg-[#252830] rounded border border-white/5",children:"Markdown"}),e.jsx("button",{onClick:d=>{d.stopPropagation(),vt("AI Generate requires an LLM API key configuration. Coming soon!")},className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 text-[#d7aef2] hover:text-[#f3d0ff] transition-colors",title:"AI Generate",children:e.jsx(an,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:d=>{d.stopPropagation(),vt("Expand mode coming soon!")},className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 transition-colors",title:"Expand",children:e.jsx(Vt,{className:"w-3.5 h-3.5"})}),e.jsx("button",{className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 transition-colors",title:"More options",children:e.jsx(ft,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:d=>{d.stopPropagation(),w()},disabled:u<=1,className:"w-6 h-6 flex items-center justify-center rounded text-obsidian-danger/50 hover:text-obsidian-danger hover:bg-obsidian-danger/10 transition-colors disabled:opacity-20",title:"Delete cell",children:e.jsx(Ke,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex-1 flex min-w-0 relative",children:[e.jsx("div",{className:R("shrink-0 flex items-start pt-2 pl-2 pr-1 relative z-10 w-9 transition-opacity",s.cell_type==="markdown"&&!l?"opacity-0 pointer-events-none":"opacity-100"),children:e.jsx("button",{onClick:d=>{d.stopPropagation(),h()},disabled:s.running,className:R("w-6 h-6 flex items-center justify-center rounded-md transition-all",s.running?"text-white/60":"text-obsidian-muted hover:text-white hover:bg-white/10"),title:"Run cell (⌘↵ or ⇧↵)",children:s.running?e.jsx(Fe,{className:"w-4 h-4 animate-spin"}):e.jsx(ze,{className:"w-4 h-4 fill-current"})})}),e.jsxs("div",{className:"flex-1 min-w-0 flex flex-col pt-0.5 relative",children:[s.cell_type==="markdown"&&l&&e.jsx("div",{className:"absolute top-[8px] left-[32px] text-obsidian-muted/40 text-[12px] font-mono pointer-events-none z-10",children:"%md"}),s.cell_type==="markdown"&&!l?e.jsx("div",{className:"prose prose-invert prose-sm max-w-none text-foreground/80 min-h-[40px] px-3 py-2 cursor-text",children:e.jsx(Xe,{remarkPlugins:[Ye],children:s.source||"*Double-click or enter to edit markdown*"})}):e.jsxs("div",{className:R("relative",s.cell_type==="markdown"&&V&&"flex gap-0"),children:[e.jsx("div",{className:R(s.cell_type==="markdown"&&V?"w-1/2 border-r border-obsidian-border/30":"w-full"),children:e.jsx(Yt,{height:q,language:s.cell_type==="markdown"?"markdown":ie,theme:"obsidian",value:s.source,onChange:d=>p({source:d||""}),beforeMount:me,onMount:(d,g)=>{Ue(d,g),d.onDidContentSizeChange(G=>{var K;if(G.contentHeightChanged){const M=Math.max(40,Math.min(G.contentHeight,500));He(M),(K=b.current)!=null&&K.getContainerDomNode()&&(b.current.getContainerDomNode().style.height=`${M}px`)}})},options:{scrollBeyondLastLine:!1,wordWrap:"on",wrappingIndent:"indent",minimap:{enabled:!1},lineNumbers:s.cell_type==="markdown"?"off":"on",lineNumbersMinChars:4,glyphMargin:!1,folding:s.cell_type!=="markdown",fontSize:13,fontFamily:"'JetBrains Mono', 'Fira Code', 'Cascadia Code', monospace",tabSize:4,renderLineHighlight:"all",padding:{top:s.cell_type==="markdown"?24:7,bottom:20},overviewRulerBorder:!1,scrollbar:{vertical:"hidden",horizontal:"auto",alwaysConsumeMouseWheel:!1},automaticLayout:!0,contextmenu:!1,matchBrackets:"near",fontLigatures:!0,quickSuggestions:{other:!0,comments:!1,strings:!1},suggestOnTriggerCharacters:!0,acceptSuggestionOnEnter:"on"}})}),s.cell_type==="markdown"&&V&&e.jsx("div",{className:"w-1/2 overflow-auto px-4 py-3 prose prose-invert prose-sm max-w-none text-foreground/80",style:{maxHeight:q},children:e.jsx(Xe,{remarkPlugins:[Ye],children:s.source||"*Start typing to see preview...*"})})]}),s.outputs&&s.outputs.length>0&&e.jsx("div",{className:"w-full mt-1 border-t border-obsidian-border/30 bg-[#0c0c0d] rounded-b",children:e.jsx(On,{outputs:s.outputs})}),s.cell_type==="markdown"&&l&&e.jsx("div",{className:"w-full flex justify-end px-3 py-1 text-obsidian-muted/50 text-[11px] font-sans absolute bottom-0 right-0 pointer-events-none",children:"Generate (⌘ + I)"})]}),!(s.cell_type==="markdown"&&l)&&e.jsxs("div",{className:R("absolute top-0 right-0 flex items-center pt-1.5 pr-1.5 gap-0.5 transition-opacity z-10 bg-transparent pl-6",l?"opacity-100":"opacity-0 group-hover/cell:opacity-100"),children:[s.cell_type==="code"?e.jsxs("select",{value:s.language,onChange:d=>p({language:d.target.value}),className:"text-[11px] font-medium text-foreground/70 bg-transparent hover:bg-white/5 rounded px-2 py-1 appearance-none cursor-pointer outline-none transition-colors capitalize mr-1",children:[e.jsx("option",{value:"python",className:"bg-obsidian-panel text-foreground",children:"Python"}),e.jsx("option",{value:"sql",className:"bg-obsidian-panel text-foreground",children:"SQL"})]}):e.jsx("span",{className:"text-[11px] font-medium text-foreground/50 px-2 py-1 mr-1",children:"Markdown"}),e.jsx("button",{onClick:d=>{d.stopPropagation(),k()},disabled:a===0,className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 text-foreground/40 hover:text-foreground disabled:opacity-20 transition-colors",title:"Move up",children:e.jsx(Lt,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:d=>{d.stopPropagation(),N()},disabled:a===u-1,className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 text-foreground/40 hover:text-foreground disabled:opacity-20 transition-colors",title:"Move down",children:e.jsx(Oe,{className:"w-3.5 h-3.5"})}),e.jsx("button",{className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 text-foreground/40 hover:text-foreground transition-colors",title:"More options",children:e.jsx(ft,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:d=>{d.stopPropagation(),w()},disabled:u<=1,className:"w-6 h-6 flex items-center justify-center rounded text-obsidian-danger/50 hover:text-obsidian-danger hover:bg-obsidian-danger/10 transition-colors disabled:opacity-20",title:"Delete cell",children:e.jsx(Ke,{className:"w-4 h-4"})})]})]})]})]}),s.cell_type==="markdown"&&l&&e.jsxs("div",{className:"w-full flex-col items-center justify-center text-obsidian-muted/40 text-[11px] font-mono mt-8 leading-loose text-center mb-4 tracking-wide",children:["[Shift+Enter] to run and move to next cell",e.jsx("br",{}),"[Cmd+Shift+P] to open the command palette",e.jsx("br",{}),"[Esc H] to see all keyboard shortcuts"]}),e.jsxs("div",{className:"w-full max-w-[1200px] 2xl:max-w-[1400px] h-6 relative flex items-center justify-center group/divider",children:[e.jsx("div",{className:"w-full h-px bg-obsidian-border/20 group-hover/divider:bg-obsidian-border/40 transition-colors"}),e.jsxs("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex items-center gap-2 opacity-0 group-hover/divider:opacity-100 transition-opacity z-10",children:[e.jsxs("button",{onClick:d=>{d.stopPropagation(),P("code")},className:"flex items-center gap-1 px-2.5 py-1 bg-[#121214] border border-white/10 rounded text-[10px] text-white/50 hover:text-white hover:border-white/20 hover:bg-white/5 transition-colors shadow-sm",title:"Add Code Cell",children:[e.jsx(Ce,{className:"w-3.5 h-3.5"})," Code"]}),e.jsxs("button",{onClick:d=>{d.stopPropagation(),P("markdown")},className:"flex items-center gap-1 px-2.5 py-1 bg-[#121214] border border-white/10 rounded text-[10px] text-white/50 hover:text-white hover:border-white/20 hover:bg-white/5 transition-colors shadow-sm",title:"Add Markdown Cell",children:[e.jsx(Ce,{className:"w-3.5 h-3.5"})," Markdown"]})]})]})]})}function ro(){var dt,ut;const s=Xt(),[a,u]=i.useState([je]),[l,m]=i.useState(je.id),[p,w]=i.useState(null),[k,N]=i.useState("disconnected"),[h,v]=i.useState("Untitled"),[P,j]=i.useState(!1),[_,T]=i.useState(""),[C,L]=i.useState(["Untitled"]),[b,Q]=i.useState([]),[oe,ae]=i.useState(!0),[Pe,$]=i.useState("local"),[q,He]=i.useState("python"),[V,$e]=i.useState(null),[I,me]=i.useState(null),[Ue,ie]=i.useState(!1),[d,g]=i.useState([]),[G,K]=i.useState([]),[M,F]=i.useState([]),[B,E]=i.useState([]),[O,D]=i.useState("small"),[f,we]=i.useState("small"),[H,Be]=i.useState(null),[De,et]=i.useState(!1),[S,tt]=i.useState(null),[nt,ot]=i.useState(!1),[le,st]=i.useState(!0),[pe,X]=i.useState(null),[Se,rt]=i.useState(null),Ee=i.useRef(new Map),ye=i.useRef(null),te=i.useRef(0),Mt=Qe.useMemo(()=>En(a),[a]),_e=i.useCallback(t=>new Promise(n=>{ye.current=n,rt(t)}),[]),We=i.useCallback(t=>{const n=ye.current;ye.current=null,rt(null),n&&n(t)},[]);i.useEffect(()=>{if(!pe)return;const t=window.setTimeout(()=>X(null),3500);return()=>window.clearTimeout(t)},[pe]),i.useEffect(()=>()=>{ye.current&&(ye.current(!1),ye.current=null)},[]),i.useEffect(()=>{const t=n=>{const r=n.detail,o=r==null?void 0:r.message;o&&X({tone:"info",message:o})};return window.addEventListener("openclaw:notebooks-notice",t),()=>window.removeEventListener("openclaw:notebooks-notice",t)},[]),i.useEffect(()=>{if(!s)return;let t=!0;return(async()=>{const[n,r]=await Promise.all([jt(s,"sql",["keywords"]),jt(s,"python",["keywords","builtins","typeKeywords"])]);t&&(K(n),F(r))})(),()=>{t=!1}},[s]);const y=i.useCallback(async(t,n)=>{const r=await fetch(t,n),o=await r.json().catch(()=>({}));if(!r.ok){const c=(o==null?void 0:o.detail)||(o==null?void 0:o.error)||`HTTP ${r.status}`;throw new Error(String(c))}return o},[]),xe=i.useCallback(async(t,n)=>{const r={query:t};n&&(r.catalog=n);const o=await y("/api/trino",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});return Array.isArray(o==null?void 0:o.data)?o.data:[]},[y]),Ge=i.useCallback(async()=>{const t=["iceberg","lakehouse","delta","hive","postgres"],c=new Map,x=ee=>{const Z=`${ee.kind}:${ee.fqn}`.toLowerCase();c.has(Z)||c.set(Z,ee)};try{const de=(await xe("SHOW CATALOGS")).map(A=>Me(A,["Catalog","catalog","catalog_name"])).filter(A=>!!A).filter((A,z,ue)=>ue.findIndex(W=>W.toLowerCase()===A.toLowerCase())===z).sort((A,z)=>{const ue=t.indexOf(A.toLowerCase()),W=t.indexOf(z.toLowerCase()),ve=ue===-1?999:ue,be=W===-1?999:W;return ve!==be?ve-be:A.localeCompare(z)}).slice(0,4);for(const A of de){x({label:A,detail:"catalog",fqn:A,kind:"catalog"});let z=[];try{z=await xe(`SHOW SCHEMAS FROM ${ge(A)}`,A)}catch{z=[]}const ue=z.map(W=>Me(W,["Schema","schema","schema_name"])).filter(W=>!!W).slice(0,8);for(const W of ue){const ve=`${A}.${W}`;x({label:W,detail:`schema (${A})`,fqn:ve,kind:"schema"});let be=[];try{be=await xe(`SELECT table_name, table_type FROM ${ge(A)}.information_schema.tables WHERE table_schema = '${Pn(W)}' ORDER BY table_name LIMIT 200`,A)}catch{try{be=await xe(`SHOW TABLES FROM ${ge(A)}.${ge(W)}`,A)}catch{be=[]}}for(const ht of be){const Je=Me(ht,["table_name","Table","name"]);if(!Je)continue;const mt=(Me(ht,["table_type"])||"TABLE").toUpperCase().includes("VIEW")?"view":"table",Dt=`${ve}.${Je}`;x({label:Je,detail:`${mt} (${ve})`,fqn:Dt,kind:mt})}}}}catch(ee){console.error("Failed to refresh notebook SQL metadata:",ee)}const U=Array.from(c.values()).sort((ee,Z)=>ee.fqn.localeCompare(Z.fqn));g(U),Ee.current.clear()},[xe]),At=i.useCallback(async t=>{const n=t.trim();if(!n)return[];const r=Ee.current.get(n);if(r)return r;const o=n.split(".");if(o.length<3)return[];const c=o[0],x=o[1],U=o.slice(2).join(".");try{const Z=(await xe(`SHOW COLUMNS FROM ${ge(c)}.${ge(x)}.${ge(U)}`,c)).map(de=>Me(de,["Column","column","Field","name"])).filter(Boolean).map(de=>({label:String(de),detail:`column (${n})`,fqn:`${n}.${String(de)}`,kind:"column"}));return Ee.current.set(n,Z),Z.length>0&&g(de=>{const A=new Map;for(const z of de)A.set(`${z.kind}:${z.fqn}`.toLowerCase(),z);for(const z of Z)A.set(`${z.kind}:${z.fqn}`.toLowerCase(),z);return Array.from(A.values()).sort((z,ue)=>z.fqn.localeCompare(ue.fqn))}),Z}catch{return Ee.current.set(n,[]),[]}},[xe]),ne=i.useCallback(async()=>{var t;try{const n=await y("/api/notebook/clusters"),r=Array.isArray(n==null?void 0:n.clusters)?n.clusters:[],o=String((n==null?void 0:n.default_cluster_id)||((t=r[0])==null?void 0:t.id)||"small");return E(r),D(o),we(c=>c&&r.some(x=>x.id===c)?c:o),st(!0),ot(!0),o}catch(n){return console.warn("Notebook cluster API unavailable; falling back to legacy kernel mode.",n),st(!1),E([{id:"default",label:"Default",description:"Legacy notebook backend (cluster API unavailable)",runtime_mode:"legacy",limits:{},runtime:{status:"running",active_sessions:1}}]),D("default"),we("default"),ot(!0),"default"}},[y]),se=i.useCallback(async t=>{if(!le){tt(null);return}const n=(t||H||f||O||"").trim();if(n)try{const r=await y(`/api/notebook/observability?cluster_id=${encodeURIComponent(n)}`),o=Array.isArray(r==null?void 0:r.clusters)?r.clusters[0]:null;tt(o||null)}catch(r){console.error("Failed to refresh cluster observability:",r)}},[le,H,f,O,y]),at=i.useCallback(async t=>{const n=(t||"small").trim();N("starting"),te.current=0;try{const r=le?{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cluster_id:n})}:{method:"POST"},o=await y("/api/notebook/kernels",r);w(o.id),$(o.mode),Be(o.cluster_id||n||null),o.cluster_id&&we(String(o.cluster_id)),N("idle"),await se(o.cluster_id||n||null),ne().catch(()=>{})}catch(r){console.error("Failed to start kernel:",r),te.current=0,N("disconnected")}},[le,y,se,ne]),Ze=i.useCallback(async()=>{if(p){N("starting"),te.current=0;try{const t=await y(`/api/notebook/kernels/${encodeURIComponent(p)}/restart`,{method:"POST"});N("idle"),t!=null&&t.cluster_id&&Be(String(t.cluster_id)),u(n=>n.map(r=>({...r,outputs:[],execution_count:null}))),await se((t==null?void 0:t.cluster_id)||H),ne().catch(()=>{})}catch(t){console.error("Failed to restart kernel:",t),te.current=0,N("disconnected")}}},[p,y,H,se,ne]),Pt=i.useCallback(async()=>{if(p)try{await y(`/api/notebook/kernels/${encodeURIComponent(p)}/interrupt`,{method:"POST"})}catch(t){console.error("Failed to interrupt kernel:",t)}},[p,y]),$t=i.useCallback(async()=>{if(!(!p||!f)){if(!le){X({tone:"error",message:"Bu backend sürümünde cluster attach API yok. openclaw-api containerını güncel kodla yeniden build et."});return}et(!0),N("starting"),te.current=0;try{const t=await y(`/api/notebook/kernels/${encodeURIComponent(p)}/attach`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cluster_id:f,restart:!0})});Be(t.cluster_id||f),N("idle"),u(n=>n.map(r=>({...r,outputs:[],execution_count:null}))),await se(t.cluster_id||f),ne().catch(()=>{})}catch(t){console.error("Failed to attach cluster:",t),te.current=0,N("disconnected"),X({tone:"error",message:`Failed to attach cluster: ${String(t)}`})}finally{et(!1)}}},[le,p,f,y,se,ne]);i.useEffect(()=>{let t=!0;return(async()=>{try{const n=await ne();if(!t)return;await at(n)}catch(n){console.error("Failed to initialize notebook clusters/kernel:",n),t&&N("disconnected")}})(),()=>{t=!1}},[ne,at]),i.useEffect(()=>{if(!nt)return;const t=window.setInterval(()=>{ne().catch(()=>{})},3e4);return()=>window.clearInterval(t)},[nt,ne]),i.useEffect(()=>{if(!H)return;se(H);const t=window.setInterval(()=>{se(H)},8e3);return()=>window.clearInterval(t)},[H,se]),i.useEffect(()=>{Ge();const t=window.setInterval(()=>{Ge()},300*1e3);return()=>window.clearInterval(t)},[Ge]);const Y=i.useCallback(async()=>{try{const t=await y("/api/notebook/files");Q(t.notebooks||[])}catch(t){console.error("Failed to load notebooks:",t)}},[y]);i.useEffect(()=>{Y()},[Y]);const Re=i.useCallback(async()=>{try{const t=await y("/api/notebook/files",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:h,cells:a.map(n=>({id:n.id,cell_type:n.cell_type,source:n.source,language:n.language,outputs:n.outputs,execution_count:n.execution_count}))})});t!=null&&t.name&&t.name!==h&&(v(t.name),L(n=>n.map(r=>r===h?t.name:r))),Y()}catch(t){console.error("Failed to save:",t),X({tone:"error",message:`Failed to save notebook: ${String(t)}`})}},[h,a,Y,y]),it=i.useCallback(async()=>{let t=1,n=`Untitled-${t}`;for(;b.some(o=>o.name===n);)t++,n=`Untitled-${t}`;const r=[{...je,id:he()}];try{const o=await y("/api/notebook/files",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:n,cells:r.map(x=>({id:x.id,cell_type:x.cell_type,source:x.source,language:x.language,outputs:x.outputs,execution_count:x.execution_count}))})}),c=(o==null?void 0:o.name)||n;await Y(),v(c),u(r),m(r[0].id),L(x=>x.includes(c)?x:[...x,c]),j(!1)}catch(o){console.error("Failed to create new notebook:",o),X({tone:"error",message:`Failed to create notebook: ${String(o)}`})}},[b,Y,y]),fe=i.useCallback(async t=>{try{const n=await y(`/api/notebook/files/${encodeURIComponent(t)}`),r=(n.cells||[]).map(c=>({...c,id:c.id||he(),running:!1,outputs:c.outputs||[]})),o={...je,id:he()};v(n.name||t),u(r.length>0?r:[o]),m(r.length>0?r[0].id:o.id),L(c=>c.includes(n.name||t)?c:[...c,n.name||t]),j(!1)}catch(n){console.error("Failed to load notebook:",n),X({tone:"error",message:`Failed to load notebook '${t}': ${String(n)}`})}},[y]),Ie=i.useCallback((t,n="code")=>{const r={id:he(),cell_type:n,source:"",language:q,outputs:[],execution_count:null,running:!1};u(o=>{if(!t)return[...o,r];const c=o.findIndex(U=>U.id===t),x=[...o];return x.splice(c+1,0,r),x}),m(r.id)},[q]),ce=i.useCallback((t,n)=>{u(r=>r.map(o=>o.id===t?{...o,...n}:o))},[]),Te=i.useCallback(t=>{u(n=>{if(n.length<=1)return n;const r=n.findIndex(c=>c.id===t),o=n.filter(c=>c.id!==t);return l===t&&m(o[Math.min(r,o.length-1)].id),o})},[l]),Et=i.useCallback(async(t,n)=>{if(n.stopPropagation(),!!await _e({title:"Delete notebook?",message:`This will permanently delete '${t}'.`,confirmLabel:"Delete",tone:"danger"}))try{await y(`/api/notebook/files/${encodeURIComponent(t)}`,{method:"DELETE"}),await Y();const o=C.filter(c=>c!==t);if(o.length===0){L(["Untitled"]),v("Untitled");const c=he();u([{...je,id:c}]),m(c);return}L(o),t===h&&fe(o[o.length-1])}catch(o){console.error("Failed to delete notebook:",o),X({tone:"error",message:`Failed to delete '${t}': ${String(o)}`})}},[Y,h,fe,C,y,_e]),Rt=i.useCallback((t,n)=>{n.stopPropagation();const r=C.filter(o=>o!==t);if(r.length===0){L(["Untitled"]),v("Untitled");const o=he();u([{...je,id:o}]),m(o)}else L(r),(t===h||P&&t===_)&&fe(r[r.length-1])},[C,h,P,_,fe]),lt=i.useCallback(async()=>{const t=h.trim();if(!t){v(_||"Untitled"),j(!1);return}if(!_||_===t){v(t),j(!1);return}if(!b.some(r=>r.name===_)){v(t),L(r=>r.map(o=>o===_?t:o)),j(!1);return}try{const r=await y("/api/notebook/files/rename",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({old_name:_,new_name:t})}),o=(r==null?void 0:r.name)||t;v(o),L(c=>c.map(x=>x===_?o:x)),await Y()}catch(r){console.error("Failed to rename notebook:",r),v(_),X({tone:"error",message:`Failed to rename notebook: ${String(r)}`})}finally{j(!1)}},[_,h,b,y,Y]),ct=i.useCallback((t,n)=>{u(r=>{const o=r.findIndex(U=>U.id===t);if(n==="up"&&o<=0||n==="down"&&o>=r.length-1)return r;const c=[...r],x=n==="up"?o-1:o+1;return[c[o],c[x]]=[c[x],c[o]],c})},[]),re=i.useCallback(async t=>{const n=a.find(o=>o.id===t);if(!n||!p)return;te.current+=1,ce(t,{running:!0,outputs:[]}),N("busy");let r=n.source;n.language==="sql"&&!r.trimStart().startsWith("%%sql")&&(r=`%%sql
`+r);try{const o=await fetch(`/api/notebook/kernels/${encodeURIComponent(p)}/execute`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:r})}),c=await o.json().catch(()=>({}));if(!o.ok)throw new Error((c==null?void 0:c.detail)||(c==null?void 0:c.error)||`HTTP ${o.status}`);ce(t,{running:!1,outputs:c.outputs||[],execution_count:c.execution_count})}catch(o){ce(t,{running:!1,outputs:[{output_type:"error",ename:"ExecutionError",evalue:String(o),traceback:[]}]})}finally{te.current=Math.max(0,te.current-1),N(o=>o==="disconnected"||o==="starting"?o:te.current===0?"idle":"busy")}},[a,p,ce]),ke=i.useCallback(async()=>{for(const t of a)t.cell_type==="code"&&await re(t.id)},[a,re]),It=i.useCallback(async()=>{const t=a.findIndex(n=>n.id===l);for(let n=0;n<t;n++)a[n].cell_type==="code"&&await re(a[n].id)},[a,l,re]),Tt=i.useCallback(async()=>{const t=a.findIndex(n=>n.id===l);for(let n=t;n<a.length;n++)a[n].cell_type==="code"&&await re(a[n].id)},[a,l,re]),qt=i.useCallback(async()=>{await _e({title:"Restart kernel?",message:"All in-memory variables will be lost, then all code cells will run.",confirmLabel:"Restart & Run",tone:"danger"})&&(await Ze(),await ke())},[Ze,ke,_e]),zt=i.useCallback(()=>{u(t=>t.map(n=>({...n,outputs:[],execution_count:null})))},[]),Ot=i.useCallback(()=>{const t=a.find(n=>n.id===l);t&&($e({...t}),Te(l))},[a,l,Te]),Ft=i.useCallback(()=>{const t=a.find(n=>n.id===l);t&&$e({...t})},[a,l]),Kt=i.useCallback(()=>{if(!V)return;const t={...V,id:he(),running:!1,outputs:[],execution_count:null};u(n=>{const r=n.findIndex(c=>c.id===l),o=[...n];return o.splice(r+1,0,t),o}),m(t.id)},[V,l]),Ht=i.useCallback(async()=>{try{const t=await y(`/api/notebook/files/${encodeURIComponent(h)}`),n={nbformat:4,nbformat_minor:5,metadata:{kernelspec:{display_name:"Python 3",language:"python",name:"python3"},language_info:{name:"python",version:"3.11"}},cells:(t.cells||[]).map(x=>({cell_type:x.cell_type==="code"?"code":"markdown",source:x.source.split(`
`).map((U,ee,Z)=>ee<Z.length-1?U+`
`:U),metadata:{},...x.cell_type==="code"?{outputs:x.outputs||[],execution_count:x.execution_count}:{}}))},r=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),o=URL.createObjectURL(r),c=document.createElement("a");c.href=o,c.download=`${h}.ipynb`,c.click(),URL.revokeObjectURL(o)}catch(t){console.error("Failed to export:",t),X({tone:"error",message:"Failed to export notebook"})}},[h,y]),Ut=i.useCallback(()=>{const t=["# Databricks notebook source","# Exported from OpenClaw Workspace",""];a.forEach((c,x)=>{x>0&&t.push(""),c.cell_type==="markdown"?(t.push("# MAGIC %md"),c.source.split(`
`).forEach(U=>{t.push(`# MAGIC ${U}`)})):c.language==="sql"?(t.push("# COMMAND ----------"),t.push(""),t.push("# MAGIC %sql"),c.source.split(`
`).forEach(U=>{t.push(`# MAGIC ${U}`)})):(t.push("# COMMAND ----------"),t.push(""),t.push(c.source))}),t.push("");const n=new Blob([t.join(`
`)],{type:"text/x-python"}),r=URL.createObjectURL(n),o=document.createElement("a");o.href=r,o.download=`${h}.py`,o.click(),URL.revokeObjectURL(r)},[a,h]),Bt=i.useCallback((t,n)=>{const r=n.split(`
`)[0].trim().toLowerCase();let o=null;r==="%sql"||r==="%%sql"?o="sql":(r==="%python"||r==="%%python")&&(o="python"),o?ce(t,{source:n,language:o}):ce(t,{source:n})},[ce]);i.useEffect(()=>{if(!I)return;const t=()=>me(null);return window.addEventListener("click",t),()=>window.removeEventListener("click",t)},[I]),i.useEffect(()=>{const t=n=>{(n.metaKey||n.ctrlKey)&&n.key==="s"&&(n.preventDefault(),Re()),(n.metaKey||n.ctrlKey)&&n.shiftKey&&n.key==="Enter"&&(n.preventDefault(),ke())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[Re,ke]);const Le=Qe.useMemo(()=>B.find(t=>t.id===f)||null,[B,f]),Ne=Qe.useMemo(()=>B.find(t=>t.id===(H||f))||null,[B,H,f]);return e.jsxs("div",{className:"flex h-screen bg-[#09090b] text-foreground font-sans overflow-hidden relative",style:{fontFamily:"'Inter', -apple-system, sans-serif"},children:[e.jsx("div",{className:"absolute top-0 left-0 w-[800px] h-[800px] bg-purple-500/5 rounded-full blur-[120px] pointer-events-none -translate-x-1/4 -translate-y-1/4 z-0"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-[600px] h-[600px] bg-sky-500/5 rounded-full blur-[100px] pointer-events-none translate-x-1/4 -translate-y-1/4 z-0"}),e.jsx("div",{className:"relative z-10 shrink-0",children:e.jsx(Wt,{})}),oe&&e.jsxs("div",{className:"w-[260px] bg-black/20 backdrop-blur-xl border-r border-white/5 shrink-0 flex flex-col z-10 relative shadow-[4px_0_24px_rgba(0,0,0,0.4)]",children:[e.jsxs("div",{className:"h-10 border-b border-white/5 flex items-center justify-between px-4 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pt,{className:"w-3.5 h-3.5 text-sky-400 opacity-80"}),e.jsx("span",{className:"text-xs font-semibold text-white/90 tracking-wide",children:"Notebooks"})]}),e.jsxs("div",{className:"flex gap-1 shrink-0",children:[e.jsx("button",{onClick:Y,className:"p-1 hover:bg-white/10 rounded text-obsidian-muted hover:text-white transition-all active:scale-95",title:"Refresh",children:e.jsx(en,{className:"w-3 h-3"})}),e.jsx("button",{onClick:it,className:"p-1 hover:bg-white/10 rounded text-obsidian-muted hover:text-white transition-all active:scale-95",title:"New notebook",children:e.jsx(Ce,{className:"w-3 h-3"})})]})]}),e.jsx("div",{className:"flex-1 overflow-auto py-2 custom-scrollbar",children:b.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-obsidian-muted gap-2",children:[e.jsx(pt,{className:"w-4 h-4 opacity-50"}),e.jsx("span",{className:"text-[10px]",children:"No notebooks saved."})]}):e.jsx("div",{className:"flex flex-col pl-2 pr-2",children:b.map(t=>{const n=h===t.name;return e.jsxs("div",{onClick:()=>fe(t.name),className:R("flex items-center gap-1.5 py-1.5 px-2 hover:bg-white/5 rounded-md transition-colors cursor-pointer group relative",n?"bg-white/10":""),children:[e.jsx(Ve,{className:R("w-3.5 h-3.5",n?"text-white/80":"text-obsidian-muted group-hover:text-white/80")}),e.jsx("div",{className:"min-w-0 flex-1",children:e.jsx("span",{className:R("truncate block text-[12px] font-medium",n?"text-white":"text-foreground/70 group-hover:text-white"),children:t.name})}),e.jsx("button",{onClick:r=>Et(t.name,r),className:"opacity-0 group-hover:opacity-100 p-1 hover:bg-red-500/20 text-white/40 hover:text-red-400 rounded transition-all active:scale-95",title:"Delete Notebook",children:e.jsx(Ke,{className:"w-3 h-3"})})]},t.filename)})})})]}),e.jsxs("main",{className:"flex-1 flex flex-col min-w-0 bg-transparent backdrop-blur-xl relative z-10",children:[e.jsxs("header",{className:"flex items-center px-4 justify-between shrink-0 h-12 bg-[#09090b]/60 backdrop-blur-xl border-b border-white/[0.06] z-20 relative shadow-sm",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-[1px] bg-gradient-to-r from-transparent via-white/[0.05] to-transparent pointer-events-none"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>ae(!oe),className:"p-1.5 hover:bg-white/[0.08] rounded-md text-white/50 hover:text-white transition-all active:scale-95 flex items-center justify-center border border-transparent hover:border-white/[0.05] shadow-sm cursor-pointer",title:"Toggle Notebooks Explorer",children:e.jsx(tn,{className:"w-[18px] h-[18px]"})}),e.jsx("div",{className:"w-[1px] h-5 bg-gradient-to-b from-transparent via-white/10 to-transparent mx-1 rounded-full"}),e.jsxs("div",{className:"flex items-center gap-0.5 relative",children:[[{label:"File",items:[{label:"New Notebook",shortcut:"",action:()=>it(),icon:e.jsx(Ce,{className:"w-3.5 h-3.5"})},{label:"Save",shortcut:"⌘S",action:()=>Re(),icon:e.jsx(gt,{className:"w-3.5 h-3.5"})},{label:"Export as .ipynb",shortcut:"",action:()=>Ht(),icon:e.jsx(wt,{className:"w-3.5 h-3.5"})},{label:"Export as .py",shortcut:"",action:()=>Ut(),icon:e.jsx(wt,{className:"w-3.5 h-3.5"})},{divider:!0},{label:"Rename",shortcut:"",action:()=>{T(h),j(!0)},icon:e.jsx(Ve,{className:"w-3.5 h-3.5"})}]},{label:"Edit",items:[{label:"Cut Cell",shortcut:"⌘X",action:()=>Ot(),icon:e.jsx(An,{className:"w-3.5 h-3.5"})},{label:"Copy Cell",shortcut:"⌘C",action:()=>Ft(),icon:e.jsx(Gt,{className:"w-3.5 h-3.5"})},{label:"Paste Cell Below",shortcut:"⌘V",action:()=>Kt(),icon:e.jsx(hn,{className:"w-3.5 h-3.5"}),disabled:!V},{divider:!0},{label:"Clear All Outputs",shortcut:"",action:()=>zt(),icon:e.jsx(pn,{className:"w-3.5 h-3.5"})},{label:"Delete Cell",shortcut:"⌫",action:()=>{a.length>1&&Te(l)},icon:e.jsx(Ke,{className:"w-3.5 h-3.5"}),disabled:a.length<=1}]},{label:"View",items:[{label:oe?"Hide Sidebar":"Show Sidebar",shortcut:"",action:()=>ae(!oe),icon:e.jsx(jn,{className:"w-3.5 h-3.5"})}]},{label:"Run",items:[{label:"Run Cell",shortcut:"⇧↵",action:()=>re(l),icon:e.jsx(ze,{className:"w-3.5 h-3.5"})},{label:"Run All",shortcut:"⌘⇧↵",action:()=>ke(),icon:e.jsx(ze,{className:"w-3.5 h-3.5"})},{divider:!0},{label:"Run All Above",shortcut:"",action:()=>It(),icon:e.jsx(Lt,{className:"w-3.5 h-3.5"})},{label:"Run All Below",shortcut:"",action:()=>Tt(),icon:e.jsx(Oe,{className:"w-3.5 h-3.5"})},{divider:!0},{label:"Interrupt Kernel",shortcut:"",action:()=>Pt(),icon:e.jsx(on,{className:"w-3.5 h-3.5"})},{label:"Restart Kernel",shortcut:"",action:async()=>{await _e({title:"Restart kernel?",message:"All in-memory variables will be lost.",confirmLabel:"Restart",tone:"danger"})&&await Ze()},icon:e.jsx(Ln,{className:"w-3.5 h-3.5"})},{label:"Restart & Run All",shortcut:"",action:()=>qt(),icon:e.jsx(nn,{className:"w-3.5 h-3.5"})}]},{label:"Help",items:[{label:"Keyboard Shortcuts",shortcut:"",action:()=>ie(!0),icon:e.jsx(yn,{className:"w-3.5 h-3.5"})}]}].map(t=>e.jsxs("div",{className:"relative group/menu",children:[e.jsx("button",{onClick:n=>{n.stopPropagation(),me(I===t.label?null:t.label)},className:R("px-3 py-1.5 rounded-md text-[13px] font-medium transition-all duration-200 tracking-tight",I===t.label?"text-white bg-white/10 shadow-inner":"text-white/60 hover:text-white hover:bg-white/[0.06]"),children:t.label}),I===t.label&&e.jsx("div",{className:"absolute top-[calc(100%+4px)] left-0 w-56 bg-[#18181b]/95 border border-white/10 rounded-xl shadow-2xl z-50 overflow-hidden py-1.5 backdrop-blur-2xl ring-1 ring-black/50",onClick:n=>n.stopPropagation(),children:t.items.map((n,r)=>n.divider?e.jsx("div",{className:"h-[1px] bg-gradient-to-r from-transparent via-white/10 to-transparent my-1.5 mx-2"},`div-${r}`):e.jsxs("button",{onClick:()=>{n.action(),me(null)},disabled:n.disabled,className:"w-full flex items-center gap-3 px-3 py-1.5 text-[12px] font-medium text-white/70 hover:text-white hover:bg-blue-500/10 transition-colors disabled:opacity-30 disabled:cursor-not-allowed group/item",children:[e.jsx("span",{className:"text-white/40 group-hover/item:text-blue-400 transition-colors",children:n.icon}),e.jsx("span",{className:"flex-1 text-left",children:n.label}),n.shortcut&&e.jsx("span",{className:"text-[10px] text-white/30 font-mono tracking-wider",children:n.shortcut})]},`btn-${r}`))})]},t.label)),e.jsx("div",{className:"w-[1px] h-5 bg-gradient-to-b from-transparent via-white/10 to-transparent mx-3 rounded-full"}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:t=>{t.stopPropagation(),me(I==="lang"?null:"lang")},className:R("flex items-center gap-1.5 px-3 py-1.5 rounded-md text-[13px] font-bold tracking-wide transition-all",I==="lang"?"text-blue-400 bg-blue-500/10 shadow-inner":"text-white/70 hover:text-white hover:bg-white/[0.06]"),children:[e.jsx("span",{children:q==="python"?"Python":"SQL"}),e.jsx(Oe,{className:R("w-3.5 h-3.5 transition-transform opacity-70",I==="lang"&&"rotate-180")})]}),I==="lang"&&e.jsx("div",{className:"absolute top-[calc(100%+4px)] left-0 w-40 bg-[#18181b]/95 border border-white/10 rounded-xl shadow-2xl z-50 overflow-hidden py-1.5 backdrop-blur-2xl ring-1 ring-black/50",onClick:t=>t.stopPropagation(),children:[{id:"python",label:"Python"},{id:"sql",label:"SQL"}].map(t=>e.jsxs("button",{onClick:()=>{He(t.id),me(null)},className:"w-full flex items-center gap-3 px-3 py-1.5 text-[12px] font-medium transition-colors hover:bg-blue-500/10 hover:text-blue-400 group/lang text-white/70",children:[e.jsx("div",{className:"flex items-center justify-center w-4 h-4",children:q===t.id?e.jsx(bt,{className:"w-4 h-4 text-blue-400"}):null}),e.jsx("span",{className:q===t.id?"text-white":"",children:t.label})]},t.id))})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 xl:gap-2 justify-end min-w-0 flex-1",children:[e.jsxs("button",{onClick:ke,disabled:!p||k==="busy"||k==="starting"||k==="disconnected",className:"flex-shrink-0 whitespace-nowrap flex items-center gap-1.5 px-2.5 xl:px-3 py-1.5 rounded-md hover:bg-white/[0.08] transition-all cursor-pointer group/run active:scale-95 text-[12px] font-medium text-white/70 hover:text-white disabled:opacity-50",children:[e.jsx(ze,{className:"w-3.5 h-3.5 opacity-70 group-hover/run:text-green-400 group-hover/run:opacity-100 transition-colors"}),"Run all"]}),e.jsxs("div",{className:"hidden md:flex items-center h-[28px] p-[2px] rounded border border-white/5 bg-[#09090b]/80 shadow-md relative z-10 flex-shrink-0 ring-1 ring-white/[0.02]",children:[e.jsxs("div",{className:"flex items-center gap-1.5 pl-2 pr-1 h-full hover:bg-white/[0.04] rounded-sm transition-colors cursor-pointer group/select w-[140px] xl:w-[200px]",children:[e.jsx(xt,{className:"w-[11px] h-[11px] text-white/30 group-hover/select:text-white/50 transition-colors flex-shrink-0"}),e.jsxs("div",{className:"relative flex items-center h-full flex-1 min-w-0",children:[e.jsx("select",{value:f,onChange:t=>we(t.target.value),className:"bg-transparent text-[11px] text-white/60 group-hover/select:text-white/90 font-medium outline-none cursor-pointer appearance-none w-full pr-5 pl-0.5 h-full truncate transition-colors",disabled:De||k==="busy",children:B.map(t=>e.jsxs("option",{value:t.id,className:"bg-[#18181b] text-white",children:[t.label," • ",qe(t)]},t.id))}),e.jsx(Oe,{className:"w-3 h-3 text-white/20 group-hover/select:text-white/40 absolute right-0 pointer-events-none flex-shrink-0 transition-colors"})]})]}),e.jsx("div",{className:"w-[1px] h-3.5 bg-white/[0.08] mx-0.5 flex-shrink-0"}),e.jsxs("button",{onClick:$t,disabled:!p||De||k==="busy"||!f||!le||f===H,className:`flex-shrink-0 h-full whitespace-nowrap flex items-center gap-1.5 px-2 rounded-sm text-[11px] font-medium transition-all
                                disabled:opacity-40 disabled:cursor-not-allowed
                                hover:bg-white/[0.04] text-white/60 hover:text-white active:scale-95`,title:"Attach selected cluster profile",children:[De?e.jsx(Fe,{className:"w-[11px] h-[11px] animate-spin text-blue-400"}):null,e.jsx("span",{className:H===f?"text-green-400/90 font-semibold":"",children:H===f?"Attached":"Attach"})]})]}),Le&&e.jsx("div",{className:"hidden xl:flex items-center gap-2 text-[11px] font-mono min-w-0 flex-1 max-w-[200px] 2xl:max-w-[400px] px-2 opacity-50",children:e.jsxs("span",{className:"text-white/50 truncate block w-full",title:`${Le.label}: ${qe(Le)}`,children:[Le.label,": ",e.jsx("span",{className:"opacity-70",children:qe(Le)})]})}),((S==null?void 0:S.spark_ui_url)||(S==null?void 0:S.spark_master_ui_url))&&e.jsxs("a",{href:(S==null?void 0:S.spark_ui_url)||(S==null?void 0:S.spark_master_ui_url)||"#",target:"_blank",rel:"noreferrer",className:"hidden lg:flex flex-shrink-0 whitespace-nowrap items-center gap-1.5 px-2.5 py-1.5 rounded-md border border-white/10 bg-white/[0.03] hover:bg-white/[0.08] text-[12px] font-medium text-white/70 hover:text-white transition-all shadow-sm active:scale-95 group/spark",title:"Open Spark UI",children:[e.jsx(sn,{className:"w-3.5 h-3.5 opacity-70 group-hover/spark:opacity-100 transition-opacity"}),e.jsx("span",{children:"Spark UI"})]}),e.jsx("div",{className:"hidden md:block w-[1px] h-5 bg-gradient-to-b from-transparent via-white/10 to-transparent mx-1 rounded-full flex-shrink-0"}),e.jsxs("button",{onClick:Re,className:"flex-shrink-0 whitespace-nowrap px-3 py-1.5 rounded-md hover:bg-white/[0.08] transition-all text-white/70 hover:text-white text-[12px] font-medium flex items-center gap-1.5 active:scale-95",children:[e.jsx(gt,{className:"w-3.5 h-3.5 opacity-70"}),"Save"]})]})]}),e.jsxs("div",{className:"flex items-end overflow-x-auto shrink-0 bg-black/20 backdrop-blur-md h-[40px] w-full border-b border-white/[0.06] custom-scrollbar relative z-10 shadow-inner",children:[e.jsx("div",{className:"absolute inset-x-0 top-0 h-[10px] bg-gradient-to-b from-black/20 to-transparent pointer-events-none"}),C.map(t=>{const n=P?t===_:t===h,r=n&&P?h:t;return e.jsxs("div",{onClick:()=>{n||fe(t)},className:R("relative flex items-center justify-between cursor-pointer select-none group h-[40px] min-w-[140px] max-w-[220px] px-3 transition-colors",n?"bg-[#18181b]/90 text-white":"text-white/40 hover:text-white/90 hover:bg-white/[0.04] bg-transparent"),style:{borderRight:"1px solid rgba(255,255,255,0.05)",fontSize:"13px"},children:[n&&e.jsx("div",{className:"absolute top-0 left-0 right-0 h-[2px] bg-blue-500 shadow-[0_0_8px_rgba(59,130,246,0.5)] z-10 rounded-t-sm"}),e.jsxs("div",{className:"flex items-center gap-2.5 truncate",children:[e.jsx(Ve,{className:R("w-3.5 h-3.5 flex-shrink-0",n?"text-blue-400":"text-white/30 group-hover:text-white/50")}),n&&P?e.jsx("input",{autoFocus:!0,className:"text-[13px] font-medium text-white bg-transparent outline-none w-32 tracking-wide",value:h,onChange:o=>v(o.target.value),onBlur:()=>{lt()},onKeyDown:o=>{o.key==="Enter"&&lt()},onClick:o=>o.stopPropagation()}):e.jsx("span",{className:R("truncate tracking-wide",n?"font-semibold":"font-medium"),onClick:o=>{o.stopPropagation(),n?(T(h),j(!0)):fe(t)},title:n?"Click to rename":t,children:r})]}),e.jsx("div",{className:"flex items-center gap-1.5 ml-3 z-20",children:e.jsx(Ae,{onClick:o=>Rt(t,o),className:R("w-4 h-4 p-0.5 rounded-md transition-all flex-shrink-0 hover:bg-white/20 active:scale-95",n?"opacity-60 hover:opacity-100":"opacity-0 group-hover:opacity-60 hover:opacity-100")})})]},t)})]}),e.jsx("div",{className:"flex-1 relative flex flex-col min-h-0 bg-transparent overflow-hidden",children:e.jsxs("div",{className:"flex-1 overflow-y-auto py-4 px-6 flex flex-col gap-2 items-center w-full max-w-[1440px] mx-auto custom-scrollbar",children:[a.map((t,n)=>e.jsx("div",{className:"w-full",children:e.jsx(Fn,{cell:t,index:n,total:a.length,isActive:l===t.id,onActivate:()=>m(t.id),onUpdate:r=>{"source"in r&&typeof r.source=="string"?Bt(t.id,r.source):ce(t.id,r)},onDelete:()=>Te(t.id),onMoveUp:()=>ct(t.id,"up"),onMoveDown:()=>ct(t.id,"down"),onRun:()=>re(t.id),onRunAndAdvance:()=>{re(t.id);const r=a.findIndex(o=>o.id===t.id);r<a.length-1?m(a[r+1].id):Ie(t.id,"code")},onAddBelow:r=>Ie(t.id,r),sqlSuggestionItems:d,loadSqlColumns:At,sqlKeywordItems:G,pythonKeywordItems:M,pythonSymbolItems:Mt})},t.id)),e.jsx("div",{className:"w-full flex justify-center py-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>{var t;return Ie((t=a[a.length-1])==null?void 0:t.id,"code")},className:"flex items-center gap-1 px-3 py-1.5 border border-white/10 bg-white/5 rounded text-[11px] text-white/60 hover:text-white hover:border-white/20 hover:bg-white/10 transition-colors shadow-sm",children:[e.jsx(Ce,{className:"w-3.5 h-3.5"})," Code"]}),e.jsxs("button",{onClick:()=>{var t;return Ie((t=a[a.length-1])==null?void 0:t.id,"markdown")},className:"flex items-center gap-1 px-3 py-1.5 border border-white/10 bg-white/5 rounded text-[11px] text-white/60 hover:text-white hover:border-white/20 hover:bg-white/10 transition-colors shadow-sm",children:[e.jsx(Ce,{className:"w-3.5 h-3.5"})," Markdown"]})]})})]})}),e.jsxs("div",{className:"h-8 bg-black/60 backdrop-blur-xl border-t border-white/5 flex items-center justify-between px-4 shrink-0 text-[10.5px] font-mono text-obsidian-muted/80 z-20",children:[e.jsxs("div",{className:"flex items-center gap-4 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[k==="idle"&&e.jsx(bt,{className:"w-3 h-3 text-white/40"}),k==="busy"&&e.jsx(Fe,{className:"w-3 h-3 text-white/60 animate-spin"}),k==="starting"&&e.jsx(Fe,{className:"w-3 h-3 text-white/40 animate-spin"}),k==="disconnected"&&e.jsx(Ae,{className:"w-3 h-3 text-white/30"}),e.jsxs("span",{children:["Jupyter API: ",e.jsx("span",{className:"text-white/80 capitalize",children:k})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Zt,{className:"w-3 h-3"}),e.jsxs("span",{children:["Engine: ",e.jsx("span",{className:"text-foreground/80 uppercase",children:Pe})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(xt,{className:"w-3 h-3"}),e.jsxs("span",{children:["Cluster: ",e.jsx("span",{className:"text-foreground/80",children:H||f||O})]})]}),Ne&&e.jsxs("div",{className:"flex items-center gap-1.5 truncate",children:[e.jsx("span",{children:qe(Ne)}),kt(Ne)&&e.jsx("span",{className:"text-white/65",children:kt(Ne)}),Nt(Ne)==="Shuffle Low"&&e.jsx("span",{className:"px-1 py-0.5 rounded border border-amber-400/35 text-amber-300/90 whitespace-nowrap",children:"Shuffle Low"}),Nt(Ne)==="Shuffle High"&&e.jsx("span",{className:"px-1 py-0.5 rounded border border-rose-400/35 text-rose-300/90 whitespace-nowrap",children:"Shuffle High"})]}),!le&&e.jsx("div",{className:"flex items-center gap-1.5 truncate",children:e.jsx("span",{children:"Cluster API: legacy backend (attach/observability disabled)"})}),(S==null?void 0:S.workers)&&e.jsxs("div",{className:"flex items-center gap-1.5 truncate",children:[e.jsx(rn,{className:"w-3 h-3"}),e.jsxs("span",{children:["Workers ",S.workers.count," · Cores ",S.workers.cores_used,"/",S.workers.cores_total," · Mem ",Math.round((S.workers.memory_used_mb||0)/1024),"G/",Math.round((S.workers.memory_total_mb||0)/1024),"G"]})]}),((dt=S==null?void 0:S.logs)==null?void 0:dt[0])&&e.jsx("div",{className:"flex items-center gap-1.5 truncate",children:e.jsxs("span",{children:["Jobs ",S.logs[0].running_jobs," · Stages ",S.logs[0].active_stages]})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(_t,{className:"w-3 h-3"}),e.jsxs("span",{children:[a.length," cells"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 font-mono",children:[e.jsx("span",{children:"Ln 1, Col 1"}),e.jsx("span",{children:"UTF-8"}),e.jsx("span",{children:(((ut=a.find(t=>t.id===l))==null?void 0:ut.language)||q)==="python"?"Python":"SQL"})]})]})]}),pe&&e.jsx("div",{className:"absolute right-4 bottom-12 z-[120] max-w-md",children:e.jsxs("div",{className:R("flex items-start gap-2 rounded-lg border px-3 py-2 shadow-2xl backdrop-blur-md",pe.tone==="success"&&"border-emerald-400/40 bg-emerald-500/15 text-emerald-300",pe.tone==="error"&&"border-rose-400/40 bg-rose-500/15 text-rose-300",pe.tone==="info"&&"border-cyan-400/40 bg-cyan-500/15 text-cyan-300"),children:[e.jsx("div",{className:"text-[11px] leading-5",children:pe.message}),e.jsx("button",{onClick:()=>X(null),className:"ml-1 text-current/80 hover:text-current","aria-label":"Dismiss notification",children:e.jsx(Ae,{className:"w-3.5 h-3.5"})})]})}),Se&&e.jsx("div",{className:"fixed inset-0 z-[130] flex items-center justify-center bg-black/65 backdrop-blur-sm",onClick:()=>We(!1),children:e.jsxs("div",{className:"w-[440px] max-w-[92vw] rounded-xl border border-white/10 bg-[#151518] shadow-2xl",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"px-5 py-4 border-b border-white/10",children:[e.jsx("h3",{className:"text-sm font-semibold text-white",children:Se.title}),e.jsx("p",{className:"mt-1 text-xs text-white/65",children:Se.message})]}),e.jsxs("div",{className:"px-5 py-3 flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>We(!1),className:"px-3 py-1.5 text-xs rounded-md border border-white/10 text-white/70 hover:text-white hover:bg-white/5 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>We(!0),className:R("px-3 py-1.5 text-xs rounded-md transition-colors",Se.tone==="danger"?"border border-rose-400/30 bg-rose-500/20 text-rose-200 hover:bg-rose-500/30":"border border-cyan-400/30 bg-cyan-500/20 text-cyan-200 hover:bg-cyan-500/30"),children:Se.confirmLabel||"Confirm"})]})]})}),Ue&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm",onClick:()=>ie(!1),children:e.jsxs("div",{className:"bg-[#1a1a1e] border border-white/10 rounded-xl shadow-2xl w-[520px] max-h-[70vh] overflow-auto",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-3 border-b border-white/10",children:[e.jsx("h2",{className:"text-white font-semibold text-sm tracking-wide",children:"Keyboard Shortcuts"}),e.jsx("button",{onClick:()=>ie(!1),className:"p-1 hover:bg-white/10 rounded transition-colors text-white/40 hover:text-white",children:e.jsx(Ae,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"p-5 space-y-3 text-[12px]",children:[{keys:"⇧ Enter",desc:"Run cell and move to next"},{keys:"⌘ Enter",desc:"Run cell in place"},{keys:"⌘ S",desc:"Save notebook"},{keys:"⌘ ⇧ Enter",desc:"Run all cells"},{keys:"⌘ ⇧ P",desc:"Open command palette (Editor)"},{keys:"Esc",desc:"Exit edit mode (focus cell)"},{keys:"%sql",desc:"Switch cell language to SQL (magic command)"},{keys:"%python",desc:"Switch cell language to Python (magic command)"},{keys:"%md",desc:"Switch cell to Markdown (magic command)"}].map((t,n)=>e.jsxs("div",{className:"flex items-center justify-between py-1.5 border-b border-white/5 last:border-0",children:[e.jsx("span",{className:"text-white/70",children:t.desc}),e.jsx("kbd",{className:"px-2 py-0.5 bg-white/5 border border-white/10 rounded text-white/60 font-mono text-[11px]",children:t.keys})]},n))})]})})]})}export{ro as default};
