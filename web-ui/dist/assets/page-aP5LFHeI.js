import{r as i,R as Je,j as e}from"./index-p-H4rLgw.js";import{c as Q,S as Wt,B as pt,l as Qe,b as R,f as Gt,P as ze,j as xt,T as Zt,I as Jt,L as Qt,M as Vt,E as ft}from"./Sidebar-Ch_JQZr9.js";import{L as Xt,P as je,C as bt,F as Yt}from"./index-iGQCOOIm.js";import{R as eo}from"./refresh-cw-uy5mI12M.js";import{T as Ke}from"./trash-2-DgLAXw8o.js";import{L as to}from"./layout-panel-left-Sq16s4zz.js";import{S as gt}from"./save-slJF9Q7u.js";import{D as wt,R as oo}from"./rotate-ccw-DUcKvRtg.js";import{C as Oe}from"./chevron-down-Bdy6QuAS.js";import{C as no}from"./circle-stop-DC-xppv-.js";import{L as Fe}from"./loader-circle-BoRSmyHv.js";import{E as so}from"./external-link-RWChbr3S.js";import{X as Ae}from"./x-BSsjDSLk.js";import{A as ro}from"./activity-CW96AQef.js";import{C as St}from"./code-xml-z34C7C5b.js";import{S as ao}from"./sparkles-mJESRWl9.js";import{M as Ve,r as Xe}from"./index-CRZvwgZ2.js";/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const io=[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]],lo=Q("bold",io);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const co=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Lt=Q("chevron-up",co);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uo=[["path",{d:"M11 14h10",key:"1w8e9d"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v1.344",key:"1e62lh"}],["path",{d:"m17 18 4-4-4-4",key:"z2g111"}],["path",{d:"M8 4H6a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h12a2 2 0 0 0 1.793-1.113",key:"bjbb7m"}],["rect",{x:"8",y:"2",width:"8",height:"4",rx:"1",key:"ublpy"}]],ho=Q("clipboard-paste",uo);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mo=[["path",{d:"M21 21H8a2 2 0 0 1-1.42-.587l-3.994-3.999a2 2 0 0 1 0-2.828l10-10a2 2 0 0 1 2.829 0l5.999 6a2 2 0 0 1 0 2.828L12.834 21",key:"g5wo59"}],["path",{d:"m5.082 11.09 8.828 8.828",key:"1wx5vj"}]],po=Q("eraser",mo);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xo=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],fo=Q("grip-vertical",xo);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bo=[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]],go=Q("italic",bo);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wo=[["path",{d:"M10 8h.01",key:"1r9ogq"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M14 8h.01",key:"1primd"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"M18 8h.01",key:"emo2bl"}],["path",{d:"M6 8h.01",key:"x9i8wu"}],["path",{d:"M7 16h10",key:"wp8him"}],["path",{d:"M8 12h.01",key:"czm47f"}],["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}]],yo=Q("keyboard",wo);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ko=[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]],No=Q("link",ko);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vo=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}]],jo=Q("panel-left",vo);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Co=[["path",{d:"M16 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"rib7q0"}],["path",{d:"M5 3a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2 1 1 0 0 1 1 1v1a2 2 0 0 1-2 2 1 1 0 0 0-1 1v2a1 1 0 0 0 1 1 6 6 0 0 0 6-6V5a2 2 0 0 0-2-2z",key:"1ymkrd"}]],_o=Q("quote",Co);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const So=[["path",{d:"M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8",key:"1p45f6"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}]],Lo=Q("rotate-cw",So);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mo=[["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M8.12 8.12 12 12",key:"1alkpv"}],["path",{d:"M20 4 8.12 15.88",key:"xgtan2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M14.8 14.8 20 20",key:"ptml3r"}]],Ao=Q("scissors",Mo),yt=s=>!s||s<=0?"0G":`${(s/1024).toFixed(s%1024===0?0:1)}G`,qe=s=>{if(!s)return"-";const a=s.effective_resources||s.resources||{},u=s.available_resources||{},l=Number(u.total_cores||0),m=Number(u.total_memory_mb||0),p=Number(a.shuffle_partitions||0);if(l>0||m>0)return`Avail ${l} cores · ${yt(m)} RAM · shuffle ${p}`;const b=Number(a.total_cores||0),w=yt(Number(a.total_memory_mb||0));return`${b} cores · ${w} RAM · shuffle ${p}`},kt=s=>{if(!(s!=null&&s.shuffle_tuning))return"";const a=s.shuffle_tuning,u=Number(a.current||0),l=Number(a.recommended||0);return!u||!l?"":`shuffle ${u} (recommended ~${l})`},Nt=s=>{var u;const a=(u=s==null?void 0:s.shuffle_tuning)==null?void 0:u.status;return a==="low"?"Shuffle Low":a==="high"?"Shuffle High":""},vt=s=>{window.dispatchEvent(new CustomEvent("openclaw:notebooks-notice",{detail:{message:s}}))},he=()=>Math.random().toString(36).substring(2,10),be=s=>`"${String(s).replace(/"/g,'""')}"`,Po=s=>String(s).replace(/'/g,"''"),Me=(s,a=[])=>{if(!s||typeof s!="object")return null;for(const u of a){const l=s[u];if(l!=null&&String(l).trim())return String(l).trim()}for(const u of Object.values(s))if(u!=null&&String(u).trim())return String(u).trim();return null},jt=async(s,a,u)=>{var l,m;try{const p=(m=(l=s==null?void 0:s.languages)==null?void 0:l.getLanguages)==null?void 0:m.call(l).find(h=>(h==null?void 0:h.id)===a);if(!p||typeof p.loader!="function")return[];const b=await p.loader(),w=(b==null?void 0:b.language)||{},k=new Set;for(const h of u){const N=w==null?void 0:w[h];if(Array.isArray(N))for(const M of N){const j=String(M||"").trim();j&&k.add(j)}}return Array.from(k)}catch{return[]}},$o=s=>/^[A-Za-z_][A-Za-z0-9_]*$/.test(s),Eo=s=>{var u;const a=new Set;for(const l of s){if(l.cell_type!=="code"||l.language!=="python")continue;const m=String(l.source||"").split(`
`);for(const p of m){const b=p.trim();if(!b||b.startsWith("#"))continue;const w=b.match(/^def\s+([A-Za-z_][A-Za-z0-9_]*)\s*\(/);if(w){a.add(w[1]);continue}const k=b.match(/^class\s+([A-Za-z_][A-Za-z0-9_]*)\s*[\(:]/);if(k){a.add(k[1]);continue}const h=b.match(/^import\s+(.+)$/);if(h){const j=h[1].split(",");for(const A of j){const I=A.trim();if(!I)continue;const C=I.match(/\s+as\s+([A-Za-z_][A-Za-z0-9_]*)$/);if(C){a.add(C[1]);continue}const S=(u=I.split(".")[0])==null?void 0:u.trim();S&&$o(S)&&a.add(S)}continue}const N=b.match(/^from\s+[A-Za-z0-9_\.]+\s+import\s+(.+)$/);if(N){const j=N[1].split(",");for(const A of j){const I=A.trim();if(!I||I==="*")continue;const C=I.match(/^([A-Za-z_][A-Za-z0-9_]*)(?:\s+as\s+([A-Za-z_][A-Za-z0-9_]*))?$/);C&&a.add(C[2]||C[1])}continue}const M=b.match(/^([A-Za-z_][A-Za-z0-9_]*)\s*=/);M&&a.add(M[1])}}return Array.from(a).sort((l,m)=>l.localeCompare(m))},ve={id:he(),cell_type:"code",source:"",language:"python",outputs:[],execution_count:null,running:!1},Ro=(s,a)=>a==="catalog"?s.languages.CompletionItemKind.Module:a==="schema"?s.languages.CompletionItemKind.Struct:a==="table"?s.languages.CompletionItemKind.Value:a==="view"?s.languages.CompletionItemKind.Interface:a==="column"?s.languages.CompletionItemKind.Field:s.languages.CompletionItemKind.Function,Ct=(s,a,u,l)=>{const m=s;m.__openclawNotebookSqlSuggestionSource=a,m.__openclawNotebookSqlColumnLoader=u,m.__openclawNotebookSqlKeywordSource=l,!m.__openclawNotebookSqlAutocompleteRegistered&&(m.__openclawNotebookSqlAutocompleteRegistered=!0,s.languages.registerCompletionItemProvider("sql",{triggerCharacters:[" ","."],provideCompletionItems:async(p,b)=>{const w=m.__openclawNotebookSqlSuggestionSource,k=typeof w=="function"?w():[],h=m.__openclawNotebookSqlKeywordSource,N=typeof h=="function"?h():[],M=p.getWordUntilPosition(b),j={startLineNumber:b.lineNumber,endLineNumber:b.lineNumber,startColumn:M.startColumn,endColumn:M.endColumn},I=p.getValueInRange({startLineNumber:b.lineNumber,startColumn:1,endLineNumber:b.lineNumber,endColumn:b.column}).match(/([A-Za-z0-9_]+(?:\.[A-Za-z0-9_]+)*)\.\s*$/),C=I?I[1].toLowerCase():null,S=(M.word||"").toLowerCase();let f=k;if(C){const y=C.split(".").length;if(f=k.filter(z=>z.fqn.toLowerCase().startsWith(C+".")&&z.fqn.toLowerCase().split(".").length===y+1),f.length===0&&y>=3){const z=m.__openclawNotebookSqlColumnLoader;if(typeof z=="function")try{f=await z(C)}catch{f=[]}}}else S&&(f=k.filter(y=>y.label.toLowerCase().startsWith(S)));const se=C?[]:N.filter(y=>!S||y.toLowerCase().startsWith(S)).map(y=>({label:y.toUpperCase(),kind:s.languages.CompletionItemKind.Keyword,insertText:y.toUpperCase(),detail:"sql keyword",range:j,sortText:`0_${y}`})),re=f.map(y=>({label:y.label,kind:Ro(s,y.kind),insertText:y.label,detail:y.detail,range:j,sortText:`1_${y.fqn}`})),ae=new Set;return{suggestions:[...se,...re].filter(y=>{const z=String(y.label).toLowerCase();return ae.has(z)?!1:(ae.add(z),!0)})}}}))},_t=(s,a,u)=>{const l=s;l.__openclawNotebookPythonKeywordSource=a,l.__openclawNotebookPythonSymbolSource=u,!l.__openclawNotebookPythonAutocompleteRegistered&&(l.__openclawNotebookPythonAutocompleteRegistered=!0,s.languages.registerCompletionItemProvider("python",{triggerCharacters:[".","_"],provideCompletionItems:(m,p)=>{const b=l.__openclawNotebookPythonKeywordSource,w=l.__openclawNotebookPythonSymbolSource,k=typeof b=="function"?b():[],h=typeof w=="function"?w():[],N=m.getWordUntilPosition(p),M=(N.word||"").toLowerCase(),j={startLineNumber:p.lineNumber,endLineNumber:p.lineNumber,startColumn:N.startColumn,endColumn:N.endColumn},A=k.filter(f=>!M||f.toLowerCase().startsWith(M)).map(f=>({label:f,kind:s.languages.CompletionItemKind.Keyword,insertText:f,detail:"python keyword",range:j,sortText:`0_${f}`})),I=h.filter(f=>!M||f.toLowerCase().startsWith(M)).map(f=>({label:f,kind:s.languages.CompletionItemKind.Variable,insertText:f,detail:"notebook symbol",range:j,sortText:`1_${f}`})),C=new Set;return{suggestions:[...A,...I].filter(f=>{const se=String(f.label).toLowerCase();return C.has(se)?!1:(C.add(se),!0)})}}}))};function Io({output:s}){const a=s.name==="stderr";return e.jsx("div",{className:R("px-4 py-3 font-mono text-[11.5px] whitespace-pre-wrap leading-relaxed rounded-b-md border border-obsidian-border/40 shadow-inner",a?"text-obsidian-danger bg-[#2b1010]":"text-foreground bg-[#1e1e1e]"),children:s.text})}function To({data:s}){var a;return(a=s==null?void 0:s.columns)!=null&&a.length?e.jsxs("div",{className:"overflow-auto max-h-[400px] border-t border-obsidian-border bg-obsidian-bg",children:[e.jsxs("table",{className:"w-full text-left border-collapse font-sans text-[11px]",children:[e.jsx("thead",{className:"sticky top-0 bg-obsidian-panel z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-1.5 border-b border-r border-obsidian-border font-medium text-obsidian-muted w-10 text-center",children:"#"}),s.columns.map((u,l)=>e.jsx("th",{className:"px-3 py-1.5 border-b border-r border-obsidian-border font-semibold text-obsidian-info truncate",children:u},l))]})}),e.jsx("tbody",{children:s.rows.map((u,l)=>e.jsxs("tr",{className:"hover:bg-white/5 transition-colors",children:[e.jsx("td",{className:"px-3 py-1 border-b border-r border-obsidian-border text-obsidian-muted font-mono text-[10px] text-center",children:l+1}),u.map((m,p)=>e.jsx("td",{className:"px-3 py-1 border-b border-r border-obsidian-border text-foreground/90 truncate max-w-[300px]",title:String(m),children:m===null?e.jsx("span",{className:"text-obsidian-muted italic",children:"null"}):String(m)},p))]},l))})]}),e.jsxs("div",{className:"bg-obsidian-panel px-3 py-1 text-[10px] text-obsidian-muted border-b border-obsidian-border flex justify-between",children:[e.jsxs("span",{children:[s.rows.length," rows"]}),e.jsxs("span",{children:[s.columns.length," columns"]})]})]}):null}function qo({output:s}){return e.jsxs("div",{className:"bg-obsidian-danger/5 overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-2 text-[11px] font-semibold text-obsidian-danger flex items-center gap-1.5",children:[e.jsx(Ae,{className:"w-3.5 h-3.5"}),e.jsxs("span",{children:[s.ename,": ",s.evalue]})]}),s.traceback&&s.traceback.length>0&&e.jsx("div",{className:"px-4 pb-2",children:e.jsx("pre",{className:"text-[10px] font-mono text-obsidian-danger/70 whitespace-pre-wrap leading-relaxed",children:s.traceback.join(`
`).replace(/\u001b\[[0-9;]*m/g,"")})})]})}function zo({output:s}){var u;const a=s.data;return a?(u=a["application/json"])!=null&&u.columns?e.jsx(To,{data:a["application/json"]}):a["text/markdown"]?e.jsx("div",{className:"px-4 py-2 bg-obsidian-bg prose prose-invert prose-sm max-w-none text-foreground/90",children:e.jsx(Ve,{remarkPlugins:[Xe],children:String(a["text/markdown"])})}):a["text/html"]?e.jsx("div",{className:"px-4 py-2 bg-obsidian-bg",children:e.jsx("iframe",{srcDoc:String(a["text/html"]),className:"w-full min-h-[120px] border border-obsidian-border rounded bg-white",sandbox:"",title:"notebook-html-output"})}):a["image/png"]?e.jsx("div",{className:"px-4 py-2 bg-obsidian-bg",children:e.jsx("img",{src:`data:image/png;base64,${a["image/png"]}`,alt:"output",className:"max-w-full rounded border border-obsidian-border"})}):a["text/plain"]?e.jsx("pre",{className:"px-4 py-2 font-mono text-[11px] text-foreground/90 whitespace-pre-wrap bg-obsidian-bg",children:a["text/plain"]}):null:null}function Oo({outputs:s}){return!s||!s.length?null:e.jsx("div",{className:"flex flex-col gap-2 mt-2",children:s.map((a,u)=>{switch(a.output_type){case"stream":return e.jsx(Io,{output:a},u);case"error":return e.jsx(qo,{output:a},u);case"execute_result":case"display_data":return e.jsx(zo,{output:a},u);default:return null}})})}function Fo({cell:s,index:a,total:u,isActive:l,onActivate:m,onUpdate:p,onDelete:b,onMoveUp:w,onMoveDown:k,onRun:h,onAddBelow:N,sqlSuggestionItems:M,loadSqlColumns:j,sqlKeywordItems:A,pythonKeywordItems:I,pythonSymbolItems:C}){const S=i.useRef(null),f=i.useRef(null),se=s.source.split(`
`).length,re=Math.max(40,Math.min(se*18+16,500)),[ae,Pe]=i.useState(re),[y,z]=i.useState(!1);i.useEffect(()=>{f.current&&(Ct(f.current,()=>M,j,()=>A),_t(f.current,()=>I,()=>C))},[M,j,A,I,C]);const Z=i.useCallback(d=>{const v=S.current;if(!v)return;const $=v.getModel();if(!$)return;const U=v.getSelection(),L=$.getValueInRange(U)||"";let K="",oe=0;switch(d){case"bold":K=L?`**${L}**`:"**bold text**",oe=L?0:-2;break;case"italic":K=L?`*${L}*`:"*italic text*",oe=L?0:-1;break;case"code":L.includes(`
`)?K=`\`\`\`
${L||"code"}
\`\`\``:K=L?`\`${L}\``:"`code`",oe=L?0:-1;break;case"link":K=L?`[${L}](url)`:"[link text](url)",oe=-1;break;case"image":K=L?`![${L}](url)`:"![alt text](url)",oe=-1;break;case"h1":{const E=U.startLineNumber,D=$.getLineContent(E);K=`# ${D.replace(/^#+\s*/,"")}`,v.executeEdits("toolbar",[{range:{startLineNumber:E,startColumn:1,endLineNumber:E,endColumn:D.length+1},text:K}]),v.focus();return}case"h2":{const E=U.startLineNumber,D=$.getLineContent(E);K=`## ${D.replace(/^#+\s*/,"")}`,v.executeEdits("toolbar",[{range:{startLineNumber:E,startColumn:1,endLineNumber:E,endColumn:D.length+1},text:K}]),v.focus();return}case"h3":{const E=U.startLineNumber,D=$.getLineContent(E);K=`### ${D.replace(/^#+\s*/,"")}`,v.executeEdits("toolbar",[{range:{startLineNumber:E,startColumn:1,endLineNumber:E,endColumn:D.length+1},text:K}]),v.focus();return}case"list":{const E=U.startLineNumber,D=U.endLineNumber,F=[];for(let T=E;T<=D;T++)$.getLineContent(T).startsWith("- ")?F.push({range:{startLineNumber:T,startColumn:1,endLineNumber:T,endColumn:3},text:""}):F.push({range:{startLineNumber:T,startColumn:1,endLineNumber:T,endColumn:1},text:"- "});v.executeEdits("toolbar",F),v.focus();return}case"quote":{const E=U.startLineNumber,D=U.endLineNumber,F=[];for(let T=E;T<=D;T++)$.getLineContent(T).startsWith("> ")?F.push({range:{startLineNumber:T,startColumn:1,endLineNumber:T,endColumn:3},text:""}):F.push({range:{startLineNumber:T,startColumn:1,endLineNumber:T,endColumn:1},text:"> "});v.executeEdits("toolbar",F),v.focus();return}default:return}if(v.executeEdits("toolbar",[{range:U,text:K}]),oe&&!L){const E=v.getPosition();E&&v.setPosition({lineNumber:E.lineNumber,column:E.column+oe})}v.focus()},[]),ge=d=>{d.editor.defineTheme("obsidian",{base:"vs-dark",inherit:!0,rules:[{token:"comment",foreground:"6a737d",fontStyle:"italic"},{token:"keyword",foreground:"c792ea",fontStyle:"bold"},{token:"keyword.sql",foreground:"c792ea",fontStyle:"bold"},{token:"string",foreground:"c3e88d"},{token:"string.sql",foreground:"c3e88d"},{token:"number",foreground:"f78c6c"},{token:"number.sql",foreground:"f78c6c"},{token:"operator",foreground:"89ddff"},{token:"identifier",foreground:"eeffff"},{token:"function",foreground:"82aaff"},{token:"delimiter",foreground:"89ddff"},{token:"type",foreground:"ffcb6b"}],colors:{"editor.background":"#111113","editor.foreground":"#eeffff","editor.selectionBackground":"#2b3040","editor.lineHighlightBackground":"#1a1a1e","editorCursor.foreground":"#c792ea","editorWhitespace.foreground":"#2a2a30","editorIndentGuide.background":"#2a2a30","editorLineNumber.foreground":"#404050"}}),Ct(d,()=>M,j,()=>A),_t(d,()=>I,()=>C)},$e=(d,v)=>{S.current=d,f.current=v,v.editor.setTheme("obsidian"),d.onKeyDown($=>{($.shiftKey||$.metaKey||$.ctrlKey)&&($.keyCode===3||$.keyCode===13)&&($.preventDefault(),h())}),(H==="sql"||H==="python")&&d.addAction({id:`trigger-suggest-${H}-${s.id}`,label:"Trigger Suggest",keybindings:[v.KeyMod.CtrlCmd|v.KeyCode.Space],run:()=>d.trigger("keyboard","editor.action.triggerSuggest",{})})},H=s.language||"python";return e.jsxs("div",{className:"relative group/cell flex flex-col items-center w-full",children:[e.jsxs("div",{className:"flex w-full max-w-[1240px] 2xl:max-w-[1440px]",children:[e.jsx("div",{className:R("w-8 shrink-0 flex items-start justify-center pt-2.5 transition-opacity cursor-grab",l?"opacity-100":"opacity-0 group-hover/cell:opacity-40 hover:opacity-100"),children:e.jsx(fo,{className:"w-4 h-4 text-obsidian-muted"})}),e.jsxs("div",{className:R("flex-1 flex min-w-0 transition-all duration-200 rounded-md border",s.cell_type==="markdown"&&l?"flex-col":"flex-row",l?"border-white/10 bg-black/20 shadow-sm":"border-transparent hover:border-white/5 bg-transparent"),onClick:m,children:[s.cell_type==="markdown"&&l&&e.jsxs("div",{className:"w-full flex items-center justify-between px-3 py-1.5 border-b border-white/10 bg-white/[0.02] rounded-t-lg",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-obsidian-muted/80",children:[e.jsx("button",{onClick:d=>{d.stopPropagation(),z(!y)},className:R("px-2.5 py-1 mr-1 text-[11px] font-medium rounded-md border transition-colors",y?"text-white bg-white/10 border-white/20":"text-white/70 bg-transparent hover:bg-white/5 border-transparent"),children:y?"Hide preview":"Show preview"}),e.jsx("button",{onClick:d=>{d.stopPropagation(),Z("bold")},className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 transition-colors",title:"Bold (⌘B)",children:e.jsx(lo,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:d=>{d.stopPropagation(),Z("italic")},className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 transition-colors",title:"Italic (⌘I)",children:e.jsx(go,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:d=>{d.stopPropagation(),Z("code")},className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 transition-colors",title:"Code",children:e.jsx(St,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:d=>{d.stopPropagation(),Z("link")},className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 transition-colors",title:"Link",children:e.jsx(No,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:d=>{d.stopPropagation(),Z("image")},className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 transition-colors",title:"Image",children:e.jsx(Jt,{className:"w-3.5 h-3.5"})}),e.jsx("div",{className:"w-px h-3 bg-obsidian-border/60 mx-1"}),e.jsx("button",{onClick:d=>{d.stopPropagation(),Z("h1")},className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 transition-colors text-[11px] font-semibold",title:"Heading 1",children:"H1"}),e.jsx("button",{onClick:d=>{d.stopPropagation(),Z("h2")},className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 transition-colors text-[11px] font-semibold",title:"Heading 2",children:"H2"}),e.jsx("button",{onClick:d=>{d.stopPropagation(),Z("h3")},className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 transition-colors text-[11px] font-semibold",title:"Heading 3",children:"H3"}),e.jsx("button",{onClick:d=>{d.stopPropagation(),Z("list")},className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 transition-colors",title:"List",children:e.jsx(Qt,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:d=>{d.stopPropagation(),Z("quote")},className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 transition-colors",title:"Quote",children:e.jsx(_o,{className:"w-3.5 h-3.5"})})]}),e.jsxs("div",{className:"flex items-center gap-1.5 text-obsidian-muted",children:[e.jsx("span",{className:"px-2 py-0.5 mr-1 text-[11px] font-medium text-foreground/50 bg-[#252830] rounded border border-white/5",children:"Markdown"}),e.jsx("button",{onClick:d=>{d.stopPropagation(),vt("AI Generate requires an LLM API key configuration. Coming soon!")},className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 text-[#d7aef2] hover:text-[#f3d0ff] transition-colors",title:"AI Generate",children:e.jsx(ao,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:d=>{d.stopPropagation(),vt("Expand mode coming soon!")},className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 transition-colors",title:"Expand",children:e.jsx(Vt,{className:"w-3.5 h-3.5"})}),e.jsx("button",{className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 transition-colors",title:"More options",children:e.jsx(ft,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:d=>{d.stopPropagation(),b()},disabled:u<=1,className:"w-6 h-6 flex items-center justify-center rounded text-obsidian-danger/50 hover:text-obsidian-danger hover:bg-obsidian-danger/10 transition-colors disabled:opacity-20",title:"Delete cell",children:e.jsx(Ke,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex-1 flex min-w-0 relative",children:[e.jsx("div",{className:R("shrink-0 flex items-start pt-2 pl-2 pr-1 relative z-10 w-9 transition-opacity",s.cell_type==="markdown"&&!l?"opacity-0 pointer-events-none":"opacity-100"),children:e.jsx("button",{onClick:d=>{d.stopPropagation(),h()},disabled:s.running,className:R("w-6 h-6 flex items-center justify-center rounded-md transition-all",s.running?"text-white/60":"text-obsidian-muted hover:text-white hover:bg-white/10"),title:"Run cell (⌘↵ or ⇧↵)",children:s.running?e.jsx(Fe,{className:"w-4 h-4 animate-spin"}):e.jsx(ze,{className:"w-4 h-4 fill-current"})})}),e.jsxs("div",{className:"flex-1 min-w-0 flex flex-col pt-0.5 relative",children:[s.cell_type==="markdown"&&l&&e.jsx("div",{className:"absolute top-[8px] left-[32px] text-obsidian-muted/40 text-[12px] font-mono pointer-events-none z-10",children:"%md"}),s.cell_type==="markdown"&&!l?e.jsx("div",{className:"prose prose-invert prose-sm max-w-none text-foreground/80 min-h-[40px] px-3 py-2 cursor-text",children:e.jsx(Ve,{remarkPlugins:[Xe],children:s.source||"*Double-click or enter to edit markdown*"})}):e.jsxs("div",{className:R("relative",s.cell_type==="markdown"&&y&&"flex gap-0"),children:[e.jsx("div",{className:R(s.cell_type==="markdown"&&y?"w-1/2 border-r border-obsidian-border/30":"w-full"),children:e.jsx(Yt,{height:ae,language:s.cell_type==="markdown"?"markdown":H,theme:"obsidian",value:s.source,onChange:d=>p({source:d||""}),beforeMount:ge,onMount:(d,v)=>{$e(d,v),d.onDidContentSizeChange($=>{var U;if($.contentHeightChanged){const L=Math.max(40,Math.min($.contentHeight,500));Pe(L),(U=S.current)!=null&&U.getContainerDomNode()&&(S.current.getContainerDomNode().style.height=`${L}px`)}})},options:{scrollBeyondLastLine:!1,wordWrap:"on",wrappingIndent:"indent",minimap:{enabled:!1},lineNumbers:s.cell_type==="markdown"?"off":"on",lineNumbersMinChars:4,glyphMargin:!1,folding:s.cell_type!=="markdown",fontSize:13,fontFamily:"'JetBrains Mono', 'Fira Code', 'Cascadia Code', monospace",tabSize:4,renderLineHighlight:"all",padding:{top:s.cell_type==="markdown"?24:7,bottom:20},overviewRulerBorder:!1,scrollbar:{vertical:"hidden",horizontal:"auto",alwaysConsumeMouseWheel:!1},automaticLayout:!0,contextmenu:!1,matchBrackets:"near",fontLigatures:!0,quickSuggestions:{other:!0,comments:!1,strings:!1},suggestOnTriggerCharacters:!0,acceptSuggestionOnEnter:"on"}})}),s.cell_type==="markdown"&&y&&e.jsx("div",{className:"w-1/2 overflow-auto px-4 py-3 prose prose-invert prose-sm max-w-none text-foreground/80",style:{maxHeight:ae},children:e.jsx(Ve,{remarkPlugins:[Xe],children:s.source||"*Start typing to see preview...*"})})]}),s.outputs&&s.outputs.length>0&&e.jsx("div",{className:"w-full mt-1 border-t border-obsidian-border/30 bg-[#0c0c0d] rounded-b",children:e.jsx(Oo,{outputs:s.outputs})}),s.cell_type==="markdown"&&l&&e.jsx("div",{className:"w-full flex justify-end px-3 py-1 text-obsidian-muted/50 text-[11px] font-sans absolute bottom-0 right-0 pointer-events-none",children:"Generate (⌘ + I)"})]}),!(s.cell_type==="markdown"&&l)&&e.jsxs("div",{className:R("absolute top-0 right-0 flex items-center pt-1.5 pr-1.5 gap-0.5 transition-opacity z-10 bg-transparent pl-6",l?"opacity-100":"opacity-0 group-hover/cell:opacity-100"),children:[s.cell_type==="code"?e.jsxs("select",{value:s.language,onChange:d=>p({language:d.target.value}),className:"text-[11px] font-medium text-foreground/70 bg-transparent hover:bg-white/5 rounded px-2 py-1 appearance-none cursor-pointer outline-none transition-colors capitalize mr-1",children:[e.jsx("option",{value:"python",className:"bg-obsidian-panel text-foreground",children:"Python"}),e.jsx("option",{value:"sql",className:"bg-obsidian-panel text-foreground",children:"SQL"})]}):e.jsx("span",{className:"text-[11px] font-medium text-foreground/50 px-2 py-1 mr-1",children:"Markdown"}),e.jsx("button",{onClick:d=>{d.stopPropagation(),w()},disabled:a===0,className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 text-foreground/40 hover:text-foreground disabled:opacity-20 transition-colors",title:"Move up",children:e.jsx(Lt,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:d=>{d.stopPropagation(),k()},disabled:a===u-1,className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 text-foreground/40 hover:text-foreground disabled:opacity-20 transition-colors",title:"Move down",children:e.jsx(Oe,{className:"w-3.5 h-3.5"})}),e.jsx("button",{className:"w-6 h-6 flex items-center justify-center rounded hover:bg-white/10 text-foreground/40 hover:text-foreground transition-colors",title:"More options",children:e.jsx(ft,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:d=>{d.stopPropagation(),b()},disabled:u<=1,className:"w-6 h-6 flex items-center justify-center rounded text-obsidian-danger/50 hover:text-obsidian-danger hover:bg-obsidian-danger/10 transition-colors disabled:opacity-20",title:"Delete cell",children:e.jsx(Ke,{className:"w-4 h-4"})})]})]})]})]}),s.cell_type==="markdown"&&l&&e.jsxs("div",{className:"w-full flex-col items-center justify-center text-obsidian-muted/40 text-[11px] font-mono mt-8 leading-loose text-center mb-4 tracking-wide",children:["[Shift+Enter] to run and move to next cell",e.jsx("br",{}),"[Cmd+Shift+P] to open the command palette",e.jsx("br",{}),"[Esc H] to see all keyboard shortcuts"]}),e.jsxs("div",{className:"w-full max-w-[1200px] 2xl:max-w-[1400px] h-6 relative flex items-center justify-center group/divider",children:[e.jsx("div",{className:"w-full h-px bg-obsidian-border/20 group-hover/divider:bg-obsidian-border/40 transition-colors"}),e.jsxs("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 flex items-center gap-2 opacity-0 group-hover/divider:opacity-100 transition-opacity z-10",children:[e.jsxs("button",{onClick:d=>{d.stopPropagation(),N("code")},className:"flex items-center gap-1 px-2.5 py-1 bg-[#121214] border border-white/10 rounded text-[10px] text-white/50 hover:text-white hover:border-white/20 hover:bg-white/5 transition-colors shadow-sm",title:"Add Code Cell",children:[e.jsx(je,{className:"w-3.5 h-3.5"})," Code"]}),e.jsxs("button",{onClick:d=>{d.stopPropagation(),N("markdown")},className:"flex items-center gap-1 px-2.5 py-1 bg-[#121214] border border-white/10 rounded text-[10px] text-white/50 hover:text-white hover:border-white/20 hover:bg-white/5 transition-colors shadow-sm",title:"Add Markdown Cell",children:[e.jsx(je,{className:"w-3.5 h-3.5"})," Markdown"]})]})]})]})}function rn(){var dt,ut;const s=Xt(),[a,u]=i.useState([ve]),[l,m]=i.useState(ve.id),[p,b]=i.useState(null),[w,k]=i.useState("disconnected"),[h,N]=i.useState("Untitled"),[M,j]=i.useState(!1),[A,I]=i.useState(""),[C,S]=i.useState(["Untitled"]),[f,se]=i.useState([]),[re,ae]=i.useState(!0),[Pe,y]=i.useState("local"),[z,Z]=i.useState("python"),[ge,$e]=i.useState(null),[H,d]=i.useState(null),[v,$]=i.useState(!1),[U,L]=i.useState([]),[K,oe]=i.useState([]),[E,D]=i.useState([]),[F,T]=i.useState([]),[Ce,Ye]=i.useState("small"),[O,Ee]=i.useState("small"),[B,He]=i.useState(null),[Ue,et]=i.useState(!1),[_,tt]=i.useState(null),[ot,nt]=i.useState(!1),[ie,st]=i.useState(!0),[me,V]=i.useState(null),[_e,rt]=i.useState(null),Re=i.useRef(new Map),we=i.useRef(null),ee=i.useRef(0),Mt=Je.useMemo(()=>Eo(a),[a]),Se=i.useCallback(t=>new Promise(o=>{we.current=o,rt(t)}),[]),De=i.useCallback(t=>{const o=we.current;we.current=null,rt(null),o&&o(t)},[]);i.useEffect(()=>{if(!me)return;const t=window.setTimeout(()=>V(null),3500);return()=>window.clearTimeout(t)},[me]),i.useEffect(()=>()=>{we.current&&(we.current(!1),we.current=null)},[]),i.useEffect(()=>{const t=o=>{const r=o.detail,n=r==null?void 0:r.message;n&&V({tone:"info",message:n})};return window.addEventListener("openclaw:notebooks-notice",t),()=>window.removeEventListener("openclaw:notebooks-notice",t)},[]),i.useEffect(()=>{if(!s)return;let t=!0;return(async()=>{const[o,r]=await Promise.all([jt(s,"sql",["keywords"]),jt(s,"python",["keywords","builtins","typeKeywords"])]);t&&(oe(o),D(r))})(),()=>{t=!1}},[s]);const g=i.useCallback(async(t,o)=>{const r=await fetch(t,o),n=await r.json().catch(()=>({}));if(!r.ok){const c=(n==null?void 0:n.detail)||(n==null?void 0:n.error)||`HTTP ${r.status}`;throw new Error(String(c))}return n},[]),pe=i.useCallback(async(t,o)=>{const r={query:t};o&&(r.catalog=o);const n=await g("/api/trino",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});return Array.isArray(n==null?void 0:n.data)?n.data:[]},[g]),Be=i.useCallback(async()=>{const t=["iceberg","lakehouse","delta","hive","postgres"],c=new Map,x=Y=>{const J=`${Y.kind}:${Y.fqn}`.toLowerCase();c.has(J)||c.set(J,Y)};try{const de=(await pe("SHOW CATALOGS")).map(P=>Me(P,["Catalog","catalog","catalog_name"])).filter(P=>!!P).filter((P,q,ue)=>ue.findIndex(G=>G.toLowerCase()===P.toLowerCase())===q).sort((P,q)=>{const ue=t.indexOf(P.toLowerCase()),G=t.indexOf(q.toLowerCase()),Ne=ue===-1?999:ue,fe=G===-1?999:G;return Ne!==fe?Ne-fe:P.localeCompare(q)}).slice(0,4);for(const P of de){x({label:P,detail:"catalog",fqn:P,kind:"catalog"});let q=[];try{q=await pe(`SHOW SCHEMAS FROM ${be(P)}`,P)}catch{q=[]}const ue=q.map(G=>Me(G,["Schema","schema","schema_name"])).filter(G=>!!G).slice(0,8);for(const G of ue){const Ne=`${P}.${G}`;x({label:G,detail:`schema (${P})`,fqn:Ne,kind:"schema"});let fe=[];try{fe=await pe(`SELECT table_name, table_type FROM ${be(P)}.information_schema.tables WHERE table_schema = '${Po(G)}' ORDER BY table_name LIMIT 200`,P)}catch{try{fe=await pe(`SHOW TABLES FROM ${be(P)}.${be(G)}`,P)}catch{fe=[]}}for(const ht of fe){const Ze=Me(ht,["table_name","Table","name"]);if(!Ze)continue;const mt=(Me(ht,["table_type"])||"TABLE").toUpperCase().includes("VIEW")?"view":"table",Bt=`${Ne}.${Ze}`;x({label:Ze,detail:`${mt} (${Ne})`,fqn:Bt,kind:mt})}}}}catch(Y){console.error("Failed to refresh notebook SQL metadata:",Y)}const W=Array.from(c.values()).sort((Y,J)=>Y.fqn.localeCompare(J.fqn));L(W),Re.current.clear()},[pe]),At=i.useCallback(async t=>{const o=t.trim();if(!o)return[];const r=Re.current.get(o);if(r)return r;const n=o.split(".");if(n.length<3)return[];const c=n[0],x=n[1],W=n.slice(2).join(".");try{const J=(await pe(`SHOW COLUMNS FROM ${be(c)}.${be(x)}.${be(W)}`,c)).map(de=>Me(de,["Column","column","Field","name"])).filter(Boolean).map(de=>({label:String(de),detail:`column (${o})`,fqn:`${o}.${String(de)}`,kind:"column"}));return Re.current.set(o,J),J.length>0&&L(de=>{const P=new Map;for(const q of de)P.set(`${q.kind}:${q.fqn}`.toLowerCase(),q);for(const q of J)P.set(`${q.kind}:${q.fqn}`.toLowerCase(),q);return Array.from(P.values()).sort((q,ue)=>q.fqn.localeCompare(ue.fqn))}),J}catch{return Re.current.set(o,[]),[]}},[pe]),te=i.useCallback(async()=>{var t;try{const o=await g("/api/notebook/clusters"),r=Array.isArray(o==null?void 0:o.clusters)?o.clusters:[],n=String((o==null?void 0:o.default_cluster_id)||((t=r[0])==null?void 0:t.id)||"small");return T(r),Ye(n),Ee(c=>c&&r.some(x=>x.id===c)?c:n),st(!0),nt(!0),n}catch(o){return console.warn("Notebook cluster API unavailable; falling back to legacy kernel mode.",o),st(!1),T([{id:"default",label:"Default",description:"Legacy notebook backend (cluster API unavailable)",runtime_mode:"legacy",limits:{},runtime:{status:"running",active_sessions:1}}]),Ye("default"),Ee("default"),nt(!0),"default"}},[g]),ne=i.useCallback(async t=>{if(!ie){tt(null);return}const o=(t||B||O||Ce||"").trim();if(o)try{const r=await g(`/api/notebook/observability?cluster_id=${encodeURIComponent(o)}`),n=Array.isArray(r==null?void 0:r.clusters)?r.clusters[0]:null;tt(n||null)}catch(r){console.error("Failed to refresh cluster observability:",r)}},[ie,B,O,Ce,g]),at=i.useCallback(async t=>{const o=(t||"small").trim();k("starting"),ee.current=0;try{const r=ie?{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cluster_id:o})}:{method:"POST"},n=await g("/api/notebook/kernels",r);b(n.id),y(n.mode),He(n.cluster_id||o||null),n.cluster_id&&Ee(String(n.cluster_id)),k("idle"),await ne(n.cluster_id||o||null),te().catch(()=>{})}catch(r){console.error("Failed to start kernel:",r),ee.current=0,k("disconnected")}},[ie,g,ne,te]),We=i.useCallback(async()=>{if(p){k("starting"),ee.current=0;try{const t=await g(`/api/notebook/kernels/${encodeURIComponent(p)}/restart`,{method:"POST"});k("idle"),t!=null&&t.cluster_id&&He(String(t.cluster_id)),u(o=>o.map(r=>({...r,outputs:[],execution_count:null}))),await ne((t==null?void 0:t.cluster_id)||B),te().catch(()=>{})}catch(t){console.error("Failed to restart kernel:",t),ee.current=0,k("disconnected")}}},[p,g,B,ne,te]),Pt=i.useCallback(async()=>{if(p)try{await g(`/api/notebook/kernels/${encodeURIComponent(p)}/interrupt`,{method:"POST"})}catch(t){console.error("Failed to interrupt kernel:",t)}},[p,g]),$t=i.useCallback(async()=>{if(!(!p||!O)){if(!ie){V({tone:"error",message:"Bu backend sürümünde cluster attach API yok. openclaw-api containerını güncel kodla yeniden build et."});return}et(!0),k("starting"),ee.current=0;try{const t=await g(`/api/notebook/kernels/${encodeURIComponent(p)}/attach`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cluster_id:O,restart:!0})});He(t.cluster_id||O),k("idle"),u(o=>o.map(r=>({...r,outputs:[],execution_count:null}))),await ne(t.cluster_id||O),te().catch(()=>{})}catch(t){console.error("Failed to attach cluster:",t),ee.current=0,k("disconnected"),V({tone:"error",message:`Failed to attach cluster: ${String(t)}`})}finally{et(!1)}}},[ie,p,O,g,ne,te]);i.useEffect(()=>{let t=!0;return(async()=>{try{const o=await te();if(!t)return;await at(o)}catch(o){console.error("Failed to initialize notebook clusters/kernel:",o),t&&k("disconnected")}})(),()=>{t=!1}},[te,at]),i.useEffect(()=>{if(!ot)return;const t=window.setInterval(()=>{te().catch(()=>{})},3e4);return()=>window.clearInterval(t)},[ot,te]),i.useEffect(()=>{if(!B)return;ne(B);const t=window.setInterval(()=>{ne(B)},8e3);return()=>window.clearInterval(t)},[B,ne]),i.useEffect(()=>{Be();const t=window.setInterval(()=>{Be()},300*1e3);return()=>window.clearInterval(t)},[Be]);const X=i.useCallback(async()=>{try{const t=await g("/api/notebook/files");se(t.notebooks||[])}catch(t){console.error("Failed to load notebooks:",t)}},[g]);i.useEffect(()=>{X()},[X]);const Ie=i.useCallback(async()=>{try{const t=await g("/api/notebook/files",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:h,cells:a.map(o=>({id:o.id,cell_type:o.cell_type,source:o.source,language:o.language,outputs:o.outputs,execution_count:o.execution_count}))})});t!=null&&t.name&&t.name!==h&&(N(t.name),S(o=>o.map(r=>r===h?t.name:r))),X()}catch(t){console.error("Failed to save:",t),V({tone:"error",message:`Failed to save notebook: ${String(t)}`})}},[h,a,X,g]),it=i.useCallback(async()=>{let t=1,o=`Untitled-${t}`;for(;f.some(n=>n.name===o);)t++,o=`Untitled-${t}`;const r=[{...ve,id:he()}];try{const n=await g("/api/notebook/files",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:o,cells:r.map(x=>({id:x.id,cell_type:x.cell_type,source:x.source,language:x.language,outputs:x.outputs,execution_count:x.execution_count}))})}),c=(n==null?void 0:n.name)||o;await X(),N(c),u(r),m(r[0].id),S(x=>x.includes(c)?x:[...x,c]),j(!1)}catch(n){console.error("Failed to create new notebook:",n),V({tone:"error",message:`Failed to create notebook: ${String(n)}`})}},[f,X,g]),xe=i.useCallback(async t=>{try{const o=await g(`/api/notebook/files/${encodeURIComponent(t)}`),r=(o.cells||[]).map(c=>({...c,id:c.id||he(),running:!1,outputs:c.outputs||[]})),n={...ve,id:he()};N(o.name||t),u(r.length>0?r:[n]),m(r.length>0?r[0].id:n.id),S(c=>c.includes(o.name||t)?c:[...c,o.name||t]),j(!1)}catch(o){console.error("Failed to load notebook:",o),V({tone:"error",message:`Failed to load notebook '${t}': ${String(o)}`})}},[g]),Ge=i.useCallback((t,o="code")=>{const r={id:he(),cell_type:o,source:"",language:z,outputs:[],execution_count:null,running:!1};u(n=>{if(!t)return[...n,r];const c=n.findIndex(W=>W.id===t),x=[...n];return x.splice(c+1,0,r),x}),m(r.id)},[z]),le=i.useCallback((t,o)=>{u(r=>r.map(n=>n.id===t?{...n,...o}:n))},[]),Te=i.useCallback(t=>{u(o=>{if(o.length<=1)return o;const r=o.findIndex(c=>c.id===t),n=o.filter(c=>c.id!==t);return l===t&&m(n[Math.min(r,n.length-1)].id),n})},[l]),Et=i.useCallback(async(t,o)=>{if(o.stopPropagation(),!!await Se({title:"Delete notebook?",message:`This will permanently delete '${t}'.`,confirmLabel:"Delete",tone:"danger"}))try{await g(`/api/notebook/files/${encodeURIComponent(t)}`,{method:"DELETE"}),await X();const n=C.filter(c=>c!==t);if(n.length===0){S(["Untitled"]),N("Untitled");const c=he();u([{...ve,id:c}]),m(c);return}S(n),t===h&&xe(n[n.length-1])}catch(n){console.error("Failed to delete notebook:",n),V({tone:"error",message:`Failed to delete '${t}': ${String(n)}`})}},[X,h,xe,C,g,Se]),Rt=i.useCallback((t,o)=>{o.stopPropagation();const r=C.filter(n=>n!==t);if(r.length===0){S(["Untitled"]),N("Untitled");const n=he();u([{...ve,id:n}]),m(n)}else S(r),(t===h||M&&t===A)&&xe(r[r.length-1])},[C,h,M,A,xe]),lt=i.useCallback(async()=>{const t=h.trim();if(!t){N(A||"Untitled"),j(!1);return}if(!A||A===t){N(t),j(!1);return}if(!f.some(r=>r.name===A)){N(t),S(r=>r.map(n=>n===A?t:n)),j(!1);return}try{const r=await g("/api/notebook/files/rename",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({old_name:A,new_name:t})}),n=(r==null?void 0:r.name)||t;N(n),S(c=>c.map(x=>x===A?n:x)),await X()}catch(r){console.error("Failed to rename notebook:",r),N(A),V({tone:"error",message:`Failed to rename notebook: ${String(r)}`})}finally{j(!1)}},[A,h,f,g,X]),ct=i.useCallback((t,o)=>{u(r=>{const n=r.findIndex(W=>W.id===t);if(o==="up"&&n<=0||o==="down"&&n>=r.length-1)return r;const c=[...r],x=o==="up"?n-1:n+1;return[c[n],c[x]]=[c[x],c[n]],c})},[]),ce=i.useCallback(async t=>{const o=a.find(n=>n.id===t);if(!o||!p)return;ee.current+=1,le(t,{running:!0,outputs:[]}),k("busy");let r=o.source;o.language==="sql"&&!r.trimStart().startsWith("%%sql")&&(r=`%%sql
`+r);try{const n=await fetch(`/api/notebook/kernels/${encodeURIComponent(p)}/execute`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:r})}),c=await n.json().catch(()=>({}));if(!n.ok)throw new Error((c==null?void 0:c.detail)||(c==null?void 0:c.error)||`HTTP ${n.status}`);le(t,{running:!1,outputs:c.outputs||[],execution_count:c.execution_count})}catch(n){le(t,{running:!1,outputs:[{output_type:"error",ename:"ExecutionError",evalue:String(n),traceback:[]}]})}finally{ee.current=Math.max(0,ee.current-1),k(n=>n==="disconnected"||n==="starting"?n:ee.current===0?"idle":"busy")}},[a,p,le]),ye=i.useCallback(async()=>{for(const t of a)t.cell_type==="code"&&await ce(t.id)},[a,ce]),It=i.useCallback(async()=>{const t=a.findIndex(o=>o.id===l);for(let o=0;o<t;o++)a[o].cell_type==="code"&&await ce(a[o].id)},[a,l,ce]),Tt=i.useCallback(async()=>{const t=a.findIndex(o=>o.id===l);for(let o=t;o<a.length;o++)a[o].cell_type==="code"&&await ce(a[o].id)},[a,l,ce]),qt=i.useCallback(async()=>{await Se({title:"Restart kernel?",message:"All in-memory variables will be lost, then all code cells will run.",confirmLabel:"Restart & Run",tone:"danger"})&&(await We(),await ye())},[We,ye,Se]),zt=i.useCallback(()=>{u(t=>t.map(o=>({...o,outputs:[],execution_count:null})))},[]),Ot=i.useCallback(()=>{const t=a.find(o=>o.id===l);t&&($e({...t}),Te(l))},[a,l,Te]),Ft=i.useCallback(()=>{const t=a.find(o=>o.id===l);t&&$e({...t})},[a,l]),Kt=i.useCallback(()=>{if(!ge)return;const t={...ge,id:he(),running:!1,outputs:[],execution_count:null};u(o=>{const r=o.findIndex(c=>c.id===l),n=[...o];return n.splice(r+1,0,t),n}),m(t.id)},[ge,l]),Ht=i.useCallback(async()=>{try{const t=await g(`/api/notebook/files/${encodeURIComponent(h)}`),o={nbformat:4,nbformat_minor:5,metadata:{kernelspec:{display_name:"Python 3",language:"python",name:"python3"},language_info:{name:"python",version:"3.11"}},cells:(t.cells||[]).map(x=>({cell_type:x.cell_type==="code"?"code":"markdown",source:x.source.split(`
`).map((W,Y,J)=>Y<J.length-1?W+`
`:W),metadata:{},...x.cell_type==="code"?{outputs:x.outputs||[],execution_count:x.execution_count}:{}}))},r=new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),n=URL.createObjectURL(r),c=document.createElement("a");c.href=n,c.download=`${h}.ipynb`,c.click(),URL.revokeObjectURL(n)}catch(t){console.error("Failed to export:",t),V({tone:"error",message:"Failed to export notebook"})}},[h,g]),Ut=i.useCallback(()=>{const t=["# Databricks notebook source","# Exported from OpenClaw Workspace",""];a.forEach((c,x)=>{x>0&&t.push(""),c.cell_type==="markdown"?(t.push("# MAGIC %md"),c.source.split(`
`).forEach(W=>{t.push(`# MAGIC ${W}`)})):c.language==="sql"?(t.push("# COMMAND ----------"),t.push(""),t.push("# MAGIC %sql"),c.source.split(`
`).forEach(W=>{t.push(`# MAGIC ${W}`)})):(t.push("# COMMAND ----------"),t.push(""),t.push(c.source))}),t.push("");const o=new Blob([t.join(`
`)],{type:"text/x-python"}),r=URL.createObjectURL(o),n=document.createElement("a");n.href=r,n.download=`${h}.py`,n.click(),URL.revokeObjectURL(r)},[a,h]),Dt=i.useCallback((t,o)=>{const r=o.split(`
`)[0].trim().toLowerCase();let n=null;r==="%sql"||r==="%%sql"?n="sql":(r==="%python"||r==="%%python")&&(n="python"),n?le(t,{source:o,language:n}):le(t,{source:o})},[le]);i.useEffect(()=>{if(!H)return;const t=()=>d(null);return window.addEventListener("click",t),()=>window.removeEventListener("click",t)},[H]),i.useEffect(()=>{const t=o=>{(o.metaKey||o.ctrlKey)&&o.key==="s"&&(o.preventDefault(),Ie()),(o.metaKey||o.ctrlKey)&&o.shiftKey&&o.key==="Enter"&&(o.preventDefault(),ye())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[Ie,ye]);const Le=Je.useMemo(()=>F.find(t=>t.id===O)||null,[F,O]),ke=Je.useMemo(()=>F.find(t=>t.id===(B||O))||null,[F,B,O]);return e.jsxs("div",{className:"flex h-screen bg-[#09090b] text-foreground font-sans overflow-hidden relative",style:{fontFamily:"'Inter', -apple-system, sans-serif"},children:[e.jsx("div",{className:"absolute top-0 left-0 w-[800px] h-[800px] bg-purple-500/5 rounded-full blur-[120px] pointer-events-none -translate-x-1/4 -translate-y-1/4 z-0"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-[600px] h-[600px] bg-sky-500/5 rounded-full blur-[100px] pointer-events-none translate-x-1/4 -translate-y-1/4 z-0"}),e.jsx("div",{className:"relative z-10 shrink-0",children:e.jsx(Wt,{})}),re&&e.jsxs("div",{className:"w-[260px] bg-black/20 backdrop-blur-xl border-r border-white/5 shrink-0 flex flex-col z-10 relative shadow-[4px_0_24px_rgba(0,0,0,0.4)]",children:[e.jsxs("div",{className:"h-10 border-b border-white/5 flex items-center justify-between px-4 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pt,{className:"w-3.5 h-3.5 text-sky-400 opacity-80"}),e.jsx("span",{className:"text-xs font-semibold text-white/90 tracking-wide",children:"Notebooks"})]}),e.jsxs("div",{className:"flex gap-1 shrink-0",children:[e.jsx("button",{onClick:X,className:"p-1 hover:bg-white/10 rounded text-obsidian-muted hover:text-white transition-all active:scale-95",title:"Refresh",children:e.jsx(eo,{className:"w-3 h-3"})}),e.jsx("button",{onClick:it,className:"p-1 hover:bg-white/10 rounded text-obsidian-muted hover:text-white transition-all active:scale-95",title:"New notebook",children:e.jsx(je,{className:"w-3 h-3"})})]})]}),e.jsx("div",{className:"flex-1 overflow-auto py-2 custom-scrollbar",children:f.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-obsidian-muted gap-2",children:[e.jsx(pt,{className:"w-4 h-4 opacity-50"}),e.jsx("span",{className:"text-[10px]",children:"No notebooks saved."})]}):e.jsx("div",{className:"flex flex-col pl-2 pr-2",children:f.map(t=>{const o=h===t.name;return e.jsxs("div",{onClick:()=>xe(t.name),className:R("flex items-center gap-1.5 py-1.5 px-2 hover:bg-white/5 rounded-md transition-colors cursor-pointer group relative",o?"bg-white/10":""),children:[e.jsx(Qe,{className:R("w-3.5 h-3.5",o?"text-white/80":"text-obsidian-muted group-hover:text-white/80")}),e.jsx("div",{className:"min-w-0 flex-1",children:e.jsx("span",{className:R("truncate block text-[12px] font-medium",o?"text-white":"text-foreground/70 group-hover:text-white"),children:t.name})}),e.jsx("button",{onClick:r=>Et(t.name,r),className:"opacity-0 group-hover:opacity-100 p-1 hover:bg-red-500/20 text-white/40 hover:text-red-400 rounded transition-all active:scale-95",title:"Delete Notebook",children:e.jsx(Ke,{className:"w-3 h-3"})})]},t.filename)})})})]}),e.jsxs("main",{className:"flex-1 flex flex-col min-w-0 bg-transparent backdrop-blur-xl relative z-10",children:[e.jsxs("header",{className:"flex items-center px-4 justify-between shrink-0 h-12 bg-[#09090b]/60 backdrop-blur-xl border-b border-white/[0.06] z-20 relative shadow-sm",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-[1px] bg-gradient-to-r from-transparent via-white/[0.05] to-transparent pointer-events-none"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>ae(!re),className:"p-1.5 hover:bg-white/[0.08] rounded-md text-white/50 hover:text-white transition-all active:scale-95 flex items-center justify-center border border-transparent hover:border-white/[0.05] shadow-sm cursor-pointer",title:"Toggle Notebooks Explorer",children:e.jsx(to,{className:"w-[18px] h-[18px]"})}),e.jsx("div",{className:"w-[1px] h-5 bg-gradient-to-b from-transparent via-white/10 to-transparent mx-1 rounded-full"}),e.jsxs("div",{className:"flex items-center gap-0.5 relative",children:[[{label:"File",items:[{label:"New Notebook",shortcut:"",action:()=>it(),icon:e.jsx(je,{className:"w-3.5 h-3.5"})},{label:"Save",shortcut:"⌘S",action:()=>Ie(),icon:e.jsx(gt,{className:"w-3.5 h-3.5"})},{label:"Export as .ipynb",shortcut:"",action:()=>Ht(),icon:e.jsx(wt,{className:"w-3.5 h-3.5"})},{label:"Export as .py",shortcut:"",action:()=>Ut(),icon:e.jsx(wt,{className:"w-3.5 h-3.5"})},{divider:!0},{label:"Rename",shortcut:"",action:()=>{I(h),j(!0)},icon:e.jsx(Qe,{className:"w-3.5 h-3.5"})}]},{label:"Edit",items:[{label:"Cut Cell",shortcut:"⌘X",action:()=>Ot(),icon:e.jsx(Ao,{className:"w-3.5 h-3.5"})},{label:"Copy Cell",shortcut:"⌘C",action:()=>Ft(),icon:e.jsx(Gt,{className:"w-3.5 h-3.5"})},{label:"Paste Cell Below",shortcut:"⌘V",action:()=>Kt(),icon:e.jsx(ho,{className:"w-3.5 h-3.5"}),disabled:!ge},{divider:!0},{label:"Clear All Outputs",shortcut:"",action:()=>zt(),icon:e.jsx(po,{className:"w-3.5 h-3.5"})},{label:"Delete Cell",shortcut:"⌫",action:()=>{a.length>1&&Te(l)},icon:e.jsx(Ke,{className:"w-3.5 h-3.5"}),disabled:a.length<=1}]},{label:"View",items:[{label:re?"Hide Sidebar":"Show Sidebar",shortcut:"",action:()=>ae(!re),icon:e.jsx(jo,{className:"w-3.5 h-3.5"})}]},{label:"Run",items:[{label:"Run Cell",shortcut:"⇧↵",action:()=>ce(l),icon:e.jsx(ze,{className:"w-3.5 h-3.5"})},{label:"Run All",shortcut:"⌘⇧↵",action:()=>ye(),icon:e.jsx(ze,{className:"w-3.5 h-3.5"})},{divider:!0},{label:"Run All Above",shortcut:"",action:()=>It(),icon:e.jsx(Lt,{className:"w-3.5 h-3.5"})},{label:"Run All Below",shortcut:"",action:()=>Tt(),icon:e.jsx(Oe,{className:"w-3.5 h-3.5"})},{divider:!0},{label:"Interrupt Kernel",shortcut:"",action:()=>Pt(),icon:e.jsx(no,{className:"w-3.5 h-3.5"})},{label:"Restart Kernel",shortcut:"",action:async()=>{await Se({title:"Restart kernel?",message:"All in-memory variables will be lost.",confirmLabel:"Restart",tone:"danger"})&&await We()},icon:e.jsx(Lo,{className:"w-3.5 h-3.5"})},{label:"Restart & Run All",shortcut:"",action:()=>qt(),icon:e.jsx(oo,{className:"w-3.5 h-3.5"})}]},{label:"Help",items:[{label:"Keyboard Shortcuts",shortcut:"",action:()=>$(!0),icon:e.jsx(yo,{className:"w-3.5 h-3.5"})}]}].map(t=>e.jsxs("div",{className:"relative group/menu",children:[e.jsx("button",{onClick:o=>{o.stopPropagation(),d(H===t.label?null:t.label)},className:R("px-3 py-1.5 rounded-md text-[13px] font-medium transition-all duration-200 tracking-tight",H===t.label?"text-white bg-white/10 shadow-inner":"text-white/60 hover:text-white hover:bg-white/[0.06]"),children:t.label}),H===t.label&&e.jsx("div",{className:"absolute top-[calc(100%+4px)] left-0 w-56 bg-[#18181b]/95 border border-white/10 rounded-xl shadow-2xl z-50 overflow-hidden py-1.5 backdrop-blur-2xl ring-1 ring-black/50",onClick:o=>o.stopPropagation(),children:t.items.map((o,r)=>o.divider?e.jsx("div",{className:"h-[1px] bg-gradient-to-r from-transparent via-white/10 to-transparent my-1.5 mx-2"},`div-${r}`):e.jsxs("button",{onClick:()=>{o.action(),d(null)},disabled:o.disabled,className:"w-full flex items-center gap-3 px-3 py-1.5 text-[12px] font-medium text-white/70 hover:text-white hover:bg-blue-500/10 transition-colors disabled:opacity-30 disabled:cursor-not-allowed group/item",children:[e.jsx("span",{className:"text-white/40 group-hover/item:text-blue-400 transition-colors",children:o.icon}),e.jsx("span",{className:"flex-1 text-left",children:o.label}),o.shortcut&&e.jsx("span",{className:"text-[10px] text-white/30 font-mono tracking-wider",children:o.shortcut})]},`btn-${r}`))})]},t.label)),e.jsx("div",{className:"w-[1px] h-5 bg-gradient-to-b from-transparent via-white/10 to-transparent mx-3 rounded-full"}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:t=>{t.stopPropagation(),d(H==="lang"?null:"lang")},className:R("flex items-center gap-1.5 px-3 py-1.5 rounded-md text-[13px] font-bold tracking-wide transition-all",H==="lang"?"text-blue-400 bg-blue-500/10 shadow-inner":"text-white/70 hover:text-white hover:bg-white/[0.06]"),children:[e.jsx("span",{children:z==="python"?"Python":"SQL"}),e.jsx(Oe,{className:R("w-3.5 h-3.5 transition-transform opacity-70",H==="lang"&&"rotate-180")})]}),H==="lang"&&e.jsx("div",{className:"absolute top-[calc(100%+4px)] left-0 w-40 bg-[#18181b]/95 border border-white/10 rounded-xl shadow-2xl z-50 overflow-hidden py-1.5 backdrop-blur-2xl ring-1 ring-black/50",onClick:t=>t.stopPropagation(),children:[{id:"python",label:"Python"},{id:"sql",label:"SQL"}].map(t=>e.jsxs("button",{onClick:()=>{Z(t.id),d(null)},className:"w-full flex items-center gap-3 px-3 py-1.5 text-[12px] font-medium transition-colors hover:bg-blue-500/10 hover:text-blue-400 group/lang text-white/70",children:[e.jsx("div",{className:"flex items-center justify-center w-4 h-4",children:z===t.id?e.jsx(bt,{className:"w-4 h-4 text-blue-400"}):null}),e.jsx("span",{className:z===t.id?"text-white":"",children:t.label})]},t.id))})]})]})]}),e.jsxs("div",{className:"flex items-center gap-1 xl:gap-2 justify-end min-w-0 flex-1",children:[e.jsxs("button",{onClick:ye,disabled:!p||w==="busy"||w==="starting"||w==="disconnected",className:"flex-shrink-0 whitespace-nowrap flex items-center gap-1.5 px-2.5 xl:px-3 py-1.5 rounded-md hover:bg-white/[0.08] transition-all cursor-pointer group/run active:scale-95 text-[12px] font-medium text-white/70 hover:text-white disabled:opacity-50",children:[e.jsx(ze,{className:"w-3.5 h-3.5 opacity-70 group-hover/run:text-green-400 group-hover/run:opacity-100 transition-colors"}),"Run all"]}),e.jsxs("div",{className:"hidden md:flex items-center h-[28px] p-[2px] rounded border border-white/5 bg-[#09090b]/80 shadow-md relative z-10 flex-shrink-0 ring-1 ring-white/[0.02]",children:[e.jsxs("div",{className:"flex items-center gap-1.5 pl-2 pr-1 h-full hover:bg-white/[0.04] rounded-sm transition-colors cursor-pointer group/select w-[140px] xl:w-[200px]",children:[e.jsx(xt,{className:"w-[11px] h-[11px] text-white/30 group-hover/select:text-white/50 transition-colors flex-shrink-0"}),e.jsxs("div",{className:"relative flex items-center h-full flex-1 min-w-0",children:[e.jsx("select",{value:O,onChange:t=>Ee(t.target.value),className:"bg-transparent text-[11px] text-white/60 group-hover/select:text-white/90 font-medium outline-none cursor-pointer appearance-none w-full pr-5 pl-0.5 h-full truncate transition-colors",disabled:Ue||w==="busy",children:F.map(t=>e.jsxs("option",{value:t.id,className:"bg-[#18181b] text-white",children:[t.label," • ",qe(t)]},t.id))}),e.jsx(Oe,{className:"w-3 h-3 text-white/20 group-hover/select:text-white/40 absolute right-0 pointer-events-none flex-shrink-0 transition-colors"})]})]}),e.jsx("div",{className:"w-[1px] h-3.5 bg-white/[0.08] mx-0.5 flex-shrink-0"}),e.jsxs("button",{onClick:$t,disabled:!p||Ue||w==="busy"||!O||!ie||O===B,className:`flex-shrink-0 h-full whitespace-nowrap flex items-center gap-1.5 px-2 rounded-sm text-[11px] font-medium transition-all
                                disabled:opacity-40 disabled:cursor-not-allowed
                                hover:bg-white/[0.04] text-white/60 hover:text-white active:scale-95`,title:"Attach selected cluster profile",children:[Ue?e.jsx(Fe,{className:"w-[11px] h-[11px] animate-spin text-blue-400"}):null,e.jsx("span",{className:B===O?"text-green-400/90 font-semibold":"",children:B===O?"Attached":"Attach"})]})]}),Le&&e.jsx("div",{className:"hidden xl:flex items-center gap-2 text-[11px] font-mono min-w-0 flex-1 max-w-[200px] 2xl:max-w-[400px] px-2 opacity-50",children:e.jsxs("span",{className:"text-white/50 truncate block w-full",title:`${Le.label}: ${qe(Le)}`,children:[Le.label,": ",e.jsx("span",{className:"opacity-70",children:qe(Le)})]})}),((_==null?void 0:_.spark_ui_url)||(_==null?void 0:_.spark_master_ui_url))&&e.jsxs("a",{href:(_==null?void 0:_.spark_ui_url)||(_==null?void 0:_.spark_master_ui_url)||"#",target:"_blank",rel:"noreferrer",className:"hidden lg:flex flex-shrink-0 whitespace-nowrap items-center gap-1.5 px-2.5 py-1.5 rounded-md border border-white/10 bg-white/[0.03] hover:bg-white/[0.08] text-[12px] font-medium text-white/70 hover:text-white transition-all shadow-sm active:scale-95 group/spark",title:"Open Spark UI",children:[e.jsx(so,{className:"w-3.5 h-3.5 opacity-70 group-hover/spark:opacity-100 transition-opacity"}),e.jsx("span",{children:"Spark UI"})]}),e.jsx("div",{className:"hidden md:block w-[1px] h-5 bg-gradient-to-b from-transparent via-white/10 to-transparent mx-1 rounded-full flex-shrink-0"}),e.jsxs("button",{onClick:Ie,className:"flex-shrink-0 whitespace-nowrap px-3 py-1.5 rounded-md hover:bg-white/[0.08] transition-all text-white/70 hover:text-white text-[12px] font-medium flex items-center gap-1.5 active:scale-95",children:[e.jsx(gt,{className:"w-3.5 h-3.5 opacity-70"}),"Save"]})]})]}),e.jsxs("div",{className:"flex items-end overflow-x-auto shrink-0 bg-black/20 backdrop-blur-md h-[40px] w-full border-b border-white/[0.06] custom-scrollbar relative z-10 shadow-inner",children:[e.jsx("div",{className:"absolute inset-x-0 top-0 h-[10px] bg-gradient-to-b from-black/20 to-transparent pointer-events-none"}),C.map(t=>{const o=M?t===A:t===h,r=o&&M?h:t;return e.jsxs("div",{onClick:()=>{o||xe(t)},className:R("relative flex items-center justify-between cursor-pointer select-none group h-[40px] min-w-[140px] max-w-[220px] px-3 transition-colors",o?"bg-[#18181b]/90 text-white":"text-white/40 hover:text-white/90 hover:bg-white/[0.04] bg-transparent"),style:{borderRight:"1px solid rgba(255,255,255,0.05)",fontSize:"13px"},children:[o&&e.jsx("div",{className:"absolute top-0 left-0 right-0 h-[2px] bg-blue-500 shadow-[0_0_8px_rgba(59,130,246,0.5)] z-10 rounded-t-sm"}),e.jsxs("div",{className:"flex items-center gap-2.5 truncate",children:[e.jsx(Qe,{className:R("w-3.5 h-3.5 flex-shrink-0",o?"text-blue-400":"text-white/30 group-hover:text-white/50")}),o&&M?e.jsx("input",{autoFocus:!0,className:"text-[13px] font-medium text-white bg-transparent outline-none w-32 tracking-wide",value:h,onChange:n=>N(n.target.value),onBlur:()=>{lt()},onKeyDown:n=>{n.key==="Enter"&&lt()},onClick:n=>n.stopPropagation()}):e.jsx("span",{className:R("truncate tracking-wide",o?"font-semibold":"font-medium"),onClick:n=>{n.stopPropagation(),o?(I(h),j(!0)):xe(t)},title:o?"Click to rename":t,children:r})]}),e.jsx("div",{className:"flex items-center gap-1.5 ml-3 z-20",children:e.jsx(Ae,{onClick:n=>Rt(t,n),className:R("w-4 h-4 p-0.5 rounded-md transition-all flex-shrink-0 hover:bg-white/20 active:scale-95",o?"opacity-60 hover:opacity-100":"opacity-0 group-hover:opacity-60 hover:opacity-100")})})]},t)})]}),e.jsx("div",{className:"flex-1 relative flex flex-col min-h-0 bg-transparent overflow-hidden",children:e.jsxs("div",{className:"flex-1 overflow-y-auto py-4 px-6 flex flex-col gap-2 items-center w-full max-w-[1440px] mx-auto custom-scrollbar",children:[a.map((t,o)=>e.jsx("div",{className:"w-full",children:e.jsx(Fo,{cell:t,index:o,total:a.length,isActive:l===t.id,onActivate:()=>m(t.id),onUpdate:r=>{"source"in r&&typeof r.source=="string"?Dt(t.id,r.source):le(t.id,r)},onDelete:()=>Te(t.id),onMoveUp:()=>ct(t.id,"up"),onMoveDown:()=>ct(t.id,"down"),onRun:()=>ce(t.id),onAddBelow:r=>Ge(t.id,r),sqlSuggestionItems:U,loadSqlColumns:At,sqlKeywordItems:K,pythonKeywordItems:E,pythonSymbolItems:Mt})},t.id)),e.jsx("div",{className:"w-full flex justify-center py-6",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>{var t;return Ge((t=a[a.length-1])==null?void 0:t.id,"code")},className:"flex items-center gap-1 px-3 py-1.5 border border-white/10 bg-white/5 rounded text-[11px] text-white/60 hover:text-white hover:border-white/20 hover:bg-white/10 transition-colors shadow-sm",children:[e.jsx(je,{className:"w-3.5 h-3.5"})," Code"]}),e.jsxs("button",{onClick:()=>{var t;return Ge((t=a[a.length-1])==null?void 0:t.id,"markdown")},className:"flex items-center gap-1 px-3 py-1.5 border border-white/10 bg-white/5 rounded text-[11px] text-white/60 hover:text-white hover:border-white/20 hover:bg-white/10 transition-colors shadow-sm",children:[e.jsx(je,{className:"w-3.5 h-3.5"})," Markdown"]})]})})]})}),e.jsxs("div",{className:"h-8 bg-black/60 backdrop-blur-xl border-t border-white/5 flex items-center justify-between px-4 shrink-0 text-[10.5px] font-mono text-obsidian-muted/80 z-20",children:[e.jsxs("div",{className:"flex items-center gap-4 overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[w==="idle"&&e.jsx(bt,{className:"w-3 h-3 text-white/40"}),w==="busy"&&e.jsx(Fe,{className:"w-3 h-3 text-white/60 animate-spin"}),w==="starting"&&e.jsx(Fe,{className:"w-3 h-3 text-white/40 animate-spin"}),w==="disconnected"&&e.jsx(Ae,{className:"w-3 h-3 text-white/30"}),e.jsxs("span",{children:["Jupyter API: ",e.jsx("span",{className:"text-white/80 capitalize",children:w})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(Zt,{className:"w-3 h-3"}),e.jsxs("span",{children:["Engine: ",e.jsx("span",{className:"text-foreground/80 uppercase",children:Pe})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(xt,{className:"w-3 h-3"}),e.jsxs("span",{children:["Cluster: ",e.jsx("span",{className:"text-foreground/80",children:B||O||Ce})]})]}),ke&&e.jsxs("div",{className:"flex items-center gap-1.5 truncate",children:[e.jsx("span",{children:qe(ke)}),kt(ke)&&e.jsx("span",{className:"text-white/65",children:kt(ke)}),Nt(ke)==="Shuffle Low"&&e.jsx("span",{className:"px-1 py-0.5 rounded border border-amber-400/35 text-amber-300/90 whitespace-nowrap",children:"Shuffle Low"}),Nt(ke)==="Shuffle High"&&e.jsx("span",{className:"px-1 py-0.5 rounded border border-rose-400/35 text-rose-300/90 whitespace-nowrap",children:"Shuffle High"})]}),!ie&&e.jsx("div",{className:"flex items-center gap-1.5 truncate",children:e.jsx("span",{children:"Cluster API: legacy backend (attach/observability disabled)"})}),(_==null?void 0:_.workers)&&e.jsxs("div",{className:"flex items-center gap-1.5 truncate",children:[e.jsx(ro,{className:"w-3 h-3"}),e.jsxs("span",{children:["Workers ",_.workers.count," · Cores ",_.workers.cores_used,"/",_.workers.cores_total," · Mem ",Math.round((_.workers.memory_used_mb||0)/1024),"G/",Math.round((_.workers.memory_total_mb||0)/1024),"G"]})]}),((dt=_==null?void 0:_.logs)==null?void 0:dt[0])&&e.jsx("div",{className:"flex items-center gap-1.5 truncate",children:e.jsxs("span",{children:["Jobs ",_.logs[0].running_jobs," · Stages ",_.logs[0].active_stages]})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(St,{className:"w-3 h-3"}),e.jsxs("span",{children:[a.length," cells"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 font-mono",children:[e.jsx("span",{children:"Ln 1, Col 1"}),e.jsx("span",{children:"UTF-8"}),e.jsx("span",{children:(((ut=a.find(t=>t.id===l))==null?void 0:ut.language)||z)==="python"?"Python":"SQL"})]})]})]}),me&&e.jsx("div",{className:"absolute right-4 bottom-12 z-[120] max-w-md",children:e.jsxs("div",{className:R("flex items-start gap-2 rounded-lg border px-3 py-2 shadow-2xl backdrop-blur-md",me.tone==="success"&&"border-emerald-400/40 bg-emerald-500/15 text-emerald-300",me.tone==="error"&&"border-rose-400/40 bg-rose-500/15 text-rose-300",me.tone==="info"&&"border-cyan-400/40 bg-cyan-500/15 text-cyan-300"),children:[e.jsx("div",{className:"text-[11px] leading-5",children:me.message}),e.jsx("button",{onClick:()=>V(null),className:"ml-1 text-current/80 hover:text-current","aria-label":"Dismiss notification",children:e.jsx(Ae,{className:"w-3.5 h-3.5"})})]})}),_e&&e.jsx("div",{className:"fixed inset-0 z-[130] flex items-center justify-center bg-black/65 backdrop-blur-sm",onClick:()=>De(!1),children:e.jsxs("div",{className:"w-[440px] max-w-[92vw] rounded-xl border border-white/10 bg-[#151518] shadow-2xl",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"px-5 py-4 border-b border-white/10",children:[e.jsx("h3",{className:"text-sm font-semibold text-white",children:_e.title}),e.jsx("p",{className:"mt-1 text-xs text-white/65",children:_e.message})]}),e.jsxs("div",{className:"px-5 py-3 flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>De(!1),className:"px-3 py-1.5 text-xs rounded-md border border-white/10 text-white/70 hover:text-white hover:bg-white/5 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>De(!0),className:R("px-3 py-1.5 text-xs rounded-md transition-colors",_e.tone==="danger"?"border border-rose-400/30 bg-rose-500/20 text-rose-200 hover:bg-rose-500/30":"border border-cyan-400/30 bg-cyan-500/20 text-cyan-200 hover:bg-cyan-500/30"),children:_e.confirmLabel||"Confirm"})]})]})}),v&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm",onClick:()=>$(!1),children:e.jsxs("div",{className:"bg-[#1a1a1e] border border-white/10 rounded-xl shadow-2xl w-[520px] max-h-[70vh] overflow-auto",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-5 py-3 border-b border-white/10",children:[e.jsx("h2",{className:"text-white font-semibold text-sm tracking-wide",children:"Keyboard Shortcuts"}),e.jsx("button",{onClick:()=>$(!1),className:"p-1 hover:bg-white/10 rounded transition-colors text-white/40 hover:text-white",children:e.jsx(Ae,{className:"w-4 h-4"})})]}),e.jsx("div",{className:"p-5 space-y-3 text-[12px]",children:[{keys:"⇧ Enter",desc:"Run cell and move to next"},{keys:"⌘ Enter",desc:"Run cell in place"},{keys:"⌘ S",desc:"Save notebook"},{keys:"⌘ ⇧ Enter",desc:"Run all cells"},{keys:"⌘ ⇧ P",desc:"Open command palette (Editor)"},{keys:"Esc",desc:"Exit edit mode (focus cell)"},{keys:"%sql",desc:"Switch cell language to SQL (magic command)"},{keys:"%python",desc:"Switch cell language to Python (magic command)"},{keys:"%md",desc:"Switch cell to Markdown (magic command)"}].map((t,o)=>e.jsxs("div",{className:"flex items-center justify-between py-1.5 border-b border-white/5 last:border-0",children:[e.jsx("span",{className:"text-white/70",children:t.desc}),e.jsx("kbd",{className:"px-2 py-0.5 bg-white/5 border border-white/10 rounded text-white/60 font-mono text-[11px]",children:t.keys})]},o))})]})})]})}export{rn as default};
