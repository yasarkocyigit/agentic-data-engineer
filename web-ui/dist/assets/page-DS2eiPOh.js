import{r,j as e}from"./index-C5cHqxgX.js";import{c as Xe,b as p,i as Ht,M as bt,S as is,d as os,P as Et,l as ls,h as ht}from"./Sidebar-7IEyk4q2.js";import{L as P}from"./loader-circle-CL6qnjej.js";import{Z as ds,a as cs}from"./zoom-out-HKJS9ICW.js";import{R as Gt}from"./refresh-cw-CVsgWlps.js";import{L as xs}from"./layout-panel-left-CaJMDzcc.js";import{A as Ye}from"./activity-DDNRefPK.js";import{T as us}from"./tag-B4uC4tvz.js";import{S as ms}from"./sliders-horizontal-CWWvfyTL.js";import{C as lt}from"./circle-alert-Cciic13Q.js";import{C as It}from"./circle-stop-BB4_e9K0.js";import{R as dt,D as ps}from"./rotate-ccw-B38m3woz.js";import{Z as bs}from"./zap-DODbQdOe.js";import{M as Pt}from"./minimize-2-BnIlpfmH.js";import{C as Pe}from"./code-xml-e482lWR3.js";import{C as hs}from"./chevron-down-Bp9-ficd.js";import{C as ft}from"./circle-check-D8KcS8Zm.js";import{C as Je}from"./circle-x-BLUVzSH1.js";import{C as fs}from"./clock-B8p1T71b.js";/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],js=Xe("calendar",gs);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],Ft=Xe("pause",ys);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ws=[["path",{d:"M21 5H3",key:"1fi0y6"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M17 19H3",key:"z6ezky"}]],At=Xe("text-align-start",ws);/**
 * @license lucide-react v0.564.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vs=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Dt=Xe("user",vs),Ot={success:{bg:"rgba(73, 156, 84, 0.15)",text:"#499c54",label:"Success"},failed:{bg:"rgba(255, 82, 97, 0.15)",text:"#ff5261",label:"Failed"},running:{bg:"rgba(53, 116, 240, 0.15)",text:"#3574f0",label:"Running"},queued:{bg:"rgba(188, 190, 196, 0.15)",text:"#bcbec4",label:"Queued"},scheduled:{bg:"rgba(188, 190, 196, 0.10)",text:"#8c8e9e",label:"Scheduled"},skipped:{bg:"rgba(229, 192, 123, 0.15)",text:"#e5c07b",label:"Skipped"},up_for_retry:{bg:"rgba(229, 192, 123, 0.15)",text:"#e5c07b",label:"Retry"},upstream_failed:{bg:"rgba(255, 82, 97, 0.10)",text:"#ff7b86",label:"Upstream Failed"},removed:{bg:"rgba(108, 112, 126, 0.15)",text:"#6c707e",label:"Removed"},deferred:{bg:"rgba(198, 120, 221, 0.15)",text:"#c678dd",label:"Deferred"},no_status:{bg:"rgba(108, 112, 126, 0.10)",text:"#6c707e",label:"No Status"}};function Te(i){return Ot[i||"no_status"]||Ot.no_status}const q=200,le=64,Ns=80,Ut=28,Fe=40;function ks(i,o){var S;const d=new Map,b=new Map;for(const g of i)d.set(g.id,[]),b.set(g.id,0);for(const g of o)(S=d.get(g.source))==null||S.push(g.target),b.set(g.target,(b.get(g.target)||0)+1);const m=new Map;let _=i.filter(g=>(b.get(g.id)||0)===0).map(g=>g.id),j=0;for(;_.length>0;){const g=[];for(const z of _){m.set(z,j);for(const A of d.get(z)||[]){const F=(b.get(A)||1)-1;b.set(A,F),F===0&&g.push(A)}}_=g,j++}for(const g of i)m.has(g.id)||m.set(g.id,j);return m}function _s(i,o){const d=ks(i,o),b=Math.max(...d.values(),0),m=Array.from({length:b+1},()=>[]);for(const j of i)m[d.get(j.id)||0].push(j);const _=[];for(let j=0;j<=b;j++){const S=m[j],z=-(S.length*le+(S.length-1)*Ut)/2;S.forEach((A,F)=>{_.push({...A,x:Fe+j*(q+Ns),y:z+F*(le+Ut),layer:j})})}return _}function ct(i,o){const d=i.x+q,b=i.y+le/2,m=o.x,_=o.y+le/2,j=(d+m)/2;return`M ${d} ${b} C ${j} ${b}, ${j} ${_}, ${m} ${_}`}function Ss(i){return i.replace(/Operator$/,"").replace(/([A-Z])/g," $1").trim()}function xt(i){return typeof i=="string"?i:Array.isArray(i)?i.map(o=>typeof o=="string"?o:o&&typeof o=="object"&&"msg"in o?String(o.msg):JSON.stringify(o)).join("; "):i&&typeof i=="object"?JSON.stringify(i):""}async function Cs(i){const o=await i.text();let d={};if(o)try{d=JSON.parse(o)}catch{d={text:o}}if(!i.ok){const b=xt(d==null?void 0:d.detail)||xt(d==null?void 0:d.error)||`${i.status} ${i.statusText}`.trim();throw new Error(b)}if(d&&typeof d=="object"&&"error"in d&&d.error)throw new Error(xt(d.error)||"Request failed");return d}function $s({dagId:i,runId:o,className:d,onNodeClick:b}){const[m,_]=r.useState(null),[j,S]=r.useState(!0),[g,z]=r.useState(null),[A,F]=r.useState(null),[de,c]=r.useState(1),[X,ce]=r.useState({x:0,y:0}),[te,xe]=r.useState(!1),Y=r.useRef({x:0,y:0,panX:0,panY:0}),R=r.useRef(null),$=r.useCallback(async()=>{try{S(!0);const n=new URLSearchParams;o&&n.set("run_id",o);const y=await fetch(`/api/orchestrator/dags/${encodeURIComponent(i)}/structure?${n}`),k=await Cs(y);_(k),z(null)}catch(n){const y=n instanceof Error?n.message:"Failed to load graph";z(y)}finally{S(!1)}},[i,o]);r.useEffect(()=>{$();const n=setInterval($,15e3);return()=>clearInterval(n)},[$]);const M=r.useMemo(()=>m?_s(m.nodes,m.edges):[],[m]),ve=r.useMemo(()=>{const n=new Map;for(const y of M)n.set(y.id,y);return n},[M]),L=r.useMemo(()=>{if(M.length===0)return{minX:0,minY:0,w:800,h:400};let n=1/0,y=1/0,k=-1/0,u=-1/0;for(const w of M)w.x<n&&(n=w.x),w.y<y&&(y=w.y),w.x+q>k&&(k=w.x+q),w.y+le>u&&(u=w.y+le);return{minX:n-Fe,minY:y-Fe,w:k-n+Fe*2,h:u-y+Fe*2}},[M]),Ae=r.useCallback(n=>{n.preventDefault();const y=n.deltaY>0?-.1:.1;c(k=>Math.max(.3,Math.min(3,k+y)))},[]),De=r.useCallback(n=>{n.button===0&&(xe(!0),Y.current={x:n.clientX,y:n.clientY,panX:X.x,panY:X.y})},[X]),B=r.useCallback(n=>{if(!te)return;const y=n.clientX-Y.current.x,k=n.clientY-Y.current.y;ce({x:Y.current.panX+y,y:Y.current.panY+k})},[te]),C=r.useCallback(()=>{xe(!1)},[]),ue=r.useCallback(()=>{c(1),ce({x:0,y:0})},[]);if(j&&!m)return e.jsx("div",{className:p("flex items-center justify-center h-full",d),children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(P,{className:"w-6 h-6 text-obsidian-info animate-spin"}),e.jsx("span",{className:"text-[11px] text-obsidian-muted",children:"Loading graph..."})]})});if(g)return e.jsx("div",{className:p("flex items-center justify-center h-full",d),children:e.jsxs("div",{className:"flex flex-col items-center gap-2 text-center",children:[e.jsx("span",{className:"text-[12px] text-obsidian-danger",children:g}),e.jsx("button",{onClick:$,className:"px-3 py-1 bg-obsidian-info/20 text-obsidian-info rounded text-[11px] hover:bg-obsidian-info/30",children:"Retry"})]})});if(!m||M.length===0)return e.jsx("div",{className:p("flex items-center justify-center h-full text-obsidian-muted text-[11px]",d),children:"No tasks found"});const V=M.filter(n=>n.state==="success").length,ne=M.filter(n=>n.state==="failed").length,re=M.filter(n=>n.state==="running").length;return e.jsxs("div",{className:p("flex flex-col h-full bg-obsidian-bg relative",d),children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-1.5 bg-obsidian-panel border-b border-obsidian-border shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ht,{className:"w-3.5 h-3.5 text-obsidian-info"}),e.jsx("span",{className:"text-[10px] text-obsidian-muted uppercase font-semibold tracking-wider",children:"Lineage Graph"}),e.jsxs("span",{className:"text-[10px] text-obsidian-muted/80 ml-1",children:[M.length," tasks · ",m.edges.length," edges"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[o&&e.jsxs("div",{className:"flex items-center gap-1.5 mr-2 text-[10px]",children:[V>0&&e.jsxs("span",{className:"text-obsidian-success",children:["✓ ",V]}),ne>0&&e.jsxs("span",{className:"text-obsidian-danger",children:["✗ ",ne]}),re>0&&e.jsxs("span",{className:"text-obsidian-info",children:["● ",re]})]}),e.jsx("button",{onClick:()=>c(n=>Math.min(3,n+.2)),className:"p-1 hover:bg-obsidian-panel-hover rounded text-obsidian-muted hover:text-foreground",title:"Zoom in",children:e.jsx(ds,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>c(n=>Math.max(.3,n-.2)),className:"p-1 hover:bg-obsidian-panel-hover rounded text-obsidian-muted hover:text-foreground",title:"Zoom out",children:e.jsx(cs,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:ue,className:"p-1 hover:bg-obsidian-panel-hover rounded text-obsidian-muted hover:text-foreground",title:"Fit to screen",children:e.jsx(bt,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:$,className:"p-1 hover:bg-obsidian-panel-hover rounded text-obsidian-muted hover:text-foreground ml-1",title:"Refresh",children:e.jsx(Gt,{className:p("w-3.5 h-3.5",j&&"animate-spin")})})]})]}),e.jsx("div",{ref:R,className:"flex-1 overflow-hidden cursor-grab active:cursor-grabbing",onWheel:Ae,onMouseDown:De,onMouseMove:B,onMouseUp:C,onMouseLeave:C,children:e.jsxs("svg",{width:"100%",height:"100%",viewBox:`${L.minX} ${L.minY} ${L.w} ${L.h}`,preserveAspectRatio:"xMidYMid meet",style:{transform:`scale(${de}) translate(${X.x/de}px, ${X.y/de}px)`,transformOrigin:"center",transition:te?"none":"transform 0.15s ease-out"},children:[e.jsxs("defs",{children:[e.jsx("marker",{id:"arrow",viewBox:"0 0 10 10",refX:"10",refY:"5",markerWidth:"8",markerHeight:"8",orient:"auto-start-reverse",children:e.jsx("path",{d:"M 0 0 L 10 5 L 0 10 Z",fill:"var(--color-obsidian-muted)"})}),e.jsx("marker",{id:"arrow-active",viewBox:"0 0 10 10",refX:"10",refY:"5",markerWidth:"8",markerHeight:"8",orient:"auto-start-reverse",children:e.jsx("path",{d:"M 0 0 L 10 5 L 0 10 Z",fill:"var(--color-obsidian-info)"})}),e.jsxs("filter",{id:"glow",x:"-20%",y:"-20%",width:"140%",height:"140%",children:[e.jsx("feGaussianBlur",{stdDeviation:"4",result:"blur"}),e.jsxs("feMerge",{children:[e.jsx("feMergeNode",{in:"blur"}),e.jsx("feMergeNode",{in:"SourceGraphic"})]})]})]}),m.edges.map((n,y)=>{const k=ve.get(n.source),u=ve.get(n.target);if(!k||!u)return null;const w=A===n.source||A===n.target,D=k.state,O=D?Te(D).text:"var(--color-obsidian-muted)";return e.jsxs("g",{children:[e.jsx("path",{d:ct(k,u),fill:"none",stroke:w?O:"var(--color-obsidian-border)",strokeWidth:w?2.5:1.5,strokeOpacity:w?.4:.2,strokeDasharray:""}),e.jsx("path",{d:ct(k,u),fill:"none",stroke:w?O:"var(--color-obsidian-muted)",strokeWidth:w?2:1.2,markerEnd:w?"url(#arrow-active)":"url(#arrow)",style:{transition:"stroke 0.2s, stroke-width 0.2s"}}),D==="running"&&e.jsx("circle",{r:"3",fill:"var(--color-obsidian-info)",children:e.jsx("animateMotion",{dur:"2s",repeatCount:"indefinite",path:ct(k,u)})})]},`edge-${y}`)}),M.map(n=>{const y=A===n.id,k=Te(n.state),u=!!n.state,w=u?k.text:"var(--color-obsidian-border)",D=u?k.bg:"var(--color-obsidian-panel)",O=n.state==="running"?"url(#glow)":void 0;return e.jsxs("g",{onMouseEnter:()=>F(n.id),onMouseLeave:()=>F(null),onClick:Oe=>{Oe.stopPropagation(),b==null||b(n.id)},style:{cursor:"pointer"},children:[e.jsx("rect",{x:n.x,y:n.y,width:q,height:le,rx:8,ry:8,fill:!u&&!y?"var(--color-obsidian-panel)":D,stroke:w,strokeWidth:y?1.5:1,filter:O,style:{transition:"fill 0.2s, stroke 0.2s, stroke-width 0.2s"}}),u&&e.jsx("circle",{cx:n.x+14,cy:n.y+le/2,r:4,fill:k.text,children:n.state==="running"&&e.jsx("animate",{attributeName:"opacity",values:"1;0.3;1",dur:"1.5s",repeatCount:"indefinite"})}),e.jsx("text",{x:n.x+(u?26:14),y:n.y+24,fill:y?"var(--color-foreground)":"var(--color-obsidian-muted)",fontSize:"12",fontWeight:"600",fontFamily:"ui-monospace, monospace",style:{transition:"fill 0.2s"},children:n.label}),e.jsx("text",{x:n.x+(u?26:14),y:n.y+42,fill:"var(--color-obsidian-muted)",fillOpacity:"0.7",fontSize:"10",fontFamily:"system-ui, sans-serif",children:Ss(n.operator)}),n.duration!=null&&n.duration>0&&e.jsx("text",{x:n.x+q-10,y:n.y+42,fill:"var(--color-obsidian-muted)",fontSize:"9",fontFamily:"ui-monospace, monospace",textAnchor:"end",children:n.duration<60?`${n.duration.toFixed(1)}s`:`${(n.duration/60).toFixed(1)}m`}),n.triggerRule!=="all_success"&&e.jsxs("g",{children:[e.jsx("rect",{x:n.x+q-64,y:n.y+6,width:54,height:16,rx:4,fill:"rgba(229, 192, 123, 0.1)",stroke:"rgba(229, 192, 123, 0.2)",strokeWidth:.5}),e.jsx("text",{x:n.x+q-37,y:n.y+17,fill:"var(--color-obsidian-warning)",fontSize:"8",fontFamily:"system-ui, sans-serif",textAnchor:"middle",children:n.triggerRule.replace(/_/g," ")})]})]},n.id)}),A&&(()=>{const n=ve.get(A);if(!n)return null;const y=Te(n.state);return e.jsxs("g",{children:[e.jsx("rect",{x:n.x+q+8,y:n.y-8,width:170,height:n.state?70:52,rx:6,fill:"var(--color-obsidian-panel)",stroke:"var(--color-obsidian-border)",strokeWidth:1,filter:"drop-shadow(0 4px 6px rgba(0,0,0,0.3))"}),e.jsx("text",{x:n.x+q+18,y:n.y+8,fill:"var(--color-foreground)",fontSize:"11",fontWeight:"600",children:n.label}),e.jsx("text",{x:n.x+q+18,y:n.y+24,fill:"var(--color-obsidian-muted)",fontSize:"9",children:n.operator}),e.jsxs("text",{x:n.x+q+18,y:n.y+38,fill:"var(--color-obsidian-muted)",fontSize:"9",children:["Rule: ",n.triggerRule]}),n.state&&e.jsxs("text",{x:n.x+q+18,y:n.y+52,fill:y.text,fontSize:"9",fontWeight:"600",children:[y.label,n.duration!=null?` · ${n.duration.toFixed(1)}s`:""]})]})})()]})}),e.jsxs("div",{className:"absolute bottom-2 right-2 text-[9px] text-obsidian-muted bg-obsidian-panel/90 px-2 py-0.5 rounded border border-obsidian-border",children:[Math.round(de*100),"%"]})]})}function ut(i){if(!i)return"—";const o=Date.now(),d=new Date(i).getTime(),b=o-d;if(b<0)return"soon";const m=Math.floor(b/1e3);if(m<60)return`${m}s ago`;const _=Math.floor(m/60);if(_<60)return`${_}m ago`;const j=Math.floor(_/60);return j<24?`${j}h ago`:`${Math.floor(j/24)}d ago`}function $e(i){if(i==null)return"—";if(i<60)return`${i.toFixed(1)}s`;const o=Math.floor(i/60),d=Math.floor(i%60);return o<60?`${o}m ${d}s`:`${Math.floor(o/60)}h ${o%60}m`}function Ts(i){return typeof i=="string"?i:Array.isArray(i)?i.map(o=>{if(typeof o=="string")return o;if(o&&typeof o=="object"){const d=o;return typeof d.event=="string"?d.event:typeof d.message=="string"?d.message:JSON.stringify(d)}return String(o)}).join(""):i&&typeof i=="object"?JSON.stringify(i,null,2):String(i??"")}function mt(i){return typeof i=="string"?i:Array.isArray(i)?i.map(o=>typeof o=="string"?o:o&&typeof o=="object"&&"msg"in o?String(o.msg):JSON.stringify(o)).join("; "):i&&typeof i=="object"?JSON.stringify(i):""}function Rs(i,o){const d=new Blob([o],{type:"text/plain;charset=utf-8"}),b=URL.createObjectURL(d),m=document.createElement("a");m.href=b,m.download=i,document.body.appendChild(m),m.click(),m.remove(),URL.revokeObjectURL(b)}async function ee(i){const o=await i.text();let d={};if(o)try{d=JSON.parse(o)}catch{d={text:o}}if(!i.ok){const b=mt(d==null?void 0:d.detail)||mt(d==null?void 0:d.error)||`${i.status} ${i.statusText}`.trim();throw new Error(b)}if(d&&typeof d=="object"&&"error"in d&&d.error)throw new Error(mt(d.error)||"Request failed");return d}function qt(){const i=[localStorage.getItem("openclaw-airflow-token"),localStorage.getItem("openclaw-airflow-jwt"),sessionStorage.getItem("openclaw-airflow-token"),sessionStorage.getItem("openclaw-airflow-jwt")];for(const o of i)if(o&&o.trim())return o.trim();return null}function I(i,o){return`${i}:${o}`}function We({state:i,size:o="sm"}){const d=Te(i),b=i==="success"?ft:i==="failed"?Je:i==="running"?P:i==="queued"?fs:i==="skipped"?ht:Ye;return e.jsxs("span",{className:p("inline-flex items-center gap-1.5 rounded-full font-medium tracking-wide shadow-sm border border-white/5",o==="sm"?"px-2 py-0.5 text-[10px]":"px-3 py-1 text-[11px]"),style:{backgroundColor:d.bg,color:d.text},children:[e.jsx(b,{className:p("flex-shrink-0 opacity-80",o==="sm"?"w-2.5 h-2.5":"w-3 h-3",i==="running"&&"animate-spin")}),d.label]})}function pt({label:i,status:o}){const d=o==="healthy"?"bg-obsidian-success":o==="unhealthy"?"bg-obsidian-danger":"bg-obsidian-warning";return e.jsxs("div",{className:"flex items-center gap-1.5 group relative",children:[e.jsx("div",{className:p("w-1.5 h-1.5 rounded-full",d,o==="healthy"&&"shadow-[0_0_4px_rgba(73,156,84,0.6)]")}),e.jsx("span",{className:"text-[10px] text-obsidian-muted group-hover:text-foreground transition-colors",children:i})]})}function zt(i){let o=i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),d=-1,b=null;for(let S=0;S<o.length;S++){const g=o[S];if(!b&&(g==='"'||g==="'"))b=g;else if(b&&g===b)b=null;else if(!b&&g==="#"){d=S;break}}let m=o,_="";d>=0&&(m=o.substring(0,d),_='<span style="color:#6c707e;font-style:italic">'+o.substring(d)+"</span>"),m=m.replace(/((&amp;quot;){3}.*?(&amp;quot;){3}|(&quot;){3}.*?(&quot;){3}|&quot;&quot;&quot;.*?&quot;&quot;&quot;|&#39;&#39;&#39;.*?&#39;&#39;&#39;)/g,'<span style="color:#98c379">$1</span>'),m=m.replace(/(f?&quot;[^&]*?&quot;|f?&#39;[^&]*?&#39;|f?"[^"]*"|f?'[^']*')/g,'<span style="color:#98c379">$1</span>');const j="\\b(from|import|def|class|return|if|elif|else|for|while|with|as|try|except|finally|raise|yield|lambda|not|and|or|in|is|True|False|None|pass|break|continue|global|nonlocal|assert|del|async|await)\\b";return m=m.replace(new RegExp(j,"g"),'<span style="color:#c678dd">$1</span>'),m=m.replace(/(@\w+)/g,'<span style="color:#e5c07b">$1</span>'),m=m.replace(/\b(\d+\.?\d*)\b/g,'<span style="color:#d19a66">$1</span>'),m+_}function Bs(){const[o,d]=r.useState([]),[b,m]=r.useState(!0),[_,j]=r.useState(null),[S,g]=r.useState(null),[z,A]=r.useState(""),[F,de]=r.useState(null),[c,X]=r.useState(null),[ce,te]=r.useState([]),[xe,Y]=r.useState(0),[R,$]=r.useState(0),[M,ve]=r.useState(!1),[L,Ae]=r.useState(null),[De,B]=r.useState(null),[C,ue]=r.useState("runs"),[V,ne]=r.useState("list"),[re,n]=r.useState(null),[y,k]=r.useState(!1),[u,w]=r.useState(null),[D,O]=r.useState([]),[Oe,gt]=r.useState(!1),[Ue,se]=r.useState(null),[Zt,jt]=r.useState(!1),[qe,ie]=r.useState(null),[U,Be]=r.useState(!1),[me,yt]=r.useState(!1),[wt,Wt]=r.useState(!1),[Ne,pe]=r.useState(null),[H,vt]=r.useState(null),[G,J]=r.useState(null),[Yt,ze]=r.useState(!1),[oe,be]=r.useState(null),[Nt,He]=r.useState({}),[Ve,Re]=r.useState({}),[Qe,Jt]=r.useState(!0),Ke=r.useRef(null),[he,et]=r.useState("all"),[fe,tt]=r.useState("all"),[ge,st]=r.useState(""),[je,at]=r.useState(""),[ye,nt]=r.useState(""),[kt,Xt]=r.useState(!1),[rt,_t]=r.useState(!1),[Bt,Me]=r.useState(!1),[it,Vt]=r.useState(`{
  
}`),[St,ot]=r.useState(null),[Ct,Qt]=r.useState("running"),[Le,Ge]=r.useState({include_upstream:!1,include_downstream:!1,include_future:!1,include_past:!1}),[Ee,$t]=r.useState(""),T=r.useCallback((t,a={})=>{const l=new Headers(a.headers||{}),s=Ee.trim()||qt();if(s){const x=s.toLowerCase().startsWith("bearer ")?s:`Bearer ${s}`;l.set("X-Airflow-Authorization",x)}return fetch(t,{...a,headers:l})},[Ee]),ke=r.useCallback(async()=>{m(!0);try{const t=await T("/api/orchestrator/dags"),a=await ee(t);d(a.dags||[]),j(null)}catch(t){const a=t instanceof Error?t.message:"Failed to connect";j(a)}finally{m(!1)}},[T]),Ze=r.useCallback(async()=>{try{const t=await T("/api/orchestrator/health"),a=await ee(t);g(a)}catch{}},[T]),_e=r.useCallback(async(t,a={})=>{const l=a.offset??0;a.silent||ve(!0);try{const s=new URLSearchParams({limit:String(20),offset:String(l),order_by:"-start_date"});he!=="all"&&s.set("state",he),fe!=="all"&&s.set("run_type",fe),ge.trim()&&s.set("triggered_by",ge.trim()),je&&s.set("start_date_gte",new Date(`${je}T00:00:00`).toISOString()),ye&&s.set("start_date_lte",new Date(`${ye}T23:59:59`).toISOString());const x=await T(`/api/orchestrator/dags/${encodeURIComponent(t)}/runs?${s.toString()}`),h=await ee(x),v=h.runs||[];te(v),Y(h.total||v.length)}catch(s){if(te([]),Y(0),!a.silent){const x=s instanceof Error?s.message:"Failed to load runs";B(`Runs: ${x}`)}}finally{a.silent||ve(!1)}},[20,T,he,fe,je,ye,ge]),Ie=r.useCallback(async(t,a,l={})=>{l.silent||gt(!0);try{const s=await T(`/api/orchestrator/dags/${encodeURIComponent(t)}/runs/${encodeURIComponent(a)}/tasks`),x=await ee(s);O(x.task_instances||[])}catch(s){if(O([]),!l.silent){const x=s instanceof Error?s.message:"Failed to load task instances";B(`Tasks: ${x}`)}}finally{l.silent||gt(!1)}},[T]),Tt=r.useCallback(async(t,a,l,s)=>{const x=new URLSearchParams;s>=0&&x.set("map_index",String(s));const h=x.toString()?`?${x.toString()}`:"",v=await T(`/api/orchestrator/dags/${encodeURIComponent(t)}/runs/${encodeURIComponent(a)}/tasks/${encodeURIComponent(l)}/tries${h}`),E=((await ee(v)).task_instances||[]).map(W=>W.try_number).filter(W=>typeof W=="number"&&W>0),Z=[...new Set(E)].sort((W,rs)=>rs-W),Ce=I(l,s);return He(W=>({...W,[Ce]:Z})),Z},[T]),Se=r.useCallback(async(t,a,l,s,x)=>{const h=new URLSearchParams({full_content:"true"});x>=0&&h.set("map_index",String(x));const v=await T(`/api/orchestrator/dags/${encodeURIComponent(t)}/runs/${encodeURIComponent(a)}/tasks/${encodeURIComponent(l)}/logs/${s}?${h.toString()}`),f=await ee(v),E=f.content??f.text??"";return Ts(E)},[T]);r.useEffect(()=>{const t=new URLSearchParams(window.location.search),a=t.get("dag"),l=t.get("run"),s=t.get("tab"),x=t.get("view"),h=t.get("offset"),v=t.get("state"),f=t.get("type"),E=t.get("by"),Z=t.get("from"),Ce=t.get("to"),W=Number.parseInt(h||"0",10);a&&X(a),l&&w(l),(s==="runs"||s==="code"||s==="graph")&&ue(s),(x==="list"||x==="calendar"||x==="gantt"||x==="task")&&ne(x),Number.isFinite(W)&&W>=0&&$(W),v&&et(v),f&&tt(f),E&&st(E),Z&&at(Z),Ce&&nt(Ce),Wt(!0)},[]),r.useEffect(()=>{const t=qt();t&&$t(t)},[]),r.useEffect(()=>{if(!wt)return;const t=new URLSearchParams;c&&t.set("dag",c),u&&t.set("run",u),C!=="runs"&&t.set("tab",C),V!=="list"&&t.set("view",V),R>0&&t.set("offset",String(R)),he!=="all"&&t.set("state",he),fe!=="all"&&t.set("type",fe),ge.trim()&&t.set("by",ge.trim()),je&&t.set("from",je),ye&&t.set("to",ye);const a=t.toString(),l=a?`${window.location.pathname}?${a}`:window.location.pathname;window.history.replaceState({},"",l)},[wt,c,u,C,V,R,he,fe,ge,je,ye]),r.useEffect(()=>{ke(),Ze();const t=setInterval(ke,3e4),a=setInterval(Ze,3e4);return()=>{clearInterval(t),clearInterval(a)}},[ke,Ze]),r.useEffect(()=>{if(!c){te([]),Y(0),O([]);return}_e(c,{offset:R})},[c,R,_e]),r.useEffect(()=>{if(!c||!u){O([]);return}Ie(c,u)},[c,u,Ie]),r.useEffect(()=>{u||(pe(null),_t(!1))},[u]),r.useEffect(()=>{if(!c||C!=="runs")return;const t=setInterval(()=>{_e(c,{offset:R,silent:!0})},1e4);return()=>clearInterval(t)},[c,C,R,_e]),r.useEffect(()=>{if(!c||!u||C!=="runs")return;const t=setInterval(()=>{Ie(c,u,{silent:!0})},8e3);return()=>clearInterval(t)},[c,u,C,Ie]);const Rt=r.useCallback(async t=>{k(!0);try{const a=await T("/api/orchestrator/dags",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dag_id:t,action:"source"})}),l=await ee(a);n(l)}catch(a){const l=a instanceof Error?a.message:"Failed to load source code";B(`Source: ${l}`),n({content:"# Failed to load source code",version:0})}finally{k(!1)}},[T]);r.useEffect(()=>{C==="code"&&c&&!re&&Rt(c)},[C,c,re,Rt]);const we=async(t,a,l,s)=>{Ae(`${t}-${a}`),B(null);try{const x=await T("/api/orchestrator/dags",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dag_id:t,action:a,run_id:l,conf:s})});await ee(x),await ke(),c===t&&_e(t,{offset:R})}catch(x){const h=x instanceof Error?x.message:"Action failed";B(h),setTimeout(()=>B(null),5e3)}finally{Ae(null)}},ae=async(t,a,l,s,x={})=>{vt(`${l}-${s}`);try{const h=await T(`/api/orchestrator/dags/${encodeURIComponent(t)}/runs/${encodeURIComponent(a)}/tasks/${encodeURIComponent(l)}/action`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:s,map_index:x.map_index??-1,new_state:x.new_state,note:x.note,include_upstream:x.include_upstream??!1,include_downstream:x.include_downstream??!1,include_future:x.include_future??!1,include_past:x.include_past??!1})});await ee(h),Ie(t,a),_e(t,{offset:R})}catch(h){const v=h instanceof Error?h.message:"Task action failed";B(`Task ${l}: ${v}`)}finally{vt(null)}},Mt=t=>{u===t?(w(null),O([]),pe(null),ie(null),se(null),be(null),J(null)):(w(t),pe(null),ne(a=>a==="task"?"list":a),He({}),Re({}),ie(null),se(null),be(null),J(null))},Kt=r.useCallback(async t=>{if(!c||!u)return;const a=I(t.task_id,t.map_index);if(oe===a){be(null),J(null);return}be(a),ze(!0);try{let l=[];try{l=await Tt(c,u,t.task_id,t.map_index)}catch{l=[]}const s=Ve[a]||l[0]||t.try_number||1;Re(h=>({...h,[a]:s}));const x=await Se(c,u,t.task_id,s,t.map_index);J({task_id:t.task_id,map_index:t.map_index,try_number:s,content:x})}catch(l){const s=l instanceof Error?l.message:String(l);J({task_id:t.task_id,map_index:t.map_index,try_number:t.try_number||1,content:`Failed to load logs: ${s}`})}finally{ze(!1)}},[u,Se,Tt,c,Ve,oe]),es=r.useCallback(async(t,a)=>{if(!c||!u)return;const l=I(t.task_id,t.map_index);ze(!0),Re(s=>({...s,[l]:a}));try{const s=await Se(c,u,t.task_id,a,t.map_index);J({task_id:t.task_id,map_index:t.map_index,try_number:a,content:s})}catch(s){const x=s instanceof Error?s.message:String(s);J({task_id:t.task_id,map_index:t.map_index,try_number:a,content:`Failed to load logs: ${x}`})}finally{ze(!1)}},[u,Se,c]);r.useEffect(()=>{if(!Qe||!G||!Ke.current)return;const t=Ke.current;t.scrollTop=t.scrollHeight},[G,Qe]),r.useEffect(()=>{if(!c||!u||!oe||!G)return;const t=setInterval(async()=>{try{const[a,l]=oe.split(":"),s=Number.parseInt(l??"-1",10),x=await Se(c,u,a,G.try_number,s);J(h=>h&&{...h,content:x})}catch{}},5e3);return()=>clearInterval(t)},[c,u,oe,G,Se]);const ts=async()=>{if(c){ot(null);try{const t=it.trim()?JSON.parse(it):{};await we(c,"trigger",void 0,t),Me(!1)}catch(t){const a=t instanceof Error?t.message:"Invalid JSON";ot(a)}}},ss=[...new Set(o.flatMap(t=>t.tags))],Lt=o.filter(t=>!(z&&!t.dag_id.toLowerCase().includes(z.toLowerCase())||F&&!t.tags.includes(F))),Q=c?o.find(t=>t.dag_id===c):null,K=rt?D.filter(t=>t.map_index>=0):D,N=Ne&&K.find(t=>I(t.task_id,t.map_index)===Ne)||null;r.useEffect(()=>{if(!u)return;if(!K.length){pe(null);return}if(!Ne){const a=K[0];pe(I(a.task_id,a.map_index));return}if(!K.some(a=>I(a.task_id,a.map_index)===Ne)){const a=K[0];pe(I(a.task_id,a.map_index))}},[u,K,Ne]);const as=r.useMemo(()=>{const t=new Map;for(const a of ce){const l=a.start_date||a.logical_date||a.queued_at||a.run_after;if(!l)continue;const s=new Date(l).toISOString().slice(0,10),x=t.get(s)||[];x.push(a),t.set(s,x)}return Array.from(t.entries()).sort((a,l)=>a[0]<l[0]?1:-1).map(([a,l])=>({day:a,items:l}))},[ce]),ns=r.useMemo(()=>{if(!D.length)return[];const t=D.map(l=>l.start_date?new Date(l.start_date).getTime():null).filter(l=>l!==null),a=t.length?Math.min(...t):null;return D.map(l=>{const s=l.start_date?new Date(l.start_date).getTime():null,x=l.end_date?new Date(l.end_date).getTime():null;if(a===null||s===null||x===null||x<s)return{key:`${l.task_id}:${l.map_index}`,label:l.task_id,offsetPct:0,widthPct:0,state:l.state,duration:l.duration};const h=Math.max(1,Math.max(...D.map(v=>v.end_date?new Date(v.end_date).getTime():null).filter(v=>v!==null))-a);return{key:`${l.task_id}:${l.map_index}`,label:l.task_id,offsetPct:(s-a)/h*100,widthPct:Math.max(2,(x-s)/h*100),state:l.state,duration:l.duration}})},[D]);return e.jsxs("div",{className:"flex h-screen bg-[#09090b] text-foreground font-sans overflow-hidden relative",style:{fontFamily:"'Inter', -apple-system, sans-serif"},children:[e.jsx("div",{className:"absolute top-0 left-0 w-[800px] h-[800px] bg-purple-500/5 rounded-full blur-[120px] pointer-events-none -translate-x-1/4 -translate-y-1/4 z-0"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-[600px] h-[600px] bg-sky-500/5 rounded-full blur-[100px] pointer-events-none translate-x-1/4 -translate-y-1/4 z-0"}),e.jsx("div",{className:"relative z-10 shrink-0",children:e.jsx(is,{})}),e.jsxs("main",{className:"flex-1 flex flex-col min-w-0 bg-transparent relative z-10",children:[e.jsxs("header",{className:"flex items-center px-4 justify-between shrink-0 h-10 bg-black/40 backdrop-blur-md border-b border-white/5 z-10 w-full relative",children:[e.jsx("div",{className:"absolute top-0 left-0 right-0 h-[1px] bg-gradient-to-r from-obsidian-info/30 to-obsidian-purple/30"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>window.dispatchEvent(new CustomEvent("openclaw:toggle-sidebar")),className:"p-1.5 hover:bg-white/10 rounded-md text-obsidian-muted hover:text-white transition-all active:scale-95 border border-transparent hover:border-obsidian-border/50",title:"Toggle Explorer",children:e.jsx(xs,{className:"w-4 h-4 drop-shadow-[0_0_8px_rgba(255,255,255,0.2)]"})}),e.jsx("div",{className:"w-[1px] h-4 bg-obsidian-border/50 mx-1"}),e.jsx(Ye,{className:"w-4 h-4 text-obsidian-info"}),e.jsx("span",{className:"text-[12px] font-bold text-foreground tracking-wide",children:"Orchestration"})]}),e.jsx("div",{className:"flex items-center gap-3 ml-4 pl-4 border-l border-obsidian-border",children:S?e.jsxs(e.Fragment,{children:[e.jsx(pt,{label:"Scheduler",status:S.scheduler.status}),e.jsx(pt,{label:"DB",status:S.database.status}),e.jsx(pt,{label:"Processor",status:S.dag_processor.status})]}):e.jsx("span",{className:"text-[10px] text-obsidian-muted animate-pulse",children:"Connecting..."})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-[10px] text-obsidian-muted",children:[o.length," pipelines"]}),e.jsx("button",{onClick:()=>{ke(),Ze()},className:"p-1.5 hover:bg-obsidian-panel-hover rounded text-foreground transition-colors",children:e.jsx(Gt,{className:p("w-3.5 h-3.5",b&&"animate-spin")})})]})]}),e.jsxs("div",{className:"h-10 bg-black/20 backdrop-blur-md border-b border-white/5 flex items-center px-4 gap-4 shrink-0 z-10",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-white/[0.03] border border-white/10 rounded-md px-2.5 py-1.5 flex-1 max-w-sm transition-all focus-within:border-obsidian-info/50 focus-within:bg-white/[0.05]",children:[e.jsx(os,{className:"w-4 h-4 text-obsidian-muted"}),e.jsx("input",{type:"text",placeholder:"Search pipelines...",value:z,onChange:t=>A(t.target.value),className:"bg-transparent text-[12px] text-foreground placeholder-[#6c707e] outline-none w-full"})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(us,{className:"w-3.5 h-3.5 text-obsidian-muted"}),e.jsx("button",{onClick:()=>de(null),className:p("px-2 py-0.5 rounded text-[10px] transition-colors",F?"text-obsidian-muted hover:text-foreground":"bg-obsidian-info/20 text-obsidian-info"),children:"All"}),ss.map(t=>e.jsx("button",{onClick:()=>de(F===t?null:t),className:p("px-2 py-0.5 rounded text-[10px] transition-colors",F===t?"bg-obsidian-info/20 text-obsidian-info":"text-obsidian-muted hover:text-foreground"),children:t},t))]}),e.jsxs("button",{onClick:()=>Xt(t=>!t),className:p("inline-flex items-center gap-1.5 px-2 py-1 rounded border text-[10px] transition-colors",kt?"border-obsidian-info/40 text-obsidian-info bg-obsidian-info/10":"border-white/10 text-obsidian-muted hover:text-foreground hover:bg-white/[0.04]"),children:[e.jsx(ms,{className:"w-3.5 h-3.5"}),"Filters"]}),e.jsxs("div",{className:"flex items-center gap-1.5 ml-auto",children:[e.jsx("input",{type:"password",placeholder:"Airflow token (optional)",value:Ee,onChange:t=>$t(t.target.value),className:"h-7 w-56 bg-black/40 border border-white/10 rounded px-2 text-[10px] text-foreground placeholder:text-obsidian-muted outline-none focus:border-obsidian-info/60"}),e.jsx("button",{onClick:()=>{Ee.trim()?localStorage.setItem("openclaw-airflow-token",Ee.trim()):localStorage.removeItem("openclaw-airflow-token")},className:"px-2 py-1 rounded border border-white/10 text-[10px] text-obsidian-muted hover:text-foreground hover:bg-white/[0.04]",children:"Save Token"})]})]}),kt&&e.jsxs("div",{className:"px-4 py-2 border-b border-white/5 bg-black/30 grid grid-cols-5 gap-2 text-[10px]",children:[e.jsxs("select",{value:he,onChange:t=>{$(0),et(t.target.value)},className:"h-8 bg-black/40 border border-white/10 rounded px-2 text-foreground",children:[e.jsx("option",{value:"all",children:"State: all"}),e.jsx("option",{value:"queued",children:"queued"}),e.jsx("option",{value:"running",children:"running"}),e.jsx("option",{value:"success",children:"success"}),e.jsx("option",{value:"failed",children:"failed"})]}),e.jsxs("select",{value:fe,onChange:t=>{$(0),tt(t.target.value)},className:"h-8 bg-black/40 border border-white/10 rounded px-2 text-foreground",children:[e.jsx("option",{value:"all",children:"Type: all"}),e.jsx("option",{value:"manual",children:"manual"}),e.jsx("option",{value:"scheduled",children:"scheduled"}),e.jsx("option",{value:"backfill",children:"backfill"}),e.jsx("option",{value:"asset_triggered",children:"asset_triggered"})]}),e.jsx("input",{type:"text",placeholder:"Triggered by...",value:ge,onChange:t=>{$(0),st(t.target.value)},className:"h-8 bg-black/40 border border-white/10 rounded px-2 text-foreground placeholder:text-obsidian-muted"}),e.jsx("input",{type:"date",value:je,onChange:t=>{$(0),at(t.target.value)},className:"h-8 bg-black/40 border border-white/10 rounded px-2 text-foreground"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"date",value:ye,onChange:t=>{$(0),nt(t.target.value)},className:"h-8 flex-1 bg-black/40 border border-white/10 rounded px-2 text-foreground"}),e.jsx("button",{onClick:()=>{et("all"),tt("all"),st(""),at(""),nt(""),$(0)},className:"h-8 px-2 rounded border border-white/10 text-obsidian-muted hover:text-foreground hover:bg-white/[0.04]",children:"Reset"})]})]}),De&&e.jsxs("div",{className:"mx-4 mt-1 px-3 py-2 bg-obsidian-danger/10 border border-obsidian-danger/30 rounded text-[11px] text-obsidian-danger-light flex items-center gap-2 shrink-0 transition-all active:scale-95",children:[e.jsx(lt,{className:"w-3.5 h-3.5 text-obsidian-danger shrink-0"}),e.jsx("span",{className:"flex-1 truncate",children:De}),e.jsx("button",{onClick:()=>B(null),className:"text-obsidian-danger hover:text-white text-[10px] font-bold",children:"✕"})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsx("div",{className:p("flex-1 overflow-auto",c?"border-r border-white/5":""),children:c&&C==="graph"?e.jsx($s,{dagId:c,runId:u,className:"h-full",onNodeClick:t=>{console.log("Node clicked:",t)}}):_?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-obsidian-danger gap-3",children:[e.jsx(lt,{className:"w-10 h-10 opacity-60"}),e.jsx("span",{className:"text-[13px] font-medium",children:"Connection Error"}),e.jsx("span",{className:"text-[11px] text-obsidian-muted max-w-sm text-center",children:_}),e.jsx("button",{onClick:ke,className:"mt-2 px-3 py-1.5 bg-obsidian-info/20 text-obsidian-info rounded-md text-[11px] font-medium hover:bg-obsidian-info/30 transition-colors border border-obsidian-info/30 active:scale-95",children:"Retry Connection"})]}):e.jsxs("table",{className:"w-full text-left border-collapse",children:[e.jsx("thead",{className:"sticky top-0 bg-black/40 backdrop-blur-md z-10 shadow-[0_1px_0_rgba(255,255,255,0.05)]",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 px-4 text-[10px] text-obsidian-muted font-semibold tracking-wider w-8"}),e.jsx("th",{className:"p-2 px-4 text-[10px] text-obsidian-muted font-semibold tracking-wider text-left",children:"Pipeline"}),e.jsx("th",{className:"p-2 px-4 text-[10px] text-obsidian-muted font-semibold tracking-wider text-left w-28",children:"Schedule"}),e.jsx("th",{className:"p-2 px-4 text-[10px] text-obsidian-muted font-semibold tracking-wider text-left w-28",children:"Last Run"}),e.jsx("th",{className:"p-2 px-4 text-[10px] text-obsidian-muted font-semibold tracking-wider text-left w-24",children:"State"}),e.jsx("th",{className:"p-2 px-4 text-[10px] text-obsidian-muted font-semibold tracking-wider text-left w-24",children:"Duration"}),e.jsx("th",{className:"p-2 px-4 text-[10px] text-obsidian-muted font-semibold tracking-wider text-center w-48",children:"Actions"})]})}),e.jsxs("tbody",{className:"text-[12px]",children:[Lt.map(t=>{var s,x,h;const a=c===t.dag_id,l=((s=t.last_run)==null?void 0:s.state)==="running"||((x=t.last_run)==null?void 0:x.state)==="queued";return e.jsxs("tr",{onClick:()=>{if(a){X(null),w(null),te([]),Y(0),O([]),ie(null),se(null),be(null),J(null),$(0);return}X(t.dag_id),w(null),O([]),He({}),Re({}),ie(null),se(null),be(null),J(null),$(0),ue("graph"),n(null)},className:p("border-b border-white/5 group cursor-pointer transition-colors",a?"bg-white/[0.04]":"hover:bg-white/[0.02]"),children:[e.jsx("td",{className:"p-1.5 px-3 text-center",children:e.jsx("div",{className:p("w-2 h-2 rounded-full mx-auto transition-all",t.is_paused?"bg-obsidian-muted/50":"bg-obsidian-success shadow-[0_0_6px_rgba(73,156,84,0.5)]")})}),e.jsxs("td",{className:"p-1.5 px-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-foreground font-semibold",children:t.display_name}),t.has_import_errors&&e.jsx("span",{title:"Import errors",children:e.jsx(lt,{className:"w-3.5 h-3.5 text-obsidian-danger"})})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsxs("span",{className:"text-[10px] text-obsidian-muted",children:[e.jsx(Dt,{className:"w-2.5 h-2.5 inline mr-0.5 -mt-0.5"}),t.owners.join(", ")]}),t.tags.slice(0,3).map(v=>e.jsx("span",{className:"text-[8px] px-1.5 py-0.5 rounded bg-obsidian-panel-hover text-obsidian-muted transition-all active:scale-95",children:v},v))]})]}),e.jsx("td",{className:"p-1.5 px-3 text-obsidian-muted font-mono text-[11px]",children:t.schedule||"Manual"}),e.jsx("td",{className:"p-1.5 px-3 text-obsidian-muted text-[11px]",children:t.last_run?ut(t.last_run.end_date||t.last_run.start_date):"—"}),e.jsx("td",{className:"p-1.5 px-3",children:t.last_run?e.jsx(We,{state:t.last_run.state}):t.is_paused?e.jsx("span",{className:"text-[9px] text-obsidian-muted uppercase font-semibold",children:"Paused"}):e.jsx("span",{className:"text-[9px] text-obsidian-muted uppercase font-semibold",children:"Ready"})}),e.jsx("td",{className:"p-1.5 px-3 text-obsidian-muted font-mono text-[11px]",children:$e((h=t.last_run)==null?void 0:h.duration_seconds)}),e.jsx("td",{className:"p-1.5 px-3",onClick:v=>v.stopPropagation(),children:e.jsxs("div",{className:"flex items-center gap-1.5 justify-center",children:[e.jsxs("button",{onClick:()=>we(t.dag_id,"trigger"),disabled:!!L,className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-md text-[10px] font-medium
                                         bg-transparent text-obsidian-success hover:bg-obsidian-success/10
                                         border border-obsidian-success/30 hover:border-obsidian-success/50 transition-all disabled:opacity-30 active:scale-95`,children:[L===`${t.dag_id}-trigger`?e.jsx(P,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(Et,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Run"})]}),l&&t.last_run&&e.jsxs("button",{onClick:()=>we(t.dag_id,"cancel",t.last_run.run_id),disabled:!!L,className:`flex items-center gap-1.5 px-2.5 py-1.5 rounded-md text-[10px] font-medium
                                           bg-transparent text-obsidian-danger hover:bg-obsidian-danger/10
                                           border border-obsidian-danger/30 hover:border-obsidian-danger/50 transition-all disabled:opacity-30 active:scale-95`,children:[L===`${t.dag_id}-cancel`?e.jsx(P,{className:"w-3.5 h-3.5 animate-spin"}):e.jsx(It,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"Cancel"})]}),e.jsxs("button",{onClick:()=>we(t.dag_id,t.is_paused?"unpause":"pause"),disabled:!!L,className:p("flex items-center gap-1.5 px-2.5 py-1.5 rounded-md text-[10px] font-medium border bg-transparent transition-all disabled:opacity-30",t.is_paused?"text-obsidian-info hover:bg-obsidian-info/10 border-obsidian-info/30 hover:border-obsidian-info/50":"text-obsidian-warning hover:bg-obsidian-warning/10 border-obsidian-warning/30 hover:border-obsidian-warning/50"),children:[L===`${t.dag_id}-pause`||L===`${t.dag_id}-unpause`?e.jsx(P,{className:"w-3.5 h-3.5 animate-spin"}):t.is_paused?e.jsx(dt,{className:"w-3.5 h-3.5"}):e.jsx(Ft,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:t.is_paused?"Enable":"Pause"})]})]})})]},t.dag_id)}),!b&&Lt.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"p-12 text-center text-obsidian-muted",children:z||F?"No pipelines match your filter":"No pipelines found"})})]})]})}),c&&e.jsxs("div",{className:p("flex flex-col bg-[#09090b]/80 backdrop-blur-2xl border-l border-white/5 shrink-0 transition-all duration-200 z-20",me?"fixed inset-0 w-full":"w-[400px]"),children:[e.jsxs("div",{className:p("bg-black/40 border-b border-white/5 flex items-center justify-between shrink-0",me?"h-12 px-6":"h-10 px-4"),children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(bs,{className:p("text-obsidian-info shrink-0",me?"w-4 h-4":"w-3.5 h-3.5")}),e.jsx("span",{className:p("font-bold text-foreground truncate",me?"text-sm":"text-[11px]"),children:c})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>yt(!me),className:"p-1 hover:bg-obsidian-panel-hover rounded text-obsidian-muted hover:text-foreground transition-colors",title:me?"Minimize":"Maximize",children:me?e.jsx(Pt,{className:"w-3.5 h-3.5"}):e.jsx(bt,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>{X(null),w(null),te([]),Y(0),O([]),He({}),Re({}),ie(null),se(null),be(null),J(null),$(0),yt(!1)},className:"p-1 hover:bg-obsidian-panel-hover rounded text-obsidian-muted hover:text-foreground text-[12px]",children:"✕"})]})]}),Q&&e.jsxs("div",{className:"px-4 py-3 border-b border-white/5 text-[11px] space-y-2",children:[Q.description&&e.jsx("p",{className:"text-obsidian-muted leading-relaxed",children:Q.description}),e.jsxs("div",{className:"flex items-center gap-4 text-[10px] text-obsidian-muted",children:[e.jsxs("span",{children:[e.jsx(js,{className:"w-3.5 h-3.5 inline mr-1 -mt-0.5"}),Q.schedule||"Manual"]}),e.jsxs("span",{children:[e.jsx(Dt,{className:"w-3.5 h-3.5 inline mr-1 -mt-0.5"}),Q.owners.join(", ")]})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-1",children:[e.jsxs("span",{className:p("text-[9px] px-2 py-0.5 rounded font-semibold uppercase",Q.is_paused?"bg-obsidian-warning/10 text-obsidian-warning":"bg-obsidian-success/10 text-obsidian-success"),children:["Schedule: ",Q.is_paused?"Paused":"Active"]}),e.jsx("button",{onClick:()=>we(c,Q.is_paused?"unpause":"pause"),disabled:!!L,className:p("flex items-center gap-1 px-2 py-1 rounded text-[10px] font-medium border transition-colors disabled:opacity-50",Q.is_paused?"bg-obsidian-info/10 text-obsidian-info hover:bg-obsidian-info/25 border-obsidian-info/20":"bg-obsidian-warning/10 text-obsidian-warning hover:bg-obsidian-warning/25 border-obsidian-warning/20"),children:Q.is_paused?e.jsxs(e.Fragment,{children:[e.jsx(dt,{className:"w-3.5 h-3.5"})," Enable Schedule"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ft,{className:"w-3.5 h-3.5"})," Pause Schedule"]})})]})]}),e.jsxs("div",{className:"flex border-b border-white/5 shrink-0",children:[e.jsxs("button",{onClick:()=>ue("graph"),className:p("flex-1 flex items-center justify-center gap-1.5 py-2.5 text-[10px] font-medium transition-all",C==="graph"?"text-foreground border-b-2 border-obsidian-info bg-white/[0.04]":"text-obsidian-muted hover:text-foreground hover:bg-white/[0.02]"),children:[e.jsx(Ht,{className:"w-3.5 h-3.5"})," Graph"]}),e.jsxs("button",{onClick:()=>ue("runs"),className:p("flex-1 flex items-center justify-center gap-1.5 py-2.5 text-[10px] font-medium transition-all",C==="runs"?"text-foreground border-b-2 border-obsidian-info bg-white/[0.04]":"text-obsidian-muted hover:text-foreground hover:bg-white/[0.02]"),children:[e.jsx(ls,{className:"w-3.5 h-3.5"})," Runs"]}),e.jsxs("button",{onClick:()=>ue("code"),className:p("flex-1 flex items-center justify-center gap-1.5 py-2.5 text-[10px] font-medium transition-all",C==="code"?"text-foreground border-b-2 border-obsidian-info bg-white/[0.04]":"text-obsidian-muted hover:text-foreground hover:bg-white/[0.02]"),children:[e.jsx(Pe,{className:"w-3.5 h-3.5"})," Code"]})]}),C==="runs"&&e.jsxs("div",{className:"px-4 py-2 border-b border-white/5 flex flex-col gap-2 shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] text-obsidian-muted uppercase font-semibold tracking-wider",children:"Recent Runs"}),e.jsx("span",{className:"text-[9px] text-obsidian-muted/80",children:xe>0?`${R+1}-${Math.min(R+20,xe)} / ${xe}`:"0 / 0"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>$(t=>Math.max(0,t-20)),disabled:R===0||M,className:"px-1.5 py-0.5 rounded border border-white/10 text-[9px] text-obsidian-muted hover:text-foreground hover:bg-white/[0.04] disabled:opacity-30",children:"Prev"}),e.jsx("button",{onClick:()=>$(t=>t+20),disabled:R+20>=xe||M,className:"px-1.5 py-0.5 rounded border border-white/10 text-[9px] text-obsidian-muted hover:text-foreground hover:bg-white/[0.04] disabled:opacity-30",children:"Next"})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("button",{onClick:()=>we(c,"trigger"),disabled:!!L,className:`flex items-center gap-1 px-2 py-1 bg-obsidian-success/15 text-obsidian-success rounded text-[10px]
                                font-medium hover:bg-obsidian-success/25 border border-obsidian-success/20 transition-colors disabled:opacity-50 active:scale-95`,children:[e.jsx(Et,{className:"w-3.5 h-3.5"})," Quick Run"]}),e.jsxs("button",{onClick:()=>{ot(null),Me(!0)},className:"flex items-center gap-1 px-2 py-1 rounded text-[10px] border border-obsidian-info/30 text-obsidian-info hover:bg-obsidian-info/15 transition-colors",children:[e.jsx(Pe,{className:"w-3.5 h-3.5"})," Run + Conf"]})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[["list","calendar","gantt","task"].map(t=>e.jsx("button",{onClick:()=>ne(t),className:p("px-2 py-0.5 rounded border text-[9px] uppercase tracking-wide",V===t?"border-obsidian-info/40 text-obsidian-info bg-obsidian-info/10":"border-white/10 text-obsidian-muted hover:text-foreground hover:bg-white/[0.04]"),children:t},t)),u&&e.jsxs("span",{className:"ml-auto text-[9px] text-obsidian-muted font-mono",children:["Run: ",u]})]})]}),C==="runs"&&e.jsx("div",{className:"flex-1 overflow-auto",children:M?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(P,{className:"w-5 h-5 text-obsidian-info animate-spin"})}):ce.length===0?e.jsx("div",{className:"text-center py-8 text-obsidian-muted text-[11px]",children:"No runs yet"}):V==="calendar"?e.jsx("div",{className:"p-3 space-y-3",children:as.map(t=>e.jsxs("div",{className:"border border-white/10 rounded-md overflow-hidden",children:[e.jsx("div",{className:"px-3 py-1.5 bg-white/[0.03] text-[10px] text-obsidian-muted font-mono",children:new Date(t.day).toLocaleDateString()}),e.jsx("div",{className:"divide-y divide-white/5",children:t.items.map(a=>e.jsxs("button",{onClick:()=>{ne("list"),Mt(a.run_id)},className:"w-full text-left px-3 py-2 hover:bg-white/[0.03] transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(We,{state:a.state}),e.jsx("span",{className:"text-[10px] text-foreground font-mono",children:a.run_id})]}),e.jsx("span",{className:"text-[9px] text-obsidian-muted",children:ut(a.end_date||a.start_date||a.logical_date||null)})]}),e.jsxs("div",{className:"mt-1 text-[9px] text-obsidian-muted font-mono",children:[a.run_type," • ",a.triggered_by||"system"]})]},a.run_id))})]},t.day))}):V==="gantt"?e.jsx("div",{className:"p-3 space-y-3",children:u?Oe?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(P,{className:"w-5 h-5 text-obsidian-info animate-spin"})}):K.length===0?e.jsx("div",{className:"text-center py-8 text-obsidian-muted text-[11px]",children:"No task instances for selected run."}):e.jsx("div",{className:"space-y-2",children:ns.filter(t=>!rt||t.key.split(":")[1]!=="-1").map(t=>e.jsxs("div",{className:"grid grid-cols-[160px_1fr_56px] items-center gap-2",children:[e.jsx("span",{className:"text-[10px] text-foreground font-mono truncate",children:t.label}),e.jsx("div",{className:"relative h-4 bg-white/[0.05] rounded overflow-hidden",children:e.jsx("div",{className:"absolute top-0 h-full rounded",style:{left:`${t.offsetPct}%`,width:`${t.widthPct}%`,backgroundColor:Te(t.state).text,opacity:.8}})}),e.jsx("span",{className:"text-[9px] text-obsidian-muted font-mono",children:$e(t.duration)})]},t.key))}):e.jsx("div",{className:"text-center py-8 text-obsidian-muted text-[11px]",children:"Select a run in List/Calendar view to render task timeline."})}):V==="task"?e.jsx("div",{className:"p-3 space-y-3",children:u?N?e.jsxs("div",{className:"border border-white/10 rounded-md p-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-[12px] font-semibold text-foreground font-mono",children:N.task_id}),N.map_index>=0&&e.jsxs("span",{className:"text-[9px] px-1.5 py-0.5 rounded bg-obsidian-info/15 text-obsidian-info font-mono",children:["map[",N.map_index,"]"]}),e.jsx(We,{state:N.state})]}),e.jsx("span",{className:"text-[10px] text-obsidian-muted font-mono",children:$e(N.duration)})]}),e.jsxs("div",{className:"text-[10px] text-obsidian-muted grid grid-cols-2 gap-2 font-mono",children:[e.jsxs("span",{children:["Operator: ",N.operator]}),e.jsxs("span",{children:["Try: ",N.try_number,"/",N.max_tries]}),e.jsxs("span",{children:["Queue: ",N.queue]}),e.jsxs("span",{children:["Host: ",N.hostname||"—"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 rounded border border-white/10 bg-black/20 p-2 text-[10px] text-obsidian-muted",children:[e.jsxs("label",{className:"flex items-center gap-1.5",children:[e.jsx("input",{type:"checkbox",checked:Le.include_upstream,onChange:t=>Ge(a=>({...a,include_upstream:t.target.checked}))}),"clear upstream"]}),e.jsxs("label",{className:"flex items-center gap-1.5",children:[e.jsx("input",{type:"checkbox",checked:Le.include_downstream,onChange:t=>Ge(a=>({...a,include_downstream:t.target.checked}))}),"clear downstream"]}),e.jsxs("label",{className:"flex items-center gap-1.5",children:[e.jsx("input",{type:"checkbox",checked:Le.include_past,onChange:t=>Ge(a=>({...a,include_past:t.target.checked}))}),"include past"]}),e.jsxs("label",{className:"flex items-center gap-1.5",children:[e.jsx("input",{type:"checkbox",checked:Le.include_future,onChange:t=>Ge(a=>({...a,include_future:t.target.checked}))}),"include future"]})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-1",children:[e.jsx("button",{onClick:()=>ae(c,u,N.task_id,"clear",{map_index:N.map_index,...Le}),disabled:!!H,className:"px-2 py-1 rounded text-[10px] border border-obsidian-warning/30 text-obsidian-warning hover:bg-obsidian-warning/15 disabled:opacity-40",children:"Clear"}),e.jsx("button",{onClick:()=>ae(c,u,N.task_id,"mark_success",{map_index:N.map_index}),disabled:!!H,className:"px-2 py-1 rounded text-[10px] border border-obsidian-success/30 text-obsidian-success hover:bg-obsidian-success/15 disabled:opacity-40",children:"Mark Success"}),e.jsx("button",{onClick:()=>ae(c,u,N.task_id,"mark_failed",{map_index:N.map_index}),disabled:!!H,className:"px-2 py-1 rounded text-[10px] border border-obsidian-danger/30 text-obsidian-danger hover:bg-obsidian-danger/15 disabled:opacity-40",children:"Mark Failed"}),e.jsx("button",{onClick:()=>ae(c,u,N.task_id,"mark_running",{map_index:N.map_index}),disabled:!!H,className:"px-2 py-1 rounded text-[10px] border border-obsidian-info/30 text-obsidian-info hover:bg-obsidian-info/15 disabled:opacity-40",children:"Mark Running"}),e.jsx("button",{onClick:()=>ae(c,u,N.task_id,"mark_queued",{map_index:N.map_index}),disabled:!!H,className:"px-2 py-1 rounded text-[10px] border border-white/20 text-obsidian-muted hover:text-foreground hover:bg-white/[0.08] disabled:opacity-40",children:"Mark Queued"})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-1",children:[e.jsxs("select",{value:Ct,onChange:t=>Qt(t.target.value),className:"h-8 bg-black/40 border border-white/10 rounded px-2 text-[10px] text-foreground",children:[e.jsx("option",{value:"queued",children:"queued"}),e.jsx("option",{value:"running",children:"running"}),e.jsx("option",{value:"success",children:"success"}),e.jsx("option",{value:"failed",children:"failed"}),e.jsx("option",{value:"skipped",children:"skipped"}),e.jsx("option",{value:"upstream_failed",children:"upstream_failed"}),e.jsx("option",{value:"removed",children:"removed"})]}),e.jsx("button",{onClick:()=>ae(c,u,N.task_id,"set_state",{map_index:N.map_index,new_state:Ct}),disabled:!!H,className:"px-2 py-1 rounded text-[10px] border border-obsidian-info/30 text-obsidian-info hover:bg-obsidian-info/15 disabled:opacity-40",children:"Set State"})]})]}):e.jsx("div",{className:"text-center py-8 text-obsidian-muted text-[11px]",children:"Choose a task from List view."}):e.jsx("div",{className:"text-center py-8 text-obsidian-muted text-[11px]",children:"Select a run and a task to open task detail view."})}):e.jsx("div",{children:ce.map(t=>{const a=u===t.run_id,l=t.state==="running"||t.state==="queued";return e.jsxs("div",{className:"border-b border-white/5",children:[e.jsxs("div",{onClick:()=>Mt(t.run_id),className:p("px-4 py-2.5 cursor-pointer transition-colors",a?"bg-white/[0.04]":"hover:bg-white/[0.02]"),children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[a?e.jsx(hs,{className:"w-3.5 h-3.5 text-obsidian-muted"}):e.jsx(ht,{className:"w-3.5 h-3.5 text-obsidian-muted"}),e.jsx(We,{state:t.state}),l&&e.jsxs("button",{onClick:s=>{s.stopPropagation(),we(c,"cancel",t.run_id)},disabled:!!L,className:`flex items-center gap-1 ml-1 px-1.5 py-0.5 rounded text-[8px] font-semibold
                                               bg-obsidian-danger/10 text-obsidian-danger hover:bg-obsidian-danger/25
                                               border border-obsidian-danger/20 transition-colors disabled:opacity-30 active:scale-95`,children:[e.jsx(It,{className:"w-2.5 h-2.5"}),"Cancel"]})]}),e.jsx("span",{className:"text-[10px] text-obsidian-muted",children:ut(t.end_date||t.start_date)})]}),e.jsxs("div",{className:"flex items-center justify-between text-[10px] text-obsidian-muted mt-1 pl-[18px]",children:[e.jsxs("span",{className:"font-mono truncate max-w-[200px]",children:[t.run_type," • ",t.triggered_by]}),e.jsx("span",{className:"font-mono",children:$e(t.duration_seconds)})]})]}),a&&e.jsx("div",{className:"bg-black/20 backdrop-blur-md border-t border-white/5",children:Oe?e.jsx("div",{className:"flex items-center justify-center py-4",children:e.jsx(P,{className:"w-4 h-4 text-obsidian-info animate-spin"})}):K.length===0?e.jsx("div",{className:"text-center py-4 text-obsidian-muted text-[10px]",children:"No task details available"}):e.jsxs("div",{className:"py-1",children:[e.jsxs("div",{className:"px-4 py-1.5 text-[9px] text-obsidian-muted uppercase font-semibold tracking-wider flex items-center gap-2",children:[e.jsx(Ye,{className:"w-2.5 h-2.5"}),e.jsx("span",{children:"Task Details"}),e.jsxs("span",{className:"text-[8px] normal-case tracking-normal font-mono text-obsidian-muted/90",children:[K.length," items"]}),e.jsx("button",{onClick:()=>_t(s=>!s),className:p("ml-auto px-1.5 py-0.5 rounded border text-[8px] normal-case tracking-normal",rt?"border-obsidian-info/30 text-obsidian-info bg-obsidian-info/10":"border-white/10 text-obsidian-muted hover:text-foreground hover:bg-white/[0.04]"),children:"mapped only"})]}),K.map(s=>{var v;const x=Te(s.state),h=s.state==="failed";return e.jsxs("div",{onClick:()=>{pe(I(s.task_id,s.map_index)),ne("task")},className:p("px-4 py-2 flex items-start gap-2 text-[11px] cursor-pointer transition-colors",h&&"bg-obsidian-danger/5",Ne===I(s.task_id,s.map_index)&&"bg-obsidian-info/10 ring-1 ring-obsidian-info/20"),children:[e.jsx("div",{className:"mt-0.5",children:s.state==="success"?e.jsx(ft,{className:"w-3.5 h-3.5",style:{color:x.text}}):s.state==="failed"?e.jsx(Je,{className:"w-3.5 h-3.5",style:{color:x.text}}):s.state==="running"?e.jsx(P,{className:"w-3.5 h-3.5 animate-spin",style:{color:x.text}}):s.state==="skipped"?e.jsx(ht,{className:"w-3.5 h-3.5",style:{color:x.text}}):e.jsx(Ye,{className:"w-3.5 h-3.5",style:{color:x.text}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-1.5 min-w-0",children:[e.jsx("span",{className:p("font-mono font-medium truncate",h?"text-obsidian-danger":"text-foreground"),children:s.task_display_name}),s.map_index>=0&&e.jsxs("span",{className:"text-[8px] px-1.5 py-0.5 rounded bg-obsidian-info/15 text-obsidian-info font-mono shrink-0",children:["map[",s.map_index,"]"]})]}),e.jsx("span",{className:"text-[10px] text-obsidian-muted font-mono ml-2 shrink-0",children:$e(s.duration)})]}),e.jsxs("div",{className:"text-[9px] text-obsidian-muted mt-0.5 flex items-center gap-2 flex-wrap",children:[e.jsxs("span",{children:[s.operator,s.try_number>1&&e.jsxs("span",{className:"ml-1 text-obsidian-warning",children:["(try ",s.try_number,"/",s.max_tries,")"]})]}),e.jsxs("button",{onClick:f=>{f.stopPropagation(),ae(c,u,s.task_id,"clear",{map_index:s.map_index})},disabled:!!H,className:"flex items-center gap-0.5 px-1.5 py-0.5 rounded text-[8px] font-semibold border transition-colors bg-obsidian-warning/10 text-obsidian-warning border-obsidian-warning/20 hover:bg-obsidian-warning/25 disabled:opacity-30 active:scale-95",title:"Clear Task (Retry)",children:[H===`${s.task_id}-clear`?e.jsx(P,{className:"w-2.5 h-2.5 animate-spin"}):e.jsx(dt,{className:"w-2.5 h-2.5"}),"Clear"]}),e.jsxs("button",{onClick:f=>{f.stopPropagation(),ae(c,u,s.task_id,"mark_success",{map_index:s.map_index})},disabled:!!H,className:"flex items-center gap-0.5 px-1.5 py-0.5 rounded text-[8px] font-semibold border transition-colors bg-obsidian-success/10 text-obsidian-success border-obsidian-success/20 hover:bg-obsidian-success/25 disabled:opacity-30 active:scale-95",title:"Mark Success",children:[H===`${s.task_id}-mark_success`?e.jsx(P,{className:"w-2.5 h-2.5 animate-spin"}):e.jsx(ft,{className:"w-2.5 h-2.5"}),"Success"]}),e.jsxs("button",{onClick:f=>{f.stopPropagation(),ae(c,u,s.task_id,"mark_failed",{map_index:s.map_index})},disabled:!!H,className:"flex items-center gap-0.5 px-1.5 py-0.5 rounded text-[8px] font-semibold border transition-colors bg-obsidian-danger/10 text-obsidian-danger border-obsidian-danger/20 hover:bg-obsidian-danger/25 disabled:opacity-30 active:scale-95",title:"Mark Failed",children:[H===`${s.task_id}-mark_failed`?e.jsx(P,{className:"w-2.5 h-2.5 animate-spin"}):e.jsx(Je,{className:"w-2.5 h-2.5"}),"Failed"]}),e.jsxs("button",{onClick:f=>{f.stopPropagation(),Kt(s)},className:p("flex items-center gap-0.5 px-1.5 py-0.5 rounded text-[8px] font-semibold border transition-colors active:scale-95",oe===I(s.task_id,s.map_index)?"bg-obsidian-info/20 text-obsidian-info border-obsidian-info/30":"bg-obsidian-panel/30 text-obsidian-muted hover:text-foreground hover:bg-obsidian-panel/50 border-obsidian-border/50"),children:[e.jsx(At,{className:"w-2.5 h-2.5"}),oe===I(s.task_id,s.map_index)?"Hide Logs":"Logs"]}),e.jsxs("button",{onClick:async f=>{if(f.stopPropagation(),qe===s.task_id){ie(null),se(null);return}ie(s.task_id),jt(!0);try{const E=await T("/api/orchestrator/notebooks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dag_id:c,task_id:s.task_id})}),Z=await ee(E),Ce=typeof Z.content=="string"?Z.content:JSON.stringify(Z.content??"",null,2);se({...Z,task_id:s.task_id,content:Ce})}catch(E){const Z=E instanceof Error?E.message:String(E);se({task_id:s.task_id,filename:"Error",content:`# Failed to load source: ${Z}`})}finally{jt(!1)}},className:p("flex items-center gap-0.5 px-1.5 py-0.5 rounded text-[8px] font-semibold border transition-colors active:scale-95",qe===s.task_id?"bg-obsidian-info/20 text-obsidian-info border-obsidian-info/30":"bg-obsidian-panel/30 text-obsidian-muted hover:text-foreground hover:bg-obsidian-panel/50 border-obsidian-border/50"),children:[e.jsx(Pe,{className:"w-2.5 h-2.5"}),qe===s.task_id?"Hide Code":"Code"]})]}),qe===s.task_id&&e.jsxs("div",{className:p(U?"fixed inset-0 z-50 flex flex-col bg-[#1a1b1e]":"mt-2 rounded border border-obsidian-border overflow-hidden"),children:[U&&e.jsx("div",{className:"fixed inset-0 bg-black/60 -z-10",onClick:()=>Be(!1)}),Zt?e.jsxs("div",{className:"flex items-center justify-center py-4 text-obsidian-muted text-[10px]",children:[e.jsx(P,{className:"w-3.5 h-3.5 animate-spin mr-1.5"})," Loading..."]}):Ue?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:p("bg-obsidian-panel border-b border-obsidian-border flex items-center justify-between shrink-0",U?"px-5 py-3":"px-2 py-1"),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:p(U?"w-4 h-4":"w-3 h-3","text-obsidian-info")}),e.jsx("span",{className:p("text-foreground font-mono font-medium",U?"text-sm":"text-[9px]"),children:Ue.filename}),e.jsxs("span",{className:p("text-obsidian-muted",U?"text-xs":"text-[8px]"),children:[Ue.content.split(`
`).length," lines"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:f=>{f.stopPropagation(),Be(!U)},className:"p-1 rounded hover:bg-obsidian-panel/60 text-obsidian-muted hover:text-foreground transition-colors",title:U?"Minimize":"Maximize",children:U?e.jsx(Pt,{className:"w-3.5 h-3.5"}):e.jsx(bt,{className:"w-3.5 h-3.5"})}),U&&e.jsx("button",{onClick:f=>{f.stopPropagation(),Be(!1),ie(null),se(null)},className:"p-1 rounded hover:bg-obsidian-danger/20 text-obsidian-muted hover:text-obsidian-danger transition-colors",title:"Close",children:e.jsx(Je,{className:"w-3.5 h-3.5"})})]})]}),e.jsx("div",{className:p("overflow-auto bg-[#1a1b1e]",U?"flex-1":"max-h-[300px]"),children:Ue.content.split(`
`).map((f,E)=>e.jsxs("div",{className:p("flex font-mono hover:bg-obsidian-panel/40",U?"text-[13px] leading-[22px]":"text-[10px] leading-[16px]"),children:[e.jsx("span",{className:p("text-right text-obsidian-muted/40 select-none shrink-0",U?"w-14 pr-4 pl-4":"w-8 pr-2"),children:E+1}),e.jsx("span",{className:"flex-1 whitespace-pre",dangerouslySetInnerHTML:{__html:zt(f)}})]},E))})]}):null]}),oe===I(s.task_id,s.map_index)&&e.jsx("div",{className:"mt-2 rounded border border-obsidian-border overflow-hidden bg-[#111113]",children:Yt?e.jsxs("div",{className:"flex items-center justify-center py-4 text-obsidian-muted text-[10px]",children:[e.jsx(P,{className:"w-3.5 h-3.5 animate-spin mr-1.5"})," Fetching logs..."]}):G?e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"bg-obsidian-panel border-b border-obsidian-border flex items-center justify-between px-2 py-1 shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(At,{className:"w-3 h-3 text-obsidian-info"}),e.jsxs("span",{className:"text-foreground font-mono font-medium text-[9px]",children:["Log Output (Try ",G.try_number,")"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"flex items-center gap-1 text-[8px] text-obsidian-muted uppercase tracking-wider",children:[e.jsx("input",{type:"checkbox",checked:Qe,onChange:f=>Jt(f.target.checked),className:"w-3 h-3 accent-cyan-500"}),"follow"]}),e.jsx("span",{className:"text-[8px] text-obsidian-muted uppercase tracking-wider",children:"Try"}),e.jsx("select",{className:"bg-[#0f1013] border border-white/10 rounded px-1.5 py-0.5 text-[9px] text-foreground",value:Ve[I(s.task_id,s.map_index)]||G.try_number,onChange:f=>void es(s,Number(f.target.value)),children:((v=Nt[I(s.task_id,s.map_index)])!=null&&v.length?Nt[I(s.task_id,s.map_index)]:[G.try_number]).map(f=>e.jsx("option",{value:f,children:f},`${s.task_id}-try-${f}`))}),e.jsxs("button",{onClick:()=>Rs(`${c}-${u}-${s.task_id}-${s.map_index}-try${G.try_number}.log`,G.content),className:"inline-flex items-center gap-1 px-1.5 py-0.5 rounded border border-white/10 text-[8px] text-obsidian-muted hover:text-foreground hover:bg-white/[0.05]",title:"Download log",children:[e.jsx(ps,{className:"w-2.5 h-2.5"}),"save"]})]})]}),e.jsx("div",{ref:Ke,className:"overflow-auto max-h-[400px] p-2 bg-[#0c0c0e]",children:e.jsx("pre",{className:"text-[10px] text-obsidian-muted font-mono whitespace-pre-wrap break-all leading-[14px]",children:G.content})})]}):null}),h&&e.jsxs("div",{className:"mt-1.5 px-2 py-1.5 bg-obsidian-danger/10 rounded border border-obsidian-danger/20 text-[10px] transition-all active:scale-95",children:[e.jsx("span",{className:"text-obsidian-danger font-semibold",children:"✕ Task failed"}),e.jsxs("span",{className:"text-[#ff7b86] ml-1",children:["after ",$e(s.duration),s.hostname&&e.jsxs("span",{className:"text-obsidian-muted",children:[" on ",s.hostname]})]}),e.jsxs("div",{className:"mt-1 text-[9px] text-obsidian-muted",children:["Started: ",s.start_date?new Date(s.start_date).toLocaleString():"—"," → ","Ended: ",s.end_date?new Date(s.end_date).toLocaleString():"—"]})]})]})]},s.id)})]})})]},t.run_id)})})}),C==="code"&&e.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:y?e.jsxs("div",{className:"flex-1 flex items-center justify-center text-obsidian-muted text-[11px]",children:[e.jsx(P,{className:"w-4 h-4 animate-spin mr-2"})," Loading source..."]}):re?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"px-3 py-1.5 bg-obsidian-panel border-b border-obsidian-border flex items-center justify-between shrink-0 transition-all active:scale-95",children:[e.jsxs("span",{className:"text-[10px] text-obsidian-muted font-mono",children:[c,".py"]}),e.jsxs("span",{className:"text-[9px] text-obsidian-muted",children:["v",re.version]})]}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsx("pre",{className:"text-[11px] leading-[18px] font-mono p-0 m-0",children:e.jsx("code",{children:re.content.split(`
`).map((t,a)=>e.jsxs("div",{className:"flex hover:bg-obsidian-panel/50",children:[e.jsx("span",{className:"w-10 text-right pr-3 text-obsidian-muted/50 select-none shrink-0 text-[10px] leading-[18px]",children:a+1}),e.jsx("span",{className:"flex-1 whitespace-pre",dangerouslySetInnerHTML:{__html:zt(t)}})]},a))})})})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center text-obsidian-muted text-[11px]",children:"No source code available"})})]})]}),Bt&&e.jsx("div",{className:"fixed inset-0 z-[120] bg-black/70 backdrop-blur-sm flex items-center justify-center",onClick:()=>Me(!1),children:e.jsxs("div",{className:"w-[640px] max-w-[95vw] border border-white/10 rounded-lg bg-[#0f1013] shadow-2xl",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"px-4 py-3 border-b border-white/10 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Pe,{className:"w-4 h-4 text-obsidian-info"}),e.jsx("span",{className:"text-[12px] font-semibold text-foreground",children:"Trigger DAG with JSON conf"})]}),e.jsx("button",{onClick:()=>Me(!1),className:"text-obsidian-muted hover:text-foreground text-[12px]",children:"✕"})]}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"text-[10px] text-obsidian-muted font-mono",children:["DAG: ",c||"—"]}),e.jsx("textarea",{value:it,onChange:t=>Vt(t.target.value),className:"w-full h-56 bg-black/40 border border-white/10 rounded px-3 py-2 text-[11px] text-foreground font-mono outline-none focus:border-obsidian-info/50",spellCheck:!1}),St&&e.jsx("div",{className:"text-[10px] text-obsidian-danger bg-obsidian-danger/10 border border-obsidian-danger/30 rounded px-2 py-1",children:St})]}),e.jsxs("div",{className:"px-4 py-3 border-t border-white/10 flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>Me(!1),className:"px-3 py-1.5 rounded border border-white/10 text-[11px] text-obsidian-muted hover:text-foreground hover:bg-white/[0.04]",children:"Cancel"}),e.jsx("button",{onClick:()=>void ts(),className:"px-3 py-1.5 rounded border border-obsidian-success/30 text-[11px] text-obsidian-success hover:bg-obsidian-success/15",children:"Trigger Run"})]})]})})]})]})}export{Bs as default};
